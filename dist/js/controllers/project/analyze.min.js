EMAPP.templateCache.put("dist/html/project/analyze/view.min.html?rev=fd2cf43c38",'<div class="app-view-project-analyze ng-cloak"><ul class="nav nav-tabs" ng-if="!self.groupuser"><li class="active"><a data-toggle="tab" href="#building">建筑</a></li><li><a data-toggle="tab" href="#socities">社会属性</a></li></ul><div class="tab-content"><div analyze-group ng-if="self.groupuser" id="group" class="tab-pane clearfix active" ng-include="\'dist/html/project/analyze/group.min.html?rev=5eaf28b4b9\'"></div><div analyze-building ng-if="!self.groupuser" id="building" class="tab-pane clearfix active" ng-include="\'dist/html/project/analyze/building.min.html?rev=1a192bf880\'"></div><div analyze-socities ng-if="!self.groupuser" id="socities" class="tab-pane clearfix" ng-include="\'dist/html/project/analyze/socities.min.html?rev=3a3e295ee3\'"></div></div></div>'),EMAPP.templateCache.put("dist/html/project/analyze/group.min.html?rev=5eaf28b4b9",'<div class="row"><div class="col-sm-4"><div class="row"><div class="panel-heading"><span class="subTitle">建筑能耗收入</span></div><div class="panel-body"><div class="subContent text-center"><div class="panel-body btn-group"><a class="btn btn-primary" href="javascript:void(0)" ng-repeat="(key,val) in self.timetype" ng-class="{active:self.timetype_current===key}" ng-click="self.timetypeChange(key)" ng-bind="val"></a></div><div class="panel-body"><div class="first-list" slimscroll="self.slimscrollOptionsFirst"><div class="media" ng-click="self.check(\'consumption\')"><div class="media-left badge" ng-class="{\'badge-primary\':self.current===\'consumption\'}">总用能</div><div class="media-body"><div></div></div><div class="media-right media-middle" ng-bind="self.data.consumption"></div></div><div class="media" ng-click="self.check(\'electric\')"><div class="media-left badge" ng-class="{\'badge-primary\':self.current===\'electric\'}">总电能</div><div class="media-body"><div></div></div><div class="media-right media-middle" ng-bind="self.data.electric"></div></div><div class="media" ng-click="self.check(\'eer\')"><div class="media-left badge" ng-class="{\'badge-primary\':self.current===\'eer\'}">能效比</div><div class="media-body"><div></div></div><div class="media-right media-middle" ng-bind="self.data.eer"></div></div></div></div></div></div></div></div><div class="col-sm-8 content-right"><div class="row"><div class="panel-heading"><span class="subTitle">能耗收入比</span></div><div class="panel-body"><div class="subContent clearfix"><div class="col-sm-12"><div class="row text-center"><div class="panel-heading second-list-top"><table class="table second-list-head"><thead><tr><th>项目名称</th><th ng-if="self.current===\'consumption\'" style="width:150px">总用量</th><th ng-if="self.current===\'consumption\'" style="width:150px">同期用量</th><th ng-if="self.current===\'electric\'" style="width:150px">总电能</th><th ng-if="self.current===\'electric\'" style="width:150px">同期电能</th><th ng-if="self.current===\'eer\'" style="width:150px">用量比</th><th ng-if="self.current===\'eer\'" style="width:150px">同期用量比</th><th style="width:130px">建筑面积</th></tr></thead></table></div><div class="panel-body"><div class="second-list" slimscroll="self.slimscrollOptionsSecond"><table class="table table-condensed"><tbody><tr ng-repeat="item in self.sheet"><td ng-bind="item.name"></td><td style="width:150px" ng-bind="item.now[self.current]"></td><td style="width:150px" ng-bind="item.yoy[self.current]"></td><td style="width:130px" ng-bind="item.area"></td></tr></tbody></table></div></div></div></div></div></div></div></div></div><div class="col-sm-12"><div class="row subContent"><div class="panel-heading"><span class="subTitle">项目能耗曲线图</span></div><div class="panel-body"><highcharts class="highcharts-panel text-center" config="self.chart.timeline"></highcharts></div></div></div>'),EMAPP.templateCache.put("dist/html/project/analyze/building.min.html?rev=1a192bf880",'<div class="row"><div class="col-sm-4"><div class="row"><div class="panel-heading"><span class="subTitle">建筑能耗收入</span></div><div class="panel-body"><div class="subContent text-center"><div class="panel-body btn-group"><a class="btn btn-primary" href="javascript:void(0)" ng-repeat="(key,val) in self.timetype" ng-class="{active:self.timetype_current===key}" ng-click="self.timetypeChange(key)" ng-bind="val"></a></div><div class="panel-body"><div class="first-list" slimscroll="self.slimscrollOptionsFirst"><div class="media" ng-repeat="(key,item) in self.buildingData" ng-click="self.building(item.buildingid)"><div class="media-left badge" ng-class="{\'badge-primary\':self.building_current===item.buildingid||self.building_current===\'\'}" ng-bind="item.consumption.toFixed(0)+\'kWh\'"></div><div class="media-body"><div ng-bind="item.name"></div></div><div class="media-right media-middle" ng-bind="\'¥\'+item.cost.toFixed(0)"></div></div></div></div></div></div></div></div><div class="col-sm-8 content-right"><div class="row"><div class="panel-heading"><span class="subTitle">能耗收入比</span></div><div class="panel-body"><div class="subContent clearfix"><div class="row second-chart"><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.nowyoy"></highcharts></div><div class="col-sm-6" ng-if="self.pie.nowyoy"><div class="consumptionPerAreaPrime" ng-bind="self.pie.nowyoy.now.toFixed(0)+\' KWh\'"></div><div class="consumptionPerAreaSub">总能耗</div><div class="seprator"></div><div class="incomeTargetPeriodPrime" ng-bind="self.pie.nowyoy.yoy.toFixed(0)+\' kWh\'"></div><div class="incomeTargetPeriodSub">同期能耗</div></div></div><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.nowbudget"></highcharts></div><div class="col-sm-6" ng-if="self.pie.nowbudget"><div class="consumptionPerAreaPrime" ng-bind="self.pie.nowbudget.now.toFixed(0)+\' KWh\'"></div><div class="consumptionPerAreaSub">总能耗</div><div class="seprator"></div><div class="incomeTargetPeriodPrime" ng-bind="self.pie.nowbudget.budget.toFixed(0)+\' kWh\'"></div><div class="incomeTargetPeriodSub">预算指标</div></div></div><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.nowincome"></highcharts></div><div class="col-sm-6" ng-if="self.pie.nowincome"><div class="consumptionPerAreaPrime" ng-bind="self.pie.nowincome.now.toFixed(0)+\' KWh\'"></div><div class="consumptionPerAreaSub">总能耗</div><div class="seprator"></div><div class="incomeTargetPeriodPrime" ng-bind="self.pie.nowincome.income.toFixed(0)+\' 元\'"></div><div class="incomeTargetPeriodSub">收入</div></div></div></div><div class="col-sm-12"><div class="row text-center"><div class="panel-heading" ng-if="self.sheet"><table class="table second-list-head"><thead><tr><th style="width:100px">能耗名称</th><th>总用量(kWh)</th><th style="width:140px">总用量比(%)</th><th style="width:140px">同期用量(kWh)</th><th style="width:140px">同期比(%)</th></tr></thead></table></div><div class="panel-body"><div class="second-list second-list-hover" slimscroll="self.slimscrollOptionsSecond"><table class="table table-condensed"><tbody><tr ng-repeat="(name,item) in self.sheet" ng-class="{selected:self.energy_current===item.energy}" ng-click="self.energy(item.energy)"><td style="width:100px" ng-bind="name"></td><td ng-bind="item.nowSum.toFixed(2)"></td><td style="width:140px" ng-bind="item.nowRate.toFixed(2)"></td><td style="width:140px" ng-bind="item.yoySum.toFixed(2)"></td><td style="width:140px" ng-bind="item.yoyRate.toFixed(2)"></td></tr></tbody></table></div></div></div></div></div></div></div></div></div><div class="col-sm-12"><div class="row subContent"><div class="panel-heading"><span class="subTitle">能耗实时曲线图</span></div><div class="panel-body"><highcharts class="highcharts-panel text-center" config="self.chart.timeline"></highcharts></div></div></div>'),EMAPP.templateCache.put("dist/html/project/analyze/socities.min.html?rev=3a3e295ee3",'<div class="row"><div class="col-sm-4"><div class="row"><div class="panel-heading"><span class="subTitle">社会属性能耗收入</span></div><div class="panel-body"><div class="subContent text-center"><div class="panel-body btn-group"><a class="btn btn-primary" ng-repeat="(key,val) in self.timetype" ng-class="{active:self.timetype_current===key}" ng-click="self.timetypeChange(key)" ng-bind="val"></a></div><div class="panel-body"><div class="first-list" slimscroll="self.slimscrollOptionsFirst"><div class="media" ng-repeat="(key,item) in self.socityData" ng-click="self.socity(item.socityid)"><div class="media-left badge" ng-class="{\'badge-primary\':self.socity_current===item.socityid||self.socity_current===\'\'}" ng-bind="item.consumption.toFixed(0)+\'kWh\'"></div><div class="media-body"><div ng-bind="item.name"></div></div><div class="media-right media-middle" ng-bind="\'¥\'+item.cost.toFixed(0)"></div></div></div></div></div></div></div></div><div class="col-sm-8 content-right"><div class="row"><div class="panel-heading"><span class="subTitle">能耗收入比</span></div><div class="panel-body"><div class="subContent clearfix"><div class="row second-chart"><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.nowyoy"></highcharts></div><div class="col-sm-6" ng-if="self.pie.nowyoy"><div class="consumptionPerAreaPrime">{{self.pie.nowyoy.now.toFixed(0)}} KWh</div><div class="consumptionPerAreaSub">总能耗</div><div class="seprator"></div><div class="incomeTargetPeriodPrime">{{self.pie.nowyoy.yoy.toFixed(0)}} kWh</div><div class="incomeTargetPeriodSub">同期能耗</div></div></div><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.electric"></highcharts></div><div class="col-sm-6" ng-if="self.pie.electric"><div class="consumptionPerAreaPrime">{{self.pie.electric.now.toFixed(0)}} KWh</div><div class="consumptionPerAreaSub">电总能耗</div><div class="seprator"></div><div class="incomeTargetPeriodPrime">{{self.pie.electric.yoy.toFixed(0)}} kWh</div><div class="incomeTargetPeriodSub">同期电能耗</div></div></div><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.third"></highcharts></div><div class="col-sm-6" ng-if="self.pie.third"><div class="consumptionPerAreaPrime">{{self.pie.third.now.toFixed(0)}} {{self.pie.third.unitTitle}}</div><div class="consumptionPerAreaSub">{{self.pie.third.nowTitle}}</div><div class="seprator"></div><div class="incomeTargetPeriodPrime">{{self.pie.third.yoy.toFixed(0)}} {{self.pie.third.unitTitle}}</div><div class="incomeTargetPeriodSub">{{self.pie.third.yoyTitle}}</div></div></div></div><div class="col-sm-12"><div class="row text-center"><div class="panel-heading" ng-if="self.sheet"><table class="table second-list-head"><thead><tr><th style="width:80px">社会属性</th><th style="width:70px">水</th><th style="width:80px">电</th><th style="width:70px">气</th><th style="width:80px">合计<br>(kWh)</th><th style="width:70px">占比<br>(%)</th><th style="width:70px">费用<br>(元)</th><th>同期用量<br>(kWh)</th><th style="width:70px">同期比<br>(%)</th></tr></thead></table></div><div class="panel-body"><div class="second-list second-list-hover" slimscroll="self.slimscrollOptionsSecond"><table class="table table-condensed"><tbody><tr ng-repeat="item in self.sheet" ng-class="{selected:self.socity_current===item.socity}" ng-click="self.socity(item.socity)"><td style="width:80px" ng-bind="item.name"></td><td style="width:70px" ng-bind="item.water.toFixed(2)"></td><td style="width:80px" ng-bind="item.electric.toFixed(2)"></td><td style="width:70px" ng-bind="item.gas.toFixed(2)"></td><td style="width:80px" ng-bind="item.nowconsumption.toFixed(2)"></td><td style="width:70px" ng-bind="item.nowrate.toFixed(2)"></td><td style="width:70px" ng-bind="item.cost.toFixed(0)"></td><td ng-bind="item.yoyconsumption.toFixed(2)"></td><td style="width:70px" ng-bind="item.yoyrate.toFixed(2)"></td></tr></tbody></table></div></div></div></div></div></div></div></div></div><div class="col-sm-12"><div class="row subContent"><div class="panel-heading"><span class="subTitle">能耗实时曲线图</span></div><div class="panel-body"><highcharts class="highcharts-panel" config="self.chart.timeline"></highcharts></div></div></div>'),EMAPP.register.directive("analyzeGroup",function(){return{restrict:"A",scope:!1,controller:"project.analyze.group",controllerAs:"self"}}),EMAPP.register.directive("analyzeBuilding",function(){return{restrict:"A",scope:!1,controller:"project.analyze.building",controllerAs:"self"}}),EMAPP.register.directive("analyzeSocities",function(){return{restrict:"A",scope:!1,controller:"project.analyze.socities",controllerAs:"self"}}),function(e){EMAPP.register.controller("project.analyze",function(){this.groupuser=EMAPP.User.groupuser}),EMAPP.register.controller("project.analyze.group",["$filter","$api",function(e,t){var i=this;return i.slimscrollOptionsFirst={color:"rgba(0,0,0,0.5)",height:230,alwaysVisible:!0},i.slimscrollOptionsSecond={color:"rgba(0,0,0,0.5)",height:290,alwaysVisible:!0},i.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},i.chart={},i.timetypeChange=function(e){i.building_current="",i.energy_current="",i.timetype_current=e,i.groupanalysis()},i.groupanalysis=function(){t.business.groupanalysis({time:e("date")(new Date,"yyyyMMdd"),type:i.timetype_current||"DAY",project:EMAPP.Project.ids},function(e){i.data=e.result,i.check(i.current)})},i.current="consumption",i.check=function(e){i.current=e,i.sheet=[];var t=[],r=[],n=[];angular.forEach(i.data.detail,function(o,c){t.push(o.name=EMAPP.Project[c].title),i.sheet.push(o),angular.forEach(o,function(t,i){"now"===i&&r.push(t[e]),"yoy"===i&&n.push(t[e])})}),i.chart.timeline={chart:{type:"column"},title:!1,xAxis:{categories:t},yAxis:{title:!1},tooltip:{shared:!0},series:[{name:"当前",data:r},{name:"同期",data:n}]}},i.timetypeChange("DAY"),i}]),EMAPP.register.controller("project.analyze.building",["$filter","$api",function(t,i){var r=this;return r.slimscrollOptionsFirst={color:"rgba(0,0,0,0.5)",height:230,alwaysVisible:!0},r.slimscrollOptionsSecond={color:"rgba(0,0,0,0.5)",height:185,alwaysVisible:!0},r.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},r.chart={},r.timetypeChange=function(e){r.building_current="",r.energy_current="",r.timetype_current=e,r.buildingstatistic(),r.incomerate(),r.timeline()},r.building_current="",r.building=function(e){r.energy_current="",r.building_current=r.building_current===e?"":e,r.incomerate(),r.timeline()},r.energy_current="",r.energy=function(e){r.energy_current=r.energy_current===e?"":e,r.timeline()},r.buildingstatistic=function(){i.business.buildingstatistic({timetype:r.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:EMAPP.Project.current._id},function(e){r.buildingData=e.result[EMAPP.Project.current._id]})},r.incomerate=function(){i.business.energyincomerate({timetype:r.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:{project:EMAPP.Project.current._id,building:r.building_current}},function(t){t=t.result[EMAPP.Project.current._id],r.pie=t.pie,r.sheet=t.sheet,r.chart.nowyoy=e(t.pie.nowyoy.now,t.pie.nowyoy.yoy),r.chart.nowbudget=e(t.pie.nowbudget.now,t.pie.nowbudget.budget),r.chart.nowincome=e(t.pie.nowincome.now,t.pie.nowincome.income)})},r.timeline=function(){i.business.energytimeline({timetype:r.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:[{project:EMAPP.Project.current._id,energytype:r.energy_current,building:r.building_current}]},function(e){var i=[],n=[];angular.forEach(e.result[EMAPP.Project.current._id]||{},function(e,t,r){Object.keys(e).length>i.length&&(r=0,i=[]),angular.forEach(e,function(e,t){this.push(parseFloat(e.toFixed(2))),0===r&&i.push(1*t)},e=[]),n.push({data:e,name:{now:"当前能耗",yoy:"同期能耗"}[t]||t})}),r.chart.timeline={chart:{type:"spline"},title:!1,xAxis:{type:"datetime",categories:i,labels:{formatter:function(){return t("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[r.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[r.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:n}})},r.timetypeChange("DAY"),r}]),EMAPP.register.controller("project.analyze.socities",["$filter","$api",function(t,i){var r=this;return r.slimscrollOptionsFirst={color:"rgba(0,0,0,0.5)",height:250,alwaysVisible:!0},r.slimscrollOptionsSecond={color:"rgba(0,0,0,0.5)",height:185,alwaysVisible:!0},r.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},r.socity_current="",r.socity=function(e){r.socity_current=r.socity_current===e?"":e,r.timeline()},r.timetypeChange=function(n){r.socity_current="",r.timetype_current=n,r.chart={},i.business.socitystatistic({timetype:r.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:EMAPP.Project.current._id},function(e){r.socityData=e.result[EMAPP.Project.current._id]}),i.business.socitydetail({timetype:r.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:EMAPP.Project.current._id},function(t){t=t.result[EMAPP.Project.current._id],r.pie=t.pie,r.sheet=t.sheet,r.pie.third=r.pie.water||r.pie.gas,r.pie.water?(r.pie.third.unitTitle="吨",r.pie.third.nowTitle="水当期总量",r.pie.third.yoyTitle="水同期总量"):r.pie.gas&&(r.pie.third.unitTitle="立方米",r.pie.third.nowTitle="气当期总量",r.pie.third.yoyTitle="气同期总量"),r.chart.nowyoy=e(t.pie.nowyoy.now,t.pie.nowyoy.yoy),r.chart.electric=e(t.pie.electric.now,t.pie.electric.yoy),r.chart.third=e(t.pie.third.now,t.pie.third.yoy)}),r.timeline()},r.timeline=function(){i.business.socitytimeline({timetype:r.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:[{project:EMAPP.Project.current._id,socity:r.socity_current}]},function(e){var i=[],n=[];angular.forEach(e.result[EMAPP.Project.current._id]||{},function(e,t,r){Object.keys(e).length>i.length&&(r=0,i=[]),angular.forEach(e.detail,function(e,t){this.push(parseFloat(e.toFixed(2))),0===r&&i.push(1*t)},e=[]),n.push({data:e,name:t})}),r.chart.timeline={chart:{type:"spline"},title:!1,xAxis:{type:"datetime",categories:i,labels:{formatter:function(){return t("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[r.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[r.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:n}})},r.timetypeChange("DAY"),r}])}(function(e,t){var i=Math.max(-100,Math.min(100,(e-t)/t*100||0).toFixed(0)),r=[{name:"",color:"#7CB5EC",y:Math.abs(i)},{name:"",color:"#8085E9",y:100-Math.abs(i)}];return{chart:{margin:[0,0,0,0],style:{textAlign:"center"},type:"pie"},title:{text:'<span style="'+(i>0?"color:#e74c3c;":"color:#17bac1;")+'"><span style="font-size: 26px;">'+Math.abs(i)+'</span><span style="font-size:14px;">%</span></span>',verticalAlign:"middle",useHTML:!0,y:2},tooltip:!1,plotOptions:{pie:{dataLabels:{enabled:!1,color:"#000",connectorColor:"#000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},innerSize:"80%"}},series:[{data:r}]}});