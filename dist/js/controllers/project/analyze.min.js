EMAPP.templateCache.put("dist/html/project/analyze.min.html?rev=dc14096329",'<div class="app-view-project-analyze ng-cloak"><ul class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#building">建筑</a></li><li><a data-toggle="tab" href="#socities">社会属性</a></li></ul><div class="tab-content"><div ng-controller="project.analyze.building as self" class="tab-pane clearfix active" id="building"><div class="row"><div class="col-sm-4"><div class="row"><div class="panel-heading"><span class="subTitle">建筑能耗收入</span></div><div class="panel-body"><div class="subContent text-center"><div class="panel-body btn-group"><a class="btn btn-primary" href="javascript:void(0)" ng-repeat="(key,val) in self.timetype" ng-class="{active:self.timetype_current===key}" ng-click="self.timetypeChange(key)" ng-bind="val"></a></div><div class="panel-body"><div class="first-list" slimscroll="self.slimscrollOptionsFirst"><div class="media" ng-repeat="(key,item) in self.buildingData" ng-click="self.building(item.buildingid)"><div class="media-left badge" ng-class="{\'badge-primary\':self.building_current===item.buildingid||self.building_current===\'\'}" ng-bind="item.consumption.toFixed(0)+\'kWh\'"></div><div class="media-body"><div ng-bind="item.name"></div></div><div class="media-right media-middle" ng-bind="\'¥\'+item.cost.toFixed(0)"></div></div></div></div></div></div></div></div><div class="col-sm-8 content-right"><div class="row"><div class="panel-heading"><span class="subTitle">能耗收入比</span></div><div class="panel-body"><div class="subContent clearfix"><div class="row second-chart"><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.nowyoy"></highcharts></div><div class="col-sm-6" ng-if="self.pie.nowyoy"><div class="consumptionPerAreaPrime" ng-bind="self.pie.nowyoy.now.toFixed(0)+\' KWh\'"></div><div class="consumptionPerAreaSub">总能耗</div><div class="seprator"></div><div class="incomeTargetPeriodPrime" ng-bind="self.pie.nowyoy.yoy.toFixed(0)+\' kWh\'"></div><div class="incomeTargetPeriodSub">同期能耗</div></div></div><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.nowbudget"></highcharts></div><div class="col-sm-6" ng-if="self.pie.nowbudget"><div class="consumptionPerAreaPrime" ng-bind="self.pie.nowbudget.now.toFixed(0)+\' KWh\'"></div><div class="consumptionPerAreaSub">总能耗</div><div class="seprator"></div><div class="incomeTargetPeriodPrime" ng-bind="self.pie.nowbudget.budget.toFixed(0)+\' kWh\'"></div><div class="incomeTargetPeriodSub">预算指标</div></div></div><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.nowincome"></highcharts></div><div class="col-sm-6" ng-if="self.pie.nowincome"><div class="consumptionPerAreaPrime" ng-bind="self.pie.nowincome.now.toFixed(0)+\' KWh\'"></div><div class="consumptionPerAreaSub">总能耗</div><div class="seprator"></div><div class="incomeTargetPeriodPrime" ng-bind="self.pie.nowincome.income.toFixed(0)+\' 元\'"></div><div class="incomeTargetPeriodSub">收入</div></div></div></div><div class="col-sm-12"><div class="row text-center"><div class="panel-heading" ng-if="self.sheet"><table class="table second-list-head"><thead><tr><th style="width:100px;">能耗名称</th><th>总用量(kWh)</th><th style="width:140px;">总用量比(%)</th><th style="width:140px;">同期用量(kWh)</th><th style="width:140px;">同期比(%)</th></tr></thead></table></div><div class="panel-body"><div class="second-list" slimscroll="self.slimscrollOptionsSecond"><table class="table table-condensed"><tbody><tr ng-repeat="(name,item) in self.sheet" ng-class="{selected:self.energy_current===item.energy}" ng-click="self.energy(item.energy)"><td style="width:100px;" ng-bind="name"></td><td ng-bind="item.nowSum.toFixed(2)"></td><td style="width:140px;" ng-bind="item.nowRate.toFixed(2)"></td><td style="width:140px;" ng-bind="item.yoySum.toFixed(2)"></td><td style="width:140px;" ng-bind="item.yoyRate.toFixed(2)"></td></tr></tbody></table></div></div></div></div></div></div></div></div></div><div class="col-sm-12"><div class="row subContent"><div class="panel-heading"><span class="subTitle">能耗实时曲线图</span></div><div class="panel-body"><highcharts class="highcharts-panel text-center" config="self.chart.timeline"></highcharts></div></div></div></div><div ng-controller="project.analyze.socities as self" class="tab-pane clearfix" id="socities"><div class="row"><div class="col-sm-4"><div class="row"><div class="panel-heading"><span class="subTitle">社会属性能耗收入</span></div><div class="panel-body"><div class="subContent text-center"><div class="panel-body btn-group"><a class="btn btn-primary" ng-repeat="(key,val) in self.timetype" ng-class="{active:self.timetype_current===key}" ng-click="self.timetypeChange(key)" ng-bind="val"></a></div><div class="panel-body"><div class="first-list" slimscroll="self.slimscrollOptionsFirst"><div class="media" ng-repeat="(key,item) in self.socityData" ng-click="self.socity(item.socityid)"><div class="media-left badge" ng-class="{\'badge-primary\':self.socity_current===item.socityid||self.socity_current===\'\'}" ng-bind="item.consumption.toFixed(0)+\'kWh\'"></div><div class="media-body"><div ng-bind="item.name"></div></div><div class="media-right media-middle" ng-bind="\'¥\'+item.cost.toFixed(0)"></div></div></div></div></div></div></div></div><div class="col-sm-8 content-right"><div class="row"><div class="panel-heading"><span class="subTitle">能耗收入比</span></div><div class="panel-body"><div class="subContent clearfix"><div class="row second-chart"><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.nowyoy"></highcharts></div><div class="col-sm-6" ng-if="self.pie.nowyoy"><div class="consumptionPerAreaPrime">{{self.pie.nowyoy.now.toFixed(0)}} KWh</div><div class="consumptionPerAreaSub">总能耗</div><div class="seprator"></div><div class="incomeTargetPeriodPrime">{{self.pie.nowyoy.yoy.toFixed(0)}} kWh</div><div class="incomeTargetPeriodSub">同期能耗</div></div></div><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.electric"></highcharts></div><div class="col-sm-6" ng-if="self.pie.electric"><div class="consumptionPerAreaPrime">{{self.pie.electric.now.toFixed(0)}} KWh</div><div class="consumptionPerAreaSub">电总能耗</div><div class="seprator"></div><div class="incomeTargetPeriodPrime">{{self.pie.electric.yoy.toFixed(0)}} kWh</div><div class="incomeTargetPeriodSub">同期电能耗</div></div></div><div class="col-sm-4"><div class="col-sm-6"><highcharts class="highcharts-panel text-center" config="self.chart.third"></highcharts></div><div class="col-sm-6" ng-if="self.pie.third"><div class="consumptionPerAreaPrime">{{self.pie.third.now.toFixed(0)}} {{self.pie.third.unitTitle}}</div><div class="consumptionPerAreaSub">{{self.pie.third.nowTitle}}</div><div class="seprator"></div><div class="incomeTargetPeriodPrime">{{self.pie.third.yoy.toFixed(0)}} {{self.pie.third.unitTitle}}</div><div class="incomeTargetPeriodSub">{{self.pie.third.yoyTitle}}</div></div></div></div><div class="col-sm-12"><div class="row text-center"><div class="panel-heading" ng-if="self.sheet"><table class="table second-list-head"><thead><tr><th style="width:80px;">社会属性</th><th style="width:70px;">水</th><th style="width:80px;">电</th><th style="width:70px;">气</th><th style="width:80px;">合计<br>(kWh)</th><th style="width:70px;">占比<br>(%)</th><th style="width:70px;">费用<br>(元)</th><th>同期用量<br>(kWh)</th><th style="width:70px;">同期比<br>(%)</th></tr></thead></table></div><div class="panel-body"><div class="second-list" slimscroll="self.slimscrollOptionsSecond"><table class="table table-condensed"><tbody><tr ng-repeat="item in self.sheet" ng-class="{selected:self.socity_current===item.socity}" ng-click="self.socity(item.socity)"><td style="width:80px;" ng-bind="item.name"></td><td style="width:70px;" ng-bind="item.water.toFixed(2)"></td><td style="width:80px;" ng-bind="item.electric.toFixed(2)"></td><td style="width:70px;" ng-bind="item.gas.toFixed(2)"></td><td style="width:80px;" ng-bind="item.nowconsumption.toFixed(2)"></td><td style="width:70px;" ng-bind="item.nowrate.toFixed(2)"></td><td style="width:70px;" ng-bind="item.cost.toFixed(0)"></td><td ng-bind="item.yoyconsumption.toFixed(2)"></td><td style="width:70px;" ng-bind="item.yoyrate.toFixed(2)"></td></tr></tbody></table></div></div></div></div></div></div></div></div></div><div class="col-sm-12"><div class="row subContent"><div class="panel-heading"><span class="subTitle">能耗实时曲线图</span></div><div class="panel-body"><highcharts class="highcharts-panel" config="self.chart.timeline"></highcharts></div></div></div></div></div></div>'),~function(){var e=function(e,t){var i=Math.max(-100,Math.min(100,(e-t)/t*100||0).toFixed(0)),n=[{name:"",color:"#7CB5EC",y:Math.abs(i)},{name:"",color:"#8085E9",y:100-Math.abs(i)}];return{titleVerticalAlign:"middle",titleY:2,title:'<span style="'+(i>0?"color:#e74c3c;":"color:#17bac1;")+'"><span style="font-size: 26px;">'+Math.abs(i)+'</span><span style="font-size:14px;">%</span></span>',chart:{margin:[0,0,0,0],style:{textAlign:"center"}},series:[{type:"pie",data:n}],tooltip:{pointFormat:"<b>"+Math.abs(i)+"%</b>",enabled:!1},pie:{dataLabels:{enabled:!1,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},innerSize:68,size:86}}};EMAPP.register.controller("project.analyze.building",["$filter","$api","Pies","Lines",function(t,i,n,r){var o=this;return o.slimscrollOptionsFirst={color:"rgba(0,0,0,0.5)",height:230,alwaysVisible:!0},o.slimscrollOptionsSecond={color:"rgba(0,0,0,0.5)",height:185,alwaysVisible:!0},o.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},o.chart={},o.timetypeChange=function(e){o.building_current="",o.energy_current="",o.timetype_current=e,o.buildingstatistic(),o.incomerate(),o.timeline()},o.building_current="",o.building=function(e){o.energy_current="",o.building_current=o.building_current===e?"":e,o.incomerate(),o.timeline()},o.energy_current="",o.energy=function(e){o.energy_current=o.energy_current===e?"":e,o.timeline()},o.buildingstatistic=function(){i.business.buildingstatistic({timetype:o.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:EMAPP.Project.current._id},function(e){o.buildingData=e.result[EMAPP.Project.current._id]})},o.incomerate=function(){i.business.energyincomerate({timetype:o.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:{project:EMAPP.Project.current._id,building:o.building_current}},function(t){t=t.result[EMAPP.Project.current._id],o.pie=t.pie,o.sheet=t.sheet,o.chart.nowyoy=n(e(t.pie.nowyoy.now,t.pie.nowyoy.yoy)),o.chart.nowbudget=n(e(t.pie.nowbudget.now,t.pie.nowbudget.budget)),o.chart.nowincome=n(e(t.pie.nowincome.now,t.pie.nowincome.income))})},o.timeline=function(){i.business.energytimeline({timetype:o.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:[{project:EMAPP.Project.current._id,energytype:o.energy_current,building:o.building_current}]},function(e){var i=[],n=[];~function(e,t){angular.forEach(t,function(e,t){n.push(t),this.push([t,1*e.toFixed(2)])},t=[]),i.push({name:e,data:t})}("当前数据",e.result[EMAPP.Project.current._id].now),~function(e,t){angular.forEach(t,function(e,t){this.push([t,1*e.toFixed(2)])},t=[]),i.push({name:e,data:t})}("同期数据",e.result[EMAPP.Project.current._id].yoy),o.chart.timeline=r({title:"",type:"spline",series:i,xAxis:{categories:n,labels:{formatter:function(){return t("date")(this.value,{DAY:"H时",WEEK:"M月d号",MONTH:"M月d号",YEAR:"M月"}[o.timetype_current])}}},chart:{margin:[0,0,0,0],style:{textAlign:"center"}},tooltip:{headerFormat:"",pointFormat:"{series.name}: <b>{point.y:.2f} kWh"},plotOptions:{series:{cursor:"pointer"}}})})},o.timetypeChange("DAY"),o}]),EMAPP.register.controller("project.analyze.socities",["$filter","$api","Pies","Lines",function(t,i,n,r){var o=this;return o.slimscrollOptionsFirst={color:"rgba(0,0,0,0.5)",height:250,alwaysVisible:!0},o.slimscrollOptionsSecond={color:"rgba(0,0,0,0.5)",height:185,alwaysVisible:!0},o.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},o.socity_current="",o.socity=function(e){o.socity_current=o.socity_current===e?"":e,o.timeline()},o.timetypeChange=function(r){o.socity_current="",o.timetype_current=r,o.chart={},i.business.socitystatistic({timetype:o.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:EMAPP.Project.current._id},function(e){o.socityData=e.result[EMAPP.Project.current._id]}),i.business.socitydetail({timetype:o.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:EMAPP.Project.current._id},function(t){t=t.result[EMAPP.Project.current._id],o.pie=t.pie,o.sheet=t.sheet,o.pie.third=o.pie.water||o.pie.gas,o.pie.water?(o.pie.third.unitTitle="吨",o.pie.third.nowTitle="水当期总量",o.pie.third.yoyTitle="水同期总量"):o.pie.gas&&(o.pie.third.unitTitle="立方米",o.pie.third.nowTitle="气当期总量",o.pie.third.yoyTitle="气同期总量"),o.chart.nowyoy=n(e(t.pie.nowyoy.now,t.pie.nowyoy.yoy)),o.chart.electric=n(e(t.pie.electric.now,t.pie.electric.yoy)),o.chart.third=n(e(t.pie.third.now,t.pie.third.yoy))}),o.timeline()},o.timeline=function(){i.business.socitytimeline({timetype:o.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:[{project:EMAPP.Project.current._id,socity:o.socity_current}]},function(e){var i=[];angular.forEach(e.result[EMAPP.Project.current._id],function(e,t){angular.forEach(e.detail,function(e,n){0===t&&i.push(n),this.push([n,1*e.toFixed(2)])},e.data=[]),e={name:e.name,data:e.data},this.push(e)},e=[]),o.chart.timeline=r({title:"",type:"spline",series:e,xAxis:{categories:i,labels:{formatter:function(){return t("date")(this.value,{DAY:"H时",WEEK:"M月d号",MONTH:"M月d号",YEAR:"M月"}[o.timetype_current])}}},chart:{margin:[0,0,0,0],style:{textAlign:"center"}},tooltip:{headerFormat:"",pointFormat:"{series.name}: <b>{point.y:.2f} kWh"},plotOptions:{series:{cursor:"pointer"}}})})},o.timetypeChange("DAY"),o}])}();