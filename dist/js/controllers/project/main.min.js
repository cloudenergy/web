EMAPP.templateCache.put("dist/html/project/main/view.min.html?rev=7fe15c145c",'<div class="app-view-project-main ng-cloak"><div class="row"><div class="col-sm-7"><div class="row"><div class="panel-heading"><span class="subTitle">能耗日历</span></div><div class="panel-body"><div class="subContent clearfix"><div class="col-sm-5" ng-include="\'dist/html/project/main/calendar.min.html?rev=a732941370\'"></div><div class="col-sm-7" ng-include="\'dist/html/project/main/dailycost.min.html?rev=d8d32c91f2\'"></div></div></div></div></div><div class="col-sm-5 content-right"><div class="row"><div class="panel-heading"><span class="subTitle">总能耗</span></div><div class="panel-body"><div class="subContent clearfix" ng-include="\'dist/html/project/main/monthlykgce.min.html?rev=8e3815e374\'"></div></div></div></div></div><div class="rate-content clearfix"><div ng-if="!self.groupmode" class="col-sm-7" ng-include="\'dist/html/project/main/energyconstitute.min.html?rev=e5faa3cd1c\'"></div><div ng-if="!self.groupmode" class="col-sm-5 content-right" ng-include="\'dist/html/project/main/dailysensordetail.min.html?rev=d8d0375147\'"></div><div ng-if="self.groupmode" class="col-sm-7" ng-include="\'dist/html/project/main/energyeffectiverate.min.html?rev=4df752316c\'"></div><div ng-if="self.groupmode" class="col-sm-5 content-right" ng-include="\'dist/html/project/main/projectdetail.min.html?rev=9090093f34\'"></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/calendar.min.html?rev=a732941370",'<div class="datetimepicker-component"><div class="datetimepicker-panel"><i></i><datetimepicker data-format="YYYY/MM/DD" data-inline="true"></datetimepicker></div><div class="datetimepicker-comment row panel-body text-center"><div class="col-sm-4"><div class="row"><i class="em-down"></i> 能耗下降</div></div><div class="col-sm-4"><div class="row"><i class="em-up"></i> 能耗上升</div></div><div class="col-sm-4"><div class="row"><i class="em-keep"></i> 能耗持平</div></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/dailycost.min.html?rev=d8d32c91f2",'<div class="row highcharts-component" ng-if="self.chart.dailycost"><div class="highcharts-today text-center">{{self.viewDate|date:\'yyyy-MM-dd\'}}</div><highcharts class="highcharts-panel text-center" config="self.chart.dailycost"></highcharts><div class="highcharts-comment row text-center"><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">环比费用</div><div class="unitAreaCounting">{{self.currentDayqoq}} <span class="unitAreaUnit">%</span></div></div></div><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">同比费用</div><div class="unitAreaCounting">{{self.currentDayyoy}} <span class="unitAreaUnit">%</span></div></div></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/monthlykgce.min.html?rev=8e3815e374",'<div class="highcharts-component" ng-if="self.chart.monthlykgce"><div class="highcharts-today text-center">{{self.viewDate|date:\'yyyy-MM\'}}</div><highcharts class="highcharts-panel text-center" config="self.chart.monthlykgce"></highcharts><div class="highcharts-comment row text-center"><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">单位面积能耗</div><div class="unitAreaCounting">{{self.currentMonthKgceperunitarea}} <span class="unitAreaUnit">kgce/m2</span></div></div></div><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">单位面积电耗</div><div class="unitAreaCounting">{{self.currentMonthKwhperunitarea}} <span class="unitAreaUnit">kWh/m2</span></div></div></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/energyconstitute.min.html?rev=e5faa3cd1c",'<div class="row"><div class="panel-heading"><span class="subTitle">水电气构成{{self.viewDate|date:\'（yyyy-MM）\'}}</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-line text-center" config="self.chart.energyconstitute"></highcharts></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/dailysensordetail.min.html?rev=d8d0375147",'<div class="row"><div class="panel-heading"><span class="subTitle">能耗细分</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-pie text-center" config="self.chart.dailysensordetail"></highcharts></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/energyeffectiverate.min.html?rev=4df752316c",'<div class="row"><div class="panel-heading"><span class="subTitle">能效比{{self.viewDate|date:\'（yyyy-MM）\'}}</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-line text-center" config="self.chart.energyeffectiverate"></highcharts></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/projectdetail.min.html?rev=9090093f34",'<div class="row"><div class="panel-heading"><span class="subTitle">节能星级</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-pie text-center" config="self.chart.projectdetail"></highcharts></div></div></div>'),EMAPP.register.controller("project.main",["$api","$filter","$timeout",function(e,t,a){var i=this;i.viewDate=new Date,i.chart={},i.groupmode=EMAPP.User.groupmode,a(function(e){e=$("datetimepicker").bind("dp.show",function(){a(function(){e.data("DateTimePicker").maxDate(new Date)})}).bind("dp.change",function(e){var a=angular.equals(e.date.format("YYYYMM"),t("date")(i.viewDate,"yyyyMM")),n=angular.equals(e.date.format("YYYYMMDD"),t("date")(i.viewDate,"yyyyMMdd"));n||(i.viewDate=e.date._d),a&&!n&&i.bindTD(),!a&&i.calendar(i.viewDate),!n&&i.dailycost(i.viewDate),!a&&i.monthlykgce(i.viewDate),!a&&!i.groupmode&&i.energyconstitute(i.viewDate),!a&&!i.groupmode&&i.dailysensordetail(i.viewDate),!a&&i.groupmode&&i.energyeffectiverate(i.viewDate),!a&&i.groupmode&&i.projectdetail(i.viewDate)}).bind("dp.update",function(a){angular.equals(a.viewDate.format("YYYYMM"),t("date")(i.viewDate,"yyyyMM"))?i.bindTD():e.data("DateTimePicker").maxDate(new Date).defaultDate(a.viewDate.format("YYYYMMDD")>t("date")(new Date,"yyyyMMdd")?new Date:a.viewDate._d)}),i.calendar(i.viewDate),i.dailycost(i.viewDate),i.monthlykgce(i.viewDate),!i.groupmode&&i.energyconstitute(i.viewDate),!i.groupmode&&i.dailysensordetail(i.viewDate),i.groupmode&&i.energyeffectiverate(i.viewDate),i.groupmode&&i.projectdetail(i.viewDate)}),i.bindTD=function(){i.calendarData&&$("datetimepicker .datepicker-days table tbody td.day").each(function(){if(!/old|new/i.test(this.className)){var e=$(this),t=e.data("day");e.removeClass("em-up").removeClass("em-down").removeClass("em-keep"),i.calendarData.detail[t]&&e.addClass(i.calendarData.detail[t]>i.calendarData.average?"em-up":i.calendarData.detail[t]<i.calendarData.average?"em-down":"em-keep")}}),$("datetimepicker .datepicker-days table tbody td.active").click(function(){return!1})},i.calendar=function(a){e.business.calendar({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.ids,assemble:i.groupmode},function(e){e=i.groupmode?e.result:e.result[EMAPP.Project.current._id],i.calendarData=e||{},i.calendarData.detail=i.calendarData.detail,i.groupmode?i.calendarData.average=i.calendarData.buildingConsumption/(i.calendarData.detail&&Object.keys(i.calendarData.detail).length||0):i.calendarData.average=i.calendarData.buildingConsumption/(i.calendarData.detail&&i.calendarData.detail.length||0),angular.forEach(i.calendarData.detail,function(e,a){i.groupmode?this[t("date")(a,"yyyy-MM-dd")]=e:this[t("date")(e._id,"yyyy-MM-dd")]=e.value},i.calendarData.detail={}),i.bindTD()})},i.dailycost=function(a){e.business.dailycost({time:t("date")(a,"yyyyMMdd"),project:EMAPP.Project.ids,assemble:i.groupmode},function(e){e=i.groupmode?e.result||{}:e.result[EMAPP.Project.current._id]||{},e.cost=parseFloat(parseInt(e.cost).toFixed(2)),i.currentDayqoq=parseFloat(e.qoq.toFixed(2)),i.currentDayyoy=parseFloat(e.yoy.toFixed(2)),i.chart.dailycost={chart:{margin:[0,0,0,0],style:{textAlign:"center"},type:"pie"},title:{text:'<div class="pieTitle">今日费用</div><div class="pieNumber">'+e.cost+'<span class="pieUnit">元</span></div>',verticalAlign:"middle",useHTML:!0,y:-12},tooltip:!1,plotOptions:{pie:{dataLabels:!1,innerSize:"85%"}},series:[{data:[e.cost]}]}})},i.monthlykgce=function(a){e.business.monthlykgce({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.ids},function(e){var t=[],a=0,n=0,r=0;i.groupmode?(angular.forEach(e.result,function(e,t){this.push([EMAPP.Project[t].title,e.kgce]),a+=e.kgce,n+=e.kgceperunitarea,r+=e.kwhperunitarea},e.detail=[]),t.push({data:e.detail})):(e=e.result[EMAPP.Project.current._id]||{},angular.forEach(e.detail,function(e,t){this.push([t,e])},e.detail=[]),t.push({data:e.detail}),a=e.kgce,n=e.kgceperunitarea,r=e.kwhperunitarea),i.currentMonthKgceperunitarea=parseFloat(n.toFixed(2)),i.currentMonthKwhperunitarea=parseFloat(r.toFixed(2)),i.chart.monthlykgce={chart:{marginBottom:0,marginLeft:0,marginRight:140,marginTop:0,style:{textAlign:"center"},type:"pie"},title:{text:'<div class="pieTitle">月综合能耗</div><div class="pieNumber">'+parseFloat(a.toFixed(2))+'<span class="pieUnit">千克煤</span></div>',verticalAlign:"middle",useHTML:!0,x:-70,y:-12},tooltip:{pointFormat:" <b>{point.y}</b> 千克煤"},plotOptions:{pie:{dataLabels:!1,innerSize:"85%",showInLegend:!0}},legend:{verticalAlign:"middle",layout:"vertical",labelFormatter:function(){return'<div style="text-align:left;">'+Math.ceil(10*this.percentage)/10+"% "+this.name+'</div><div style="color:#BBB;text-align:left;">'+this.y+"KGce</div>"},itemWidth:100,useHTML:!0,x:140},series:t}})},i.energyconstitute=function(a){e.business.energyconstitute({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.current._id},function(e){var a=[],n=[];angular.forEach(e.result[EMAPP.Project.current._id]||{},function(e,t,i){Object.keys(e).length>a.length&&(i=0,a=[]),angular.forEach(e,function(e,t){this.push(e),0===i&&a.push(parseInt(t))},e=[]),n.push({data:e,name:t})}),i.chart.energyconstitute={chart:{type:"spline"},title:!1,xAxis:{type:"datetime",categories:a,labels:{formatter:function(){return t("date")(this.value,"M-dd")}}},yAxis:{title:!1},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y}元</span>'},series:n}})},i.dailysensordetail=function(a){e.business.dailysensordetail({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.current._id},function(e){e=e.result[EMAPP.Project.current._id]||{};var n=0;angular.forEach(e,function(e,t){this.push([t,e]),n+=100*e},e=[]),i.chart.dailysensordetail={chart:{marginBottom:0,marginLeft:0,marginRight:160,marginTop:0,style:{textAlign:"center"},type:"pie"},title:{text:'<div class="pieTitle">'+t("date")(a,"yyyy年MM月")+"能耗</div><div>"+n/100+"KWh</div>",verticalAlign:"middle",useHTML:!0,x:-80,y:-12},tooltip:{pointFormat:"<b>{point.y:.2f}kWh {point.percentage:.2f}%</b>"},plotOptions:{pie:{dataLabels:!1,innerSize:"85%",showInLegend:!0}},legend:{verticalAlign:"middle",layout:"vertical",labelFormatter:function(){return'<div style="text-align:left;">'+Math.ceil(10*this.percentage)/10+"% "+this.name+'</div><div style="color:#BBB;text-align:left;">'+(this.y&&this.y.toFixed(2)||0)+"kWh</div>"},itemWidth:100,useHTML:!0,x:160},series:[{data:e}]}})},i.energyeffectiverate=function(a){e.business.energyeffectiverate({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.ids,assemble:i.groupmode},function(e){var a=[],n=[];angular.forEach(e.result||{},function(e,t,i){Object.keys(e).length>a.length&&(i=0,a=[]),angular.forEach(e,function(e,t){this.push(parseFloat(e.value.toFixed(2))),0===i&&a.push(1e3*t)},e=[]),n.push({data:e,name:{now:"本月能效",yoy:"同期能效"}[t]||t})}),i.chart.energyeffectiverate={chart:{type:"spline"},title:!1,xAxis:{type:"datetime",categories:a,labels:{formatter:function(){return t("date")(this.value,"M-dd")}}},yAxis:{title:!1},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y}KWh</span>'},series:n}})},i.projectdetail=function(a){e.business.projectdetail({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.ids},function(e){angular.forEach(e.result,function(e){e.data=[0,0,0,0,0],e.data[e.ecslevel-1]=e.uaec,this.push({name:e.name,data:e.data})},e.series=[]),i.chart.projectdetail={chart:{type:"bar"},title:!1,xAxis:{categories:["0-1.8 KWh","1.8-3.8 KWh","3.8-5.7 KWh","5.7-7.7 KWh","7.7-∞ KWh"]},yAxis:{title:!1},tooltip:{valueSuffix:" KWh"},legend:{layout:"vertical",align:"right",verticalAlign:"bottom",y:-20,floating:!0,borderWidth:1},series:e.series}})}}]);