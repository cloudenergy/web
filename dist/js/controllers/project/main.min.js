EMAPP.templateCache.put("dist/html/project/main.min.html?rev=48fdcc9318",'<div class="app-view-project-main ng-cloak"><div class="row"><div class="col-sm-7"><div class="row"><div class="panel-heading"><span class="subTitle">能耗日历</span></div><div class="panel-body"><div class="subContent clearfix"><div class="col-sm-5" ng-include="\'dist/html/project/main/calendar.min.html?rev=a732941370\'"></div><div class="col-sm-7" ng-include="\'dist/html/project/main/dailycost.min.html?rev=2e19a8c29d\'"></div></div></div></div></div><div class="col-sm-5 content-right"><div class="row"><div class="panel-heading"><span class="subTitle">总能耗</span></div><div class="panel-body"><div class="subContent clearfix" ng-include="\'dist/html/project/main/monthlykgce.min.html?rev=925769e3c0\'"></div></div></div></div></div><div class="rate-content clearfix"><div ng-if="!self.groupuser" class="col-sm-7" ng-include="\'dist/html/project/main/energyconstitute.min.html?rev=e5faa3cd1c\'"></div><div ng-if="!self.groupuser" class="col-sm-5 content-right" ng-include="\'dist/html/project/main/dailysensordetail.min.html?rev=d8d0375147\'"></div><div ng-if="self.groupuser" class="col-sm-7" ng-include="\'dist/html/project/main/energyeffectiverate.min.html?rev=7ad8edf30d\'"></div><div ng-if="self.groupuser" class="col-sm-5 content-right" ng-include="\'dist/html/project/main/projectdetail.min.html?rev=95e5c8b52b\'"></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/calendar.min.html?rev=a732941370",'<div class="datetimepicker-component"><div class="datetimepicker-panel"><i></i><datetimepicker data-format="YYYY/MM/DD" data-inline="true"></datetimepicker></div><div class="datetimepicker-comment row panel-body text-center"><div class="col-sm-4"><div class="row"><i class="em-down"></i> 能耗下降</div></div><div class="col-sm-4"><div class="row"><i class="em-up"></i> 能耗上升</div></div><div class="col-sm-4"><div class="row"><i class="em-keep"></i> 能耗持平</div></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/dailycost.min.html?rev=2e19a8c29d",'<div class="row highcharts-component" ng-if="self.chart.dailycost"><div class="highcharts-today text-center">{{self.viewDate|date:\'yyyy-MM-dd\'}}</div><highcharts class="highcharts-panel text-center" config="self.chart.dailycost"></highcharts><div class="highcharts-comment row text-center"><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">环比费用</div><div class="unitAreaCounting">{{self.currentDayConsumptionPerArea}} <span class="unitAreaUnit">%</span></div></div></div><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">同比费用</div><div class="unitAreaCounting">{{self.currentDayElectricConsumptionPerArea}} <span class="unitAreaUnit">%</span></div></div></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/monthlykgce.min.html?rev=925769e3c0",'<div class="highcharts-component" ng-if="self.chart.monthlykgce"><div class="highcharts-today text-center">{{self.viewDate|date:\'yyyy-MM\'}}</div><highcharts class="highcharts-panel text-center" config="self.chart.monthlykgce"></highcharts><div class="highcharts-comment row text-center"><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">单位面积能耗</div><div class="unitAreaCounting">{{self.currentMonthConsumptionPerAcreage}} <span class="unitAreaUnit">kgce/m2</span></div></div></div><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">单位面积电耗</div><div class="unitAreaCounting">{{self.currentMonthElectricConsumptionPerAcreage}} <span class="unitAreaUnit">kWh/m2</span></div></div></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/energyconstitute.min.html?rev=e5faa3cd1c",'<div class="row"><div class="panel-heading"><span class="subTitle">水电气构成{{self.viewDate|date:\'（yyyy-MM）\'}}</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-line text-center" config="self.chart.energyconstitute"></highcharts></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/dailysensordetail.min.html?rev=d8d0375147",'<div class="row"><div class="panel-heading"><span class="subTitle">能耗细分</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-pie text-center" config="self.chart.dailysensordetail"></highcharts></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/energyeffectiverate.min.html?rev=7ad8edf30d",'<div class="row"><div class="panel-heading"><span class="subTitle">能效比{{self.viewDate|date:\'（yyyy-MM）\'}}</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-line text-center" config="self.chart.energyconstitute"></highcharts></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/projectdetail.min.html?rev=95e5c8b52b",'<div class="row"><div class="panel-heading"><span class="subTitle">节能星级</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-pie text-center" config="self.chart.dailysensordetail"></highcharts></div></div></div>'),EMAPP.register.controller("project.main",["$api","$filter","$timeout","Lines","Pies",function(e,t,a,i,n){var r=this;r.viewDate=new Date,r.chart={},r.groupuser=EMAPP.User.groupuser,a(function(e){e=$("datetimepicker").bind("dp.show",function(){a(function(){e.data("DateTimePicker").maxDate(new Date)})}).bind("dp.change",function(e){var a=angular.equals(e.date.format("YYYYMM"),t("date")(r.viewDate,"yyyyMM")),i=angular.equals(e.date.format("YYYYMMDD"),t("date")(r.viewDate,"yyyyMMdd"));i||(r.viewDate=e.date._d),a&&!i&&r.bindTD(),!a&&r.calendar(r.viewDate),!i&&r.dailycost(r.viewDate),!a&&r.monthlykgce(r.viewDate),!a&&!r.groupuser&&r.energyconstitute(r.viewDate),!a&&!r.groupuser&&r.dailysensordetail(r.viewDate),!a&&r.groupuser&&r.energyeffectiverate(r.viewDate),!a&&r.groupuser&&r.projectdetail(r.viewDate)}).bind("dp.update",function(a){angular.equals(a.viewDate.format("YYYYMM"),t("date")(r.viewDate,"yyyyMM"))?r.bindTD():e.data("DateTimePicker").maxDate(new Date).defaultDate(a.viewDate.format("YYYYMMDD")>t("date")(new Date,"yyyyMMdd")?new Date:a.viewDate._d)}),r.calendar(r.viewDate),r.dailycost(r.viewDate),r.monthlykgce(r.viewDate),!r.groupuser&&r.energyconstitute(r.viewDate),!r.groupuser&&r.dailysensordetail(r.viewDate),r.groupuser&&r.energyeffectiverate(r.viewDate),r.groupuser&&r.projectdetail(r.viewDate)}),r.bindTD=function(){r.calendarData&&$("datetimepicker .datepicker-days table tbody td.day").each(function(){if(!/old|new/i.test(this.className)){var e=$(this),t=e.data("day");e.removeClass("em-up").removeClass("em-down").removeClass("em-keep"),r.calendarData.detail[t]&&e.addClass(r.calendarData.detail[t]>r.calendarData.average?"em-up":r.calendarData.detail[t]<r.calendarData.average?"em-down":"em-keep")}}),$("datetimepicker .datepicker-days table tbody td.active").click(function(){return!1})},r.calendar=function(a){e.business.calendar({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.ids,assemble:r.groupuser},function(e){e=r.groupuser?e.result:e.result[EMAPP.Project.current._id],r.calendarData=e||{},r.calendarData.detail=r.calendarData.detail,r.groupuser?r.calendarData.average=r.calendarData.buildingConsumption/(r.calendarData.detail&&Object.keys(r.calendarData.detail).length||0):r.calendarData.average=r.calendarData.buildingConsumption/(r.calendarData.detail&&r.calendarData.detail.length||0),angular.forEach(r.calendarData.detail,function(e,a){r.groupuser?this[t("date")(a,"yyyy-MM-dd")]=e:this[t("date")(e._id,"yyyy-MM-dd")]=e.value},r.calendarData.detail={}),r.bindTD()})},r.dailycost=function(a){e.business.dailycost({time:t("date")(a,"yyyyMMdd"),project:EMAPP.Project.ids,assemble:r.groupuser},function(e){e=r.groupuser?e.result||{}:e.result[EMAPP.Project.current._id]||{},e.cost=parseInt(e.cost),r.currentDayConsumptionPerArea=e.qoq,r.currentDayElectricConsumptionPerArea=e.yoy,r.chart.dailycost=n({chart:{type:"pie",margin:[0,0,0,0],style:{textAlign:"center"}},titleObj:{text:'<div class="pieTitle">今日费用</div><div class="pieNumber">'+e.cost+'</div><div class="pieUnit">元</div>',verticalAlign:"middle",useHTML:!0,y:-26},series:[{type:"pie",data:[[EMAPP.Project.current.title,e.cost]]}],tooltip:{pointFormat:"<b>{point.y:.2f}元 {point.percentage:.2f}%</b>"},pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},innerSize:"85%",showInLegend:!1}})})},r.monthlykgce=function(a){e.business.monthlykgce({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.ids,assemble:r.groupuser},function(e){e=r.groupuser?e.result||{}:e.result[EMAPP.Project.current._id]||{},angular.forEach(e.detail,function(e,t){this.push([t,e])},e.detail=[]),r.currentMonthConsumptionPerAcreage=e.kgceperunitarea,r.currentMonthElectricConsumptionPerAcreage=e.kwhperunitarea,r.chart.monthlykgce=n({chart:{style:{textAlign:"center"}},titleObj:{text:'<div class="pieTitle">当月综合能耗</div><div class="pieNumber">'+e.kgce+'</div><div class="pieUnit">千克煤</div>',align:"center",verticalAlign:"middle",useHTML:!0,y:-20,x:-85},series:[{type:"pie",data:e.detail}],tooltip:{pointFormat:" <b>{point.y}</b> 千克煤"},pie:{dataLabels:{enabled:!1,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!0,innerSize:"85%"},legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginTop:2,itemMarginBottom:2,itemWidth:140,symbolWidth:10,symbolPadding:3,borderWidth:0,maxHeight:260,useHTML:!0,labelFormatter:function(){return'<div style="text-align:left;">'+this.name+" "+Math.ceil(10*this.percentage)/10+'%</div><div style="color: #BBBBBB; ">'+this.y+"KGce</div>"}}})})},r.energyconstitute=function(a){e.business.energyconstitute({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.current._id},function(e){e=e.result[EMAPP.Project.current._id]||{};var a=[];angular.forEach(e,function(e,t){a=[],angular.forEach(e,function(e,t){this.push(e),a.push(t)},e=[]),this.push({data:e,name:t})},e=[]),r.chart.energyconstitute=i({chart:{style:{textAlign:"center"}},legend:!0,type:"spline",series:e,xAxis:{categories:a,labels:{formatter:function(){return t("date")(this.value,"MM-dd")}}},tooltip:{xDateFormat:"%Y年%m月%d日",pointFormat:"<b>{series.name}: {point.y}元</b>"},plotOptions:{line:{stacking:"normal"}}})})},r.dailysensordetail=function(a){e.business.dailysensordetail({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.current._id},function(e){e=e.result[EMAPP.Project.current._id]||{};var i=0;angular.forEach(e,function(e,t){this.push([t,e]),i+=100*e},e=[]),r.chart.dailysensordetail=n({enableDataLabels:!1,innerSize:"90%",title:'<div class="pieTitle">'+t("date")(a,"yyyy年MM月")+"能耗</div><div>"+i/100+"KWh</div>",titleVerticalAlign:"middle",titleX:-107,titleY:-5,legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:10,itemWidth:100,symbolWidth:10,symbolPadding:3,width:200,labelFormatter:function(){var e=Math.ceil(10*this.percentage)/10,t=this.y&&this.y.toFixed(2)||0;return this.name+" "+e+"%<br/>"+t+"kWh "}},series:[{type:"pie",data:e}],tooltip:{pointFormat:"<b>{point.y:.2f}kWh {point.percentage:.2f}%</b>"}})})},r.energyeffectiverate=function(a){e.business.energyeffectiverate({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.ids},function(e){e=e.result[EMAPP.Project[1]._id]||{};var a=[];angular.forEach(e,function(e,t){a=[],angular.forEach(e,function(e,t){this.push(e),a.push(t)},e=[]),this.push({data:e,name:t})},e=[]),r.chart.energyeffectiverate=i({chart:{style:{textAlign:"center"}},legend:!0,type:"spline",series:e,xAxis:{categories:a,labels:{formatter:function(){return t("date")(this.value,"MM-dd")}}},tooltip:{xDateFormat:"%Y年%m月%d日",pointFormat:"<b>{series.name}: {point.y}元</b>"},plotOptions:{line:{stacking:"normal"}}})})},r.projectdetail=function(a){e.business.projectdetail({time:t("date")(a,"yyyyMM"),project:EMAPP.Project.ids},function(e){})}}]);