EMAPP.templateCache.put("dist/html/project/main.min.html?rev=f07d3fee85",'<div class="app-view-project-main ng-cloak"><div class="row"><div class="col-sm-7"><div class="row"><div class="panel-heading"><span class="subTitle">能耗日历</span></div><div class="panel-body"><div class="subContent clearfix"><div class="col-sm-5" ng-include="\'dist/html/project/main/calendar.min.html?rev=a732941370\'"></div><div class="col-sm-7" ng-include="\'dist/html/project/main/dailycost.min.html?rev=c44937a1c4\'"></div></div></div></div></div><div class="col-sm-5 content-right"><div class="row"><div class="panel-heading"><span class="subTitle">总能耗</span></div><div class="panel-body"><div class="subContent clearfix" ng-include="\'dist/html/project/main/monthlykgce.min.html?rev=a33187919b\'"></div></div></div></div></div><div class="rate-content clearfix"><div class="col-sm-7" ng-include="\'dist/html/project/main/energyconstitute.min.html?rev=46ac0a94d7\'"></div><div class="col-sm-5 content-right" ng-include="\'dist/html/project/main/dailysensordetail.min.html?rev=126098232f\'"></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/calendar.min.html?rev=a732941370",'<div class="datetimepicker-component"><div class="datetimepicker-panel"><i></i><datetimepicker data-format="YYYY/MM/DD" data-inline="true"></datetimepicker></div><div class="datetimepicker-comment row panel-body text-center"><div class="col-sm-4"><div class="row"><i class="em-down"></i> 能耗下降</div></div><div class="col-sm-4"><div class="row"><i class="em-up"></i> 能耗上升</div></div><div class="col-sm-4"><div class="row"><i class="em-keep"></i> 能耗持平</div></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/dailycost.min.html?rev=c44937a1c4",'<div class="row highcharts-component" ng-if="self.chartPies"><div class="highcharts-today text-center">{{self.viewDate|date:\'yyyy-MM-dd\'}}</div><highcharts class="highcharts-panel text-center" config="self.chartPies"></highcharts><div class="highcharts-comment row text-center"><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">环比费用</div><div class="unitAreaCounting">{{self.currentDayConsumptionPerArea}} <span class="unitAreaUnit">%</span></div></div></div><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">同比费用</div><div class="unitAreaCounting">{{self.currentDayElectricConsumptionPerArea}} <span class="unitAreaUnit">%</span></div></div></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/monthlykgce.min.html?rev=a33187919b",'<div class="highcharts-component" ng-if="self.monthlyEnergyConsumption"><div class="highcharts-today text-center">{{self.viewDate|date:\'yyyy-MM\'}}</div><highcharts class="highcharts-panel text-center" config="self.monthlyEnergyConsumption"></highcharts><div class="highcharts-comment row text-center"><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">单位面积能耗</div><div class="unitAreaCounting">{{self.currentMonthConsumptionPerAcreage}} <span class="unitAreaUnit">kgce/m2</span></div></div></div><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">单位面积电耗</div><div class="unitAreaCounting">{{self.currentMonthElectricConsumptionPerAcreage}} <span class="unitAreaUnit">kWh/m2</span></div></div></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/energyconstitute.min.html?rev=46ac0a94d7",'<div class="row"><div class="panel-heading"><span class="subTitle">水电气构成{{self.viewDate|date:\'（yyyy-MM）\'}}</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-line text-center" config="self.datapoints"></highcharts></div></div></div>'),EMAPP.templateCache.put("dist/html/project/main/dailysensordetail.min.html?rev=126098232f",'<div class="row"><div class="panel-heading"><span class="subTitle">能耗细分</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-pie text-center" config="self.customerPies"></highcharts></div></div></div>'),EMAPP.register.controller("project.main",["$api","$filter","$timeout","Lines","Pies",function(t,e,i,a,n){var r=this;i(function(t){t=$("datetimepicker").bind("dp.show",function(){i(function(){t.data("DateTimePicker").maxDate(new Date)})}).bind("dp.change",function(t){var i=angular.equals(t.date.format("YYYYMM"),e("date")(r.viewDate,"yyyyMM")),a=angular.equals(t.date.format("YYYYMMDD"),e("date")(r.viewDate,"yyyyMMdd"));a||(r.viewDate=t.date._d),i&&!a&&r.bindTD(),!i&&r.calendar(r.viewDate),!a&&r.dailycost(r.viewDate),!i&&r.monthlykgce(r.viewDate),!i&&r.energyconstitute(r.viewDate),!i&&r.dailysensordetail(r.viewDate)}).bind("dp.update",function(i){angular.equals(i.viewDate.format("YYYYMM"),e("date")(r.viewDate,"yyyyMM"))?r.bindTD():t.data("DateTimePicker").maxDate(new Date).defaultDate(i.viewDate.format("YYYYMMDD")>e("date")(new Date,"yyyyMMdd")?new Date:i.viewDate._d)})}),r.bindTD=function(){r.calendarData&&$("datetimepicker .datepicker-days table tbody td.day").each(function(){if(!/old|new/i.test(this.className)){var t=$(this),e=t.data("day");t.removeClass("em-up").removeClass("em-down").removeClass("em-keep"),r.calendarData.detail[e]&&t.addClass(r.calendarData.detail[e]>r.calendarData.average?"em-up":r.calendarData.detail[e]<r.calendarData.average?"em-down":"em-keep")}}),$("datetimepicker .datepicker-days table tbody td.active").click(function(){return!1})},r.calendar=function(i){t.business.calendar({time:e("date")(i,"yyyyMM"),project:EMAPP.Project.current._id},function(t){r.calendarData=t.result&&t.result[EMAPP.Project.current._id]||{},r.calendarData.detail=r.calendarData.detail||[],r.calendarData.average=r.calendarData.buildingConsumption/r.calendarData.detail.length,angular.forEach(r.calendarData.detail,function(t){this[e("date")(t._id,"yyyy-MM-dd")]=t.value},r.calendarData.detail={}),r.bindTD()})},r.dailycost=function(i){t.business.dailycost({time:e("date")(i,"yyyyMMdd"),project:EMAPP.Project.current._id},function(t){t=t.result[EMAPP.Project.current._id]||{},t.cost=parseInt(t.cost),r.currentDayConsumptionPerArea=t.qoq,r.currentDayElectricConsumptionPerArea=t.yoy,r.chartPies=n({chart:{type:"pie",margin:[0,0,0,0],style:{textAlign:"center"}},titleObj:{text:'<div class="pieTitle">今日费用</div><div class="pieNumber">'+t.cost+'</div><div class="pieUnit">元</div>',verticalAlign:"middle",useHTML:!0,y:-26},series:[{type:"pie",data:[[EMAPP.Project.current.title,t.cost]]}],tooltip:{pointFormat:"<b>{point.y:.2f}元 {point.percentage:.2f}%</b>"},pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},innerSize:"90%",showInLegend:!1}})})},r.monthlykgce=function(i){t.business.monthlykgce({time:e("date")(i,"yyyyMM"),project:EMAPP.Project.current._id},function(t){t=t.result[EMAPP.Project.current._id]||{},angular.forEach(t.detail,function(t,e){this.push([e,t])},t.detail=[]),r.currentMonthConsumptionPerAcreage=t.kgceperunitarea,r.currentMonthElectricConsumptionPerAcreage=t.kwhperunitarea,r.monthlyEnergyConsumption=n({chart:{style:{textAlign:"center"}},titleObj:{text:'<div class="pieTitle">当月综合能耗</div><div class="pieNumber">'+t.kgce+'</div><div class="pieUnit">千克煤</div>',align:"center",verticalAlign:"middle",useHTML:!0,y:-20,x:-85},series:[{type:"pie",data:t.detail}],tooltip:{pointFormat:" <b>{point.y}</b> 千克煤"},pie:{dataLabels:{enabled:!1,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!0,innerSize:140},legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginTop:2,itemMarginBottom:2,itemWidth:140,symbolWidth:10,symbolPadding:3,borderWidth:0,maxHeight:260,useHTML:!0,labelFormatter:function(){return'<div style="text-align:left;">'+this.name+" "+Math.ceil(10*this.percentage)/10+'%</div><div style="color: #BBBBBB; ">'+this.y+"KGce</div>"}}})})},r.energyconstitute=function(i){t.business.energyconstitute({time:e("date")(i,"yyyyMM"),project:EMAPP.Project.current._id},function(t){t=t.result[EMAPP.Project.current._id]||{};var i=[];angular.forEach(t,function(t,e){i=[],angular.forEach(t,function(t,e){this.push(t),i.push(e)},t=[]),this.push({data:t,name:e})},t=[]),r.datapoints=a({chart:{style:{textAlign:"center"}},title:{text:"本月能耗费用",style:{color:"#FFF",fontSize:"18px"}},legend:!0,type:"spline",series:t,xAxis:{categories:i,labels:{formatter:function(){return e("date")(this.value,"MM-dd")}}},tooltip:{xDateFormat:"%Y年%m月%d日",pointFormat:"<b>{series.name}: {point.y}元</b>"},plotOptions:{line:{stacking:"normal"}}})})},r.dailysensordetail=function(i){t.business.dailysensordetail({time:e("date")(i,"yyyyMM"),project:EMAPP.Project.current._id},function(t){t=t.result[EMAPP.Project.current._id]||{};var a=0;angular.forEach(t,function(t,e){this.push([e,t]),a+=100*t},t=[]),r.customerPies=n({enableDataLabels:!1,innerSize:"90%",title:'<div class="pieTitle">'+e("date")(i,"yyyy年MM月")+"能耗</div><div>"+a/100+"KWh</div>",titleVerticalAlign:"middle",titleX:-107,titleY:-5,legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:10,itemWidth:100,symbolWidth:10,symbolPadding:3,width:200,labelFormatter:function(){var t=Math.ceil(10*this.percentage)/10,e=this.y&&this.y.toFixed(2)||0;return this.name+" "+t+"%<br/>"+e+"kWh "}},series:[{type:"pie",data:t}],tooltip:{pointFormat:"<b>{point.y:.2f}kWh {point.percentage:.2f}%</b>"}})})}}]);