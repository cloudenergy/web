EMAPP.templateCache.put("dist/html/project/main.min.html?rev=e141c3f1ca",'<div ng-controller="project.main as self" class="app-view-project-main ng-cloak"><div class="row"><div class="col-sm-7"><div class="row"><div class="panel-heading"><span class="subTitle">能耗日历</span></div><div class="panel-body"><div class="subContent clearfix"><div class="col-sm-5"><div class="datetimepicker-component"><div class="datetimepicker-panel"><i></i><datetimepicker data-format="YYYY/MM/DD" data-inline="true"></datetimepicker></div><div class="datetimepicker-comment row panel-body text-center"><div class="col-sm-4"><div class="row"><i class="em-down"></i> 能耗下降</div></div><div class="col-sm-4"><div class="row"><i class="em-up"></i> 能耗上升</div></div><div class="col-sm-4"><div class="row"><i class="em-keep"></i> 能耗持平</div></div></div></div></div><div class="col-sm-7"><div class="row highcharts-component" ng-if="self.chartPies"><div class="highcharts-today text-center">{{self.viewDate|date:\'yyyy-MM-dd\'}}</div><highcharts class="highcharts-panel text-center" config="self.chartPies"></highcharts><div class="highcharts-comment row text-center"><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">环比费用</div><div class="unitAreaCounting">{{self.currentDayConsumptionPerArea}} <span class="unitAreaUnit">%</span></div></div></div><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">同比费用</div><div class="unitAreaCounting">{{self.currentDayElectricConsumptionPerArea}} <span class="unitAreaUnit">%</span></div></div></div></div></div></div></div></div></div></div><div class="col-sm-5 content-right"><div class="row"><div class="panel-heading"><span class="subTitle">总能耗</span></div><div class="panel-body"><div class="subContent clearfix"><div class="highcharts-component" ng-if="self.monthlyEnergyConsumption"><div class="highcharts-today text-center">{{self.viewDate|date:\'yyyy-MM\'}}</div><highcharts class="highcharts-panel text-center" config="self.monthlyEnergyConsumption"></highcharts><div class="highcharts-comment row text-center"><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">单位面积能耗</div><div class="unitAreaCounting">{{self.currentMonthConsumptionPerAcreage}} <span class="unitAreaUnit">kgce/m2</span></div></div></div><div class="col-sm-6"><div class="row"><div class="unitAreaTitle">单位面积电耗</div><div class="unitAreaCounting">{{self.currentMonthElectricConsumptionPerAcreage}} <span class="unitAreaUnit">kWh/m2</span></div></div></div></div></div></div></div></div></div></div><div class="rate-content clearfix"><div class="col-sm-7"><div class="row"><div class="panel-heading"><span class="subTitle">水电气构成</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-line text-center" config="self.datapoints"></highcharts></div></div></div></div><div class="col-sm-5 content-right"><div class="row"><div class="panel-heading"><span class="subTitle">能耗细分</span></div><div class="panel-body"><div class="subContent clearfix"><highcharts class="highcharts-panel highcharts-pie text-center" config="self.customerPies"></highcharts></div></div></div></div></div></div>'),EMAPP.register.controller("project.main",["$filter","$timeout","$api","Pies","Lines",function(e,t,i,a,n){var r=this,o=new Date,l=$("datetimepicker"),c=function(){var e=0;r.calendarData&&$("datetimepicker .datepicker-days table tbody td.day").each(function(){/old|new/i.test(this.className)||r.calendarData.detail[e]&&($(this).removeClass("em-up").removeClass("em-down").removeClass("em-keep"),$(this).addClass(r.calendarData.detail[e].value>r.calendarData.average?"em-up":r.calendarData.detail[e].value<r.calendarData.average?"em-down":"em-keep"),e++)}),$("datetimepicker .datepicker-days table tbody td.active").click(function(){return!1})},d={calendar:function(t){i.business.calendar({time:e("date")(t,"yyyyMM"),project:EMAPP.Project.current._id},function(e){r.calendarData=e.result&&e.result[EMAPP.Project.current._id]||{},r.calendarData.detail=r.calendarData.detail||[],r.calendarData.average=r.calendarData.buildingConsumption/r.calendarData.detail.length,c()})},daily:function(t){i.business.dailycost({time:e("date")(t,"yyyyMMdd"),project:EMAPP.Project.current._id},function(e){e=e.result[EMAPP.Project.current._id]||{},e.cost=parseInt(e.cost),r.currentDayConsumptionPerArea=e.qoq,r.currentDayElectricConsumptionPerArea=e.yoy,r.chartPies=a({chart:{type:"pie",margin:[0,0,0,0],style:{textAlign:"center"}},titleObj:{text:'<div class="pieTitle">今日费用</div><div class="pieNumber">'+e.cost+'</div><div class="pieUnit">元</div>',verticalAlign:"middle",useHTML:!0,y:-26},series:[{type:"pie",data:[[EMAPP.Project.current.title,e.cost]]}],tooltip:{pointFormat:"<b>{point.y:.2f}元 {point.percentage:.2f}%</b>"},pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},innerSize:"90%",showInLegend:!1,point:{events:{click:function(e){}}}}})})},month:function(t){i.business.monthlykgce({time:e("date")(t,"yyyyMM"),project:EMAPP.Project.current._id},function(e){e=e.result[EMAPP.Project.current._id]||{},angular.forEach(e.detail,function(e,t){this.push([t,e])},e.detail=[]),r.currentMonthConsumptionPerAcreage=e.kgceperunitarea,r.currentMonthElectricConsumptionPerAcreage=e.kwhperunitarea,r.monthlyEnergyConsumption=a({chart:{style:{textAlign:"center"}},titleObj:{text:'<div class="pieTitle">当月综合能耗</div><div class="pieNumber">'+e.buildingarea+'</div><div class="pieUnit">千克煤</div>',align:"center",verticalAlign:"middle",useHTML:!0,y:-20,x:-85},series:[{type:"pie",data:e.detail}],tooltip:{pointFormat:" <b>{point.y}</b> 千克煤"},pie:{dataLabels:{enabled:!1,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!0,innerSize:140},legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginTop:2,itemMarginBottom:2,itemWidth:140,symbolWidth:10,symbolPadding:3,borderWidth:0,maxHeight:260,useHTML:!0,labelFormatter:function(){var e=Math.ceil(10*this.percentage)/10;return'<div style="text-align:left;">'+this.name+" "+e+'%</div><div style="color: #BBBBBB; ">'+this.y+"KGce</div>"}}})}),i.business.energyconstitute({time:e("date")(t,"yyyyMM"),project:EMAPP.Project.current._id},function(t){t=t.result[EMAPP.Project.current._id]||{};var i=[];angular.forEach(t,function(e,t){i=[],angular.forEach(e,function(e,t){this.push(e),i.push(t)},e=[]),this.push({data:e,name:t})},t=[]),r.datapoints=n({chart:{style:{textAlign:"center"}},title:{text:"本月能耗费用",style:{color:"#FFF",fontSize:"18px"}},legend:!0,type:"spline",series:t,xAxis:{categories:i,labels:{formatter:function(){return e("date")(this.value,"MM-dd")}}},tooltip:{xDateFormat:"%Y年%m月%d日",pointFormat:"<b>{series.name}: {point.y}元</b>"},plotOptions:{line:{stacking:"normal",point:{events:{click:function(e){console.log("events.click")}}}}},chartevents:{click:function(e){console.log("$window.open")}}})}),i.business.dailysensordetail({time:e("date")(t,"yyyyMM"),project:EMAPP.Project.current._id},function(t){t=t.result[EMAPP.Project.current._id]||{};var i=733,n=[],o='<div class="pieTitle">'+e("date")(new Date,"MM月dd日")+"能耗</div><div>"+i+"KWh</div>";angular.forEach(t,function(e,t){this.push([t,e])},n),r.customerPies=a({enableDataLabels:!1,innerSize:"90%",title:o,titleVerticalAlign:"middle",titleX:-107,titleY:-5,legend:{align:"right",verticalAlign:"middle",layout:"vertical",itemMarginBottom:10,itemWidth:100,symbolWidth:10,symbolPadding:3,width:200,labelFormatter:function(){var e=Math.ceil(10*this.percentage)/10,t=this.y&&this.y.toFixed(2)||0;return this.name+" "+e+"%<br/>"+t+"kWh "}},series:[{type:"pie",data:n}],tooltip:{pointFormat:"<b>{point.y:.2f}kWh {point.percentage:.2f}%</b>"}})})}};return r.viewDate=new Date,l.on("dp.show",function(e){t(function(){l.data("DateTimePicker").maxDate(r.viewDate)}),d.calendar(r.viewDate),d.daily(r.viewDate),d.month(r.viewDate)}).on("dp.change",function(t){var i=t.date.format("YYYYMM")===e("date")(r.viewDate,"yyyyMM"),a=t.date.format("YYYYMMDD")===e("date")(r.viewDate,"yyyyMMdd");r.viewDate=t.date._d,i&&!a&&(d.daily(r.viewDate),c()),i||(d.calendar(r.viewDate),d.daily(r.viewDate),d.month(r.viewDate))}).on("dp.update",function(t){t.viewDate.format("YYYYMM")===e("date")(r.viewDate,"yyyyMM")?c():(o=new Date,l.data("DateTimePicker").maxDate(o),l.data("DateTimePicker").defaultDate(t.viewDate.format("YYYYMMDD")>e("date")(o,"yyyyMMdd")?o:t.viewDate._d))}),r}]);