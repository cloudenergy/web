EMAPP.templateCache.put("dist/html/project/statistic.min.html?rev=d532c00f12",'<div class="app-view-project-statistic"><p class="text-right text-info"><i class="em em-light-empty"></i><small><strong>提示：</strong>可手动拖动调整列宽</small></p><ul class="nav nav-tabs ng-cloak"><li ng-repeat="(key,name) in self.tabs" ng-class="{active:self.tabActive===key}"><a href="#report" data-toggle="tab" ng-click="self.tabClick(key)" ng-bind="name"></a></li><li class="pull-right navbar form-inline"><div class="input-group"><div class="btn-group btn-group-sm"><button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"><span ng-bind="self.energyData.selected.title||\'全部\'">全部</span> <span class="caret"></span></button><ul class="dropdown-menu"><li ng-class="{active:!self.energyData.selected}" ng-click="self.energyData.selected=null;self.report(self.tabActive)"><a href="javascript:void(0)">全部</a></li><li ng-repeat="item in self.energyData" ng-class="{active:self.energyData.selected.id===item.id}" ng-click="self.energyData.selected=item;self.report(self.tabActive)"><a href="javascript:void(0)" ng-bind="item.title"></a></li></ul></div></div><div class="form-group form-group-sm has-feedback date"><input type="text" class="form-control" id="start_date" ng-model="self.startDate" datetimepicker="" required=""> <i class="em em-calendar form-control-feedback"></i></div><div class="input-group" ng-show="self.tabActive===\'settlereport\'">至</div><div class="form-group form-group-sm has-feedback date" ng-show="self.tabActive===\'settlereport\'"><input type="text" class="form-control" id="end_date" ng-model="self.endDate" datetimepicker="" data-use-current="false" required=""> <i class="em em-calendar form-control-feedback"></i></div><div class="input-group btn-group btn-group-sm ng-hide" ng-show="self.tabActive===\'dailyreport\'"><a class="btn btn-info" href="javascript:void(0)" ng-class="{active:self.grid_timetype_current===\'usage\'}" ng-click="self.grid_timetype(\'usage\')">用量 <i class="em em-curve-area"></i></a> <a class="btn btn-info" href="javascript:void(0)" ng-class="{active:self.grid_timetype_current===\'scale\'}" ng-click="self.grid_timetype(\'scale\')">刻度 <i class="em em-line-spacing"></i></a></div><div class="input-group btn-group-sm"><button type="button" class="btn btn-info" ng-click="self.toggleFiltering()">筛选<i class="em em-filter"></i></button></div><div class="input-group btn-group-sm"><button type="button" class="btn btn-info" ng-click="self.export()">导出<i class="em em-export-excel"></i></button></div></li></ul><div class="tab-content ng-cloak"><div class="tab-pane subContent active" id="report"><div ui-grid="self.gridOptions" class="grid" ui-grid-auto-resize="" ui-grid-exporter="" ui-grid-move-columns="" ui-grid-resize-columns=""></div></div></div></div>'),EMAPP.register.controller("project.statistic",["$api","$filter","$timeout","i18nService","uiGridConstants",function(e,t,a,i,r){!function l(){$("#report").length&&$("#report").height($(window).height()-$("#report").offset().top-15),!arguments.length&&$(window).resize(l)}();var n=this,o=new Date,d=$("#start_date"),s=$("#end_date");return d.on("dp.change",function(e){a(function(){if(e.date&&e.oldDate){var t={settlereport:"YYYYMMDD",monthlyreport:"YYYYMM",dailyreport:"YYYYMMDD"}[n.tabActive],a=e.oldDate.format(t),i=e.date.format(t);i!==a&&n.report(n.tabActive)}s.data("DateTimePicker").minDate(e.date)})}),s.on("dp.change",function(e){a(function(){if(e.date&&e.oldDate){var t={settlereport:"YYYYMMDD",monthlyreport:"YYYYMM",dailyreport:"YYYYMMDD"}[n.tabActive],a=e.oldDate.format(t),i=e.date.format(t);i!==a&&n.report(n.tabActive)}d.data("DateTimePicker").maxDate(e.date)})}),n.startDate=t("date")(o,"yyyy-MM-")+"01",n.endDate=t("date")(o,"yyyy-MM-dd"),e.energy.info({project:EMAPP.Project.current._id},function(e){angular.forEach(e.result.energy||{},function(e){this.push(e)},n.energyData=[])}),i.add("zh-cn",{headerCell:{aria:{defaultFilterLabel:"列过滤器",removeFilter:"移除过滤器",columnMenuButtonLabel:"列菜单"},priority:"优先级:",filterLabel:"列过滤器: "},aggregate:{label:"行"},groupPanel:{description:"拖曳表头到此处进行分组"},search:{placeholder:"查找",showingItems:"已显示行数：",selectedItems:"已选择行数：",totalItems:"总行数：",size:"每页显示行数：",first:"首页",next:"下一页",previous:"上一页",last:"末页"},menu:{text:"选择列："},sort:{ascending:"升序",descending:"降序",none:"无序",remove:"取消排序"},column:{hide:"隐藏列"},aggregation:{count:"计数：",sum:"求和：",avg:"均值：",min:"最小值：",max:"最大值："},pinning:{pinLeft:"左侧固定",pinRight:"右侧固定",unpin:"取消固定"},columnMenu:{close:"关闭"},gridMenu:{aria:{buttonLabel:"表格菜单"},columns:"列：",importerTitle:"导入文件",exporterAllAsCsv:"导出全部数据到CSV",exporterVisibleAsCsv:"导出可见数据到CSV",exporterSelectedAsCsv:"导出已选数据到CSV",exporterAllAsPdf:"导出全部数据到PDF",exporterVisibleAsPdf:"导出可见数据到PDF",exporterSelectedAsPdf:"导出已选数据到PDF",clearAllFilters:"清除所有过滤器"},importer:{noHeaders:"无法获取列名，确定文件包含表头？",noObjects:"无法获取数据，确定文件包含数据？",invalidCsv:"无法处理文件，确定是合法的CSV文件？",invalidJson:"无法处理文件，确定是合法的JSON文件？",jsonNotArray:"导入的文件不是JSON数组！"},pagination:{aria:{pageToFirst:"第一页",pageBack:"上一页",pageSelected:"当前页",pageForward:"下一页",pageToLast:"最后一页"},sizes:"行每页",totalItems:"行",through:"至",of:"共"},grouping:{group:"分组",ungroup:"取消分组",aggregate_count:"合计: 计数",aggregate_sum:"合计: 求和",aggregate_max:"合计: 最大",aggregate_min:"合计: 最小",aggregate_avg:"合计: 平均",aggregate_remove:"合计: 移除"}}),i.setCurrentLang("zh-cn"),n.toggleFiltering=function(){n.gridOptions.enableFiltering=!n.gridOptions.enableFiltering,n.gridApi.core.notifyDataChange(r.dataChange.COLUMN)},n["export"]=function(){switch(n.tabActive){case"settlereport":n.gridOptions.exporterCsvFilename=n.tabActive+"_"+n.startDate.replace(/\-/g,"")+"_"+n.endDate.replace(/\-/g,"")+".csv";break;case"monthlyreport":n.gridOptions.exporterCsvFilename=n.tabActive+"_"+n.startDate.replace(/\-/g,"")+".csv";break;case"dailyreport":n.gridOptions.exporterCsvFilename=n.tabActive+"_"+n.startDate.replace(/\-/g,"")+".csv"}n.gridApi.exporter.csvExport("visible","visible",angular.element(document.querySelectorAll(".subContent")))},(n.grid_timetype=function(e){n.grid_timetype_current=e,n.rebuildData&&n.rebuildData(n.gridOptions.data)})("usage"),n.rebuildData=function(e){"monthlyreport"===n.tabActive&&angular.forEach(e,function(e){var t=0;angular.forEach(e.detail,function(a){t++,e["day"+t]=a})}),"dailyreport"===n.tabActive&&angular.forEach(e,function(e){var t=0;angular.forEach(e[n.grid_timetype_current],function(a){e["hour"+t]=a,t++})}),n.gridOptions.data=e},n.gridOptions={onRegisterApi:function(e){n.gridApi=e},enableColumnResizing:!0,exporterOlderExcelCompatibility:!0},n.tabs={settlereport:"结算报表",monthlyreport:"月报表",dailyreport:"日报表"},n.tabClick=function(e){if(n.tabActive=e,d.data("DateTimePicker"))switch(d.data("DateTimePicker").format({settlereport:"YYYY-MM-DD",monthlyreport:"YYYY-MM",dailyreport:"YYYY-MM-DD"}[e]).viewMode({settlereport:"days",monthlyreport:"months",dailyreport:"days"}[e]),e){case"settlereport":case"dailyreport":n.startDate=d.data("DateTimePicker").date().format("YYYY-MM-DD");break;case"monthlyreport":n.startDate=d.data("DateTimePicker").date().format("YYYY-MM")}n.report(e)},n.report=function(t){var a={project:[{id:EMAPP.Project.current._id,energy:n.energyData&&n.energyData.selected&&n.energyData.selected.id||""}]};switch(t){case"settlereport":a.from=n.startDate.replace(/\-/g,""),a.to=n.endDate.replace(/\-/g,"");break;case"monthlyreport":case"dailyreport":a.time=n.startDate.replace(/\-/g,"")}e.business[t](a,function(e){switch(e=e.result[EMAPP.Project.current._id]||[],t){case"settlereport":n.gridOptions.columnDefs=[{displayName:"传感器名称",name:"name",width:"*",minWidth:160},{displayName:"能耗分类",name:"energy",width:"*",minWidth:100},{displayName:n.startDate,name:"min.toFixed(2)",width:"*",minWidth:100},{displayName:n.endDate,name:"max.toFixed(2)",width:"*",minWidth:100},{displayName:"能耗总值",name:"sum.toFixed(2)",width:"*",minWidth:100},{displayName:"单价",name:"price",width:"*",minWidth:100},{displayName:"费用",name:"cost.toFixed(2)",width:"*",minWidth:100}];break;case"monthlyreport":if(n.gridOptions.columnDefs=[{displayName:"传感器名称",name:"name",width:"*",minWidth:160},{displayName:"能耗分类",name:"energy",width:"*",minWidth:100},{displayName:"月能耗",name:"monthlySum.toFixed(2)",width:"*",minWidth:100},{displayName:"日平均",name:"dailyAvg.toFixed(2)",width:"*",minWidth:100}],e.length){var a=0;angular.forEach(e[0].detail,function(e,t){a++,this.push({displayName:a+"号",name:"day"+a+".toFixed(2)",width:"*",minWidth:100})},n.gridOptions.columnDefs)}break;case"dailyreport":if(n.gridOptions.columnDefs=[{displayName:"传感器名称",name:"name",width:"*",minWidth:160},{displayName:"能耗分类",name:"energy",width:"*",minWidth:100},{displayName:"日能耗",name:"dailysum.toFixed(2)",width:"*",minWidth:100}],e.length){var a=0;angular.forEach(e[0].usage,function(e,t){this.push({displayName:a+"时",name:"hour"+a+".toFixed(2)",width:"*",minWidth:100}),a++},n.gridOptions.columnDefs)}}n.rebuildData(e)})},n.tabClick("settlereport"),n}]);