window.EMAPP=angular.module("EMAPP",["ngCookies","ngResource","ngSanitize","ngMd5","ui.router"]).run(["$templateCache",function(e){EMAPP.templateCache=e}]).config(["$controllerProvider","$compileProvider","$filterProvider","$provide","$httpProvider","$locationProvider","$stateProvider",function(e,t,r,n,o,a,s){EMAPP.register={controller:e.register,directive:t.directive,filter:r.register,provider:n.provider,constant:n.constant,value:n.value,factory:n.factory,service:n.service},a.html5Mode(!0),o.interceptors.push(["$q","$location","$cookies","SweetAlert","viewMask",function(e,t,r,n,o){var a=/cloudenergy\.me/.test(location.hostname)?".cloudenergy.me":location.hostname,s=function(e,s){return o.close(),e.config&&(90000005===e.data.code?(EMAPP.User={},angular.forEach(["token","user"],function(e){r.remove(e,{path:"/"}),r.remove(e,{path:"/",domain:a}),r.remove(e,{path:"/",domain:".www"+a})}),t.url("/dashboard/login"),e.data.message&&n.warning(e.data.message)):e.data.message&&n[s?"error":"success"](e.data.message)),e};return{request:function(e){return o.open(),e.url&&/\/api\//i.test(e.url)&&e.method&&(delete(e.data||e.params||{})._api_action,e.url=decodeURIComponent(e.url)),e},requestError:function(t){return e.reject(t)},response:function(e){return s(e)},responseError:function(t){return e.reject(s(t,!0))}}}]),n.service("lazyLoad",["$q","$timeout","viewMask",function(e,t,r){this.cache={},this.css=function(n){var o,a,s=this.cache,i=e.defer(),c=[],u=navigator.userAgent;return"boolean"==typeof arguments[1]?(o=arguments[2],a=arguments[1]):(o=arguments[1],a=arguments[2]),angular.forEach(n instanceof Array?n:[n],function(r,n,o){n=s[r]||e.defer(),c.push(n.promise),s[r]||(o=document.createElement("link"),o.rel="stylesheet",a?s[r]=n:o.className="lazyLoad-stylesheet",/(?:Android);?[\s\/]+([\d.]+)?/i.test(u)||/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/i.test(u)?!function i(e,r){if(/webkit/i.test(u))o.sheet&&(r=!0);else if(o.sheet)try{o.sheet.cssRules&&(r=!0)}catch(a){("SecurityError"===a.name||1e3===a.code)&&(r=!0)}r||e>=200?n.resolve():t(function(){i(e+1)},10)}(0):o[document.addEventListener?"onload":"onreadystatechange"]=function(e,t){(t||!o.readyState||/loaded|complete/.test(o.readyState))&&n.resolve()},o.onerror=function(){n.reject(r)},o.setAttribute("charset","utf-8"),o.href=r,(document.head||document.getElementsByTagName("head")[0]).appendChild(o))}),r.open(),e.all(c).then(function(){(o||angular.noop)(),t(i.resolve),r.close()},function(){t(i.reject),r.close(),console.error("lazyLoad-css-error:",arguments[0])}),i.promise},this.js=function(n){var o=this.cache,a=e.defer(),s=[],i=[],c=arguments[1];return angular.forEach(n instanceof Array?n:[n],function(t,r,n){r=o[t]||e.defer(),s.push(r.promise),o[t]||(o[t]=r,i.push(t))}),function u(e,t,r){(r=i[e])&&(t=document.createElement("script"),t[document.addEventListener?"onload":"onreadystatechange"]=function(n,a){(a||!t.readyState||/loaded|complete/.test(t.readyState))&&(document.body.removeChild(t),o[r].resolve(),u(e+1))},t.onerror=function(){o[r].reject(r),u(e+1)},t.setAttribute("charset","utf-8"),t.src=r,document.body.appendChild(t))}(0),r.open(),e.all(s).then(function(){(c||angular.noop)(),t(a.resolve),r.close()},function(){t(a.reject),r.close(),console.error("lazyLoad-js-error:",arguments[0])}),a.promise}}]),n.factory("loadModules",["$cacheFactory","$injector","$log",function(o,a,s){var i=o("loadedModules"),c={$compileProvider:t,$controllerProvider:e,$filterProvider:r,$provide:n},u=0;return function l(e){var t,r=[];return u++,angular.forEach(angular.isArray(e)?e:[e],function(e){function n(e){var t,r;for(t=0,r=e.length;r>t;t++){var n=e[t],o=c[n[0]];o&&o[n[1]].apply(o,n[2])}}if(!i.get(e)){i.put(e,!0);try{angular.isString(e)?(t=angular.module(e),r=r.concat(l(t.requires)).concat(t._runBlocks),u--,n(t._invokeQueue),n(t._configBlocks)):(angular.isFunction(e)||angular.isArray(e))&&r.push(e)}catch(o){throw angular.isArray(e)&&(e=e[e.length-1]),o.message&&o.stack&&-1==o.stack.indexOf(o.message)&&(o=o.message+"\n"+o.stack),s.error("Failed to instantiate module "+e+" due to:\n"+(o.stack||o.message||o))}}}),1===u&&(u--,angular.forEach(r,function(e){a.invoke(e)})),r}}]),n.factory("routerSetup",[function(){return function(){angular.forEach(EMAPP.States,function(e,t){s.state(t,e)})}}]),n.service("$api",["$resource",function(e){var t=function(e,t){return(/(^http:\/\/)|(^https:\/\/)|(^\/)/.test(e)?e:location.protocol+"//"+location.host+"/api/"+e)+(t?"/:_api_action":"")};angular.forEach(EMAPP.api,function(r,n){if(r instanceof Array){var o=r[0],a=r[1],s=r[2],i=r[3];o&&(s=angular.forEach(angular.extend({get:{method:"GET"},list:{method:"GET"},search:{method:"GET"},set:{},create:{},update:{},remove:{},"delete":{}},s),function(e,r){e=e||{},e.url&&(e.url=t(e.url)),e.method=e.method||"POST",e.params=angular.extend(e.url?{}:{_api_action:r},e.params)}),this[n]=e(t(o,!0),a,s,i))}},this)}]),n.factory("SweetAlert",function(){return{swal:window.swal,success:function(e,t){this.swal(e,t,"success")},error:function(e,t){this.swal(e,t,"error")},warning:function(e,t){this.swal(e,t,"warning")},info:function(e,t){this.swal(e,t,"info")}}}),n.service("viewMask",["$timeout",function(e){var t=0,r=$('<div class="view-mask"><div class="progress"><div class="progress-bar progress-bar-striped active" style="width: 100%"></div></div></div>').appendTo(document.body),n=function(n,o,a){o?(t++,r.show()):(a?t=0:t--,0>=t&&r.hide()),e(n||angular.noop)};this.open=function(){n(arguments[0],!0)},this.close=function(){var t,r;arguments[0]instanceof Function?(t=arguments[0],r=arguments[1]):(t=null,r=arguments[0]),e(function(){n(t,!1,r)},200)}}])}]);
EMAPP.api={auth:["auth",,{login:{},logout:{}}],project:["project",,{info:{}}],business:["business",,{calendar:{cache:!0},dailycost:{},monthlykgce:{},energyconstitute:{},dailysensordetail:{},monitor:{},channeldetail:{},buildingstatistic:{},energyincomerate:{},energytimeline:{},socitystatistic:{},socitydetail:{},socitytimeline:{},settlereport:{},monthlyreport:{},dailyreport:{}}],energy:["energy",,{info:{cache:!0}}],control:["control",,{send:{}}]};
EMAPP.controller("EMAPP.controller",["$rootScope","$location","$state","$api","$cookies","md5","routerSetup","ErrorCode","SweetAlert",function(e,t,o,n,a,r,l,s,u){EMAPP.templateCache.put("dist/html/login.min.html?rev=1087211550",'<div class="login-container"><form class="login-form text-center" ng-submit="EMAPP.login()" novalidate="" autocomplete="off"><h4>古鸽云能源用户平台</h4><div class="form-group has-feedback"><input type="text" class="form-control login-field" ng-model="EMAPP.user" maxlength="50" placeholder="用户名"> <i class="form-control-feedback em em-card"></i></div><div class="form-group has-feedback"><input type="password" class="form-control login-field" ng-model="EMAPP.passwd" maxlength="18" placeholder="密码"> <i class="form-control-feedback em em-key"></i></div><div class="form-group"><button type="submit" class="btn btn-primary btn-block">登录 <i class="em em-login"></i></button></div></form></div>');var i=this,c=/cloudenergy\.me/.test(location.hostname)?".cloudenergy.me":location.hostname,h=function(n){1===o.get().length&&(e.$on("$stateChangeStart",function(e,t,a,r,l){n=$("link[class=lazyLoad-stylesheet]"),EMAPP.User.token?EMAPP.User.token&&"login"===t.name?(e.preventDefault&&e.preventDefault(),o.go("dashboard")):EMAPP.User.token&&"logout"===t.name&&(e.preventDefault&&e.preventDefault(),i.logout()):"login"!==t.name&&"logout"!==t.name&&(e.preventDefault&&e.preventDefault(),o.go("login"))}),e.$on("$stateChangeSuccess",function(e,t,a,r,l){$(window).unbind("resize"),n&&n.remove(),/^(login|logout|dashboard)$/i.test(t.name)||(o.last=o.current.name)}),e.$on("$stateNotFound",function(e,t,n,a){e.preventDefault&&e.preventDefault(),console.log("$stateNotFound",t),t.to!==o.last&&o.last?o.reload(o.last):(o.last="",o.reload("dashboard"))}),o.last=t.url().replace(/^\//,"").replace(/\//g,"."),t.url(""),l())},g=function(e){e&&s(e.code||e.err),h(),EMAPP.User=e&&e.result||EMAPP.User,angular.forEach(["token","user"],function(e){EMAPP.User[e]&&a.put(e,EMAPP.User[e],{path:"/",domain:c,expires:new Date((new Date).setMonth((new Date).getMonth()+1))})}),EMAPP.User.token?o.go("dashboard"):o.go("login")};return angular.forEach(a.getAll(),function(e,t){this[t]=e},EMAPP.User={}),g(),i.login=function(){var e=this&&this.user,t=this&&this.passwd,o=[];!e&&o.push("帐号"),!t&&o.push("密码"),o=o.join("与"),o&&u.warning("请输入您的"+o),!o&&n.auth.login({user:e,passwd:r.createHash(t).toUpperCase()},g,function(e){g(e.data)})},i.logout=function(){n.auth.logout({redirect:"/"},function(){EMAPP.User={},angular.forEach(["token","user"],function(e){a.remove(e,{path:"/"}),a.remove(e,{path:"/",domain:c}),a.remove(e,{path:"/",domain:".www"+c})}),o.go("login")})},this}]);
EMAPP.factory("ErrorCode",["SweetAlert",function(e){return function(r,a){switch(r){case 20000001:a="用户不存在";break;case 90000001:a="服务器错误";break;case 90000002:a="拒绝访问";break;case 90000003:a="登录失败";break;case 90000004:a="权限不足";break;case 90000005:a="未登录";break;case 90000006:a=["验证失败","账号或密码有误"];break;case 90000007:a="签名校验失败"}return a&&e.error.apply(e,angular.isArray(a)?a:[a]),r}}]);
EMAPP.Menu=[{state:"dashboard.main",name:"首页",icon:"em em-home"},{state:"dashboard.monitor",name:"监控",icon:"em em-camera"},{state:"dashboard.control",name:"控制",icon:"em em-control"},{state:"dashboard.analyze",name:"分析",icon:"em em-analyze"},{state:"dashboard.statistic",name:"统计",icon:"em em-pie-chart"}];
EMAPP.States={login:{url:"/dashboard/login",templateUrl:"dist/html/login.min.html?rev=1087211550",controller:function(){document.title="用户登录"}},logout:{url:"/dashboard/logout",templateUrl:"dist/html/login.min.html?rev=1087211550"},dashboard:{url:"/dashboard",templateUrl:"dist/html/project.min.html?rev=1a37ee32f3",resolve:{scripts:["lazyLoad",function(s){return s.js("/dist/js/controllers/project.min.js?rev=ffedbf3af3")}]}},"dashboard.main":{url:"/main",views:{"dashboard@dashboard":{templateUrl:"dist/html/project/main.min.html?rev=e141c3f1ca"}},data:{title:"首页"},resolve:{scripts:["lazyLoad",function(s){return s.js(["/dist/js/controllers/project/main.min.js?rev=3a7c339400","/dist/js/directives/datetimepicker.min.js?rev=c5e368c8e1","/dist/js/directives/highcharts.min.js?rev=d140bc386b","/dist/js/services/pies.min.js?rev=9e992384fa","/dist/js/services/lines.min.js?rev=084292a01c","/vendor/highcharts/highcharts.min.js?rev=28a122e258"])}]}},"dashboard.monitor":{url:"/monitor",views:{"dashboard@dashboard":{templateUrl:"dist/html/project/monitor.min.html?rev=7b2ff07f95"}},data:{title:"设备状态"},resolve:{scripts:["lazyLoad",function(s){return s.js(["/dist/js/controllers/project/monitor.min.js?rev=9c3d6fa1bc","/dist/js/directives/datetimepicker.min.js?rev=c5e368c8e1","/dist/js/directives/highcharts.min.js?rev=d140bc386b","/dist/js/directives/slimscroll.min.js?rev=5de214d4bb","/dist/js/services/lines.min.js?rev=084292a01c","/vendor/highcharts/highcharts.min.js?rev=28a122e258"])}]}},"dashboard.control":{url:"/control",views:{"dashboard@dashboard":{templateUrl:"dist/html/project/control.min.html?rev=90f9301521"}},data:{title:"设备控制"},resolve:{scripts:["lazyLoad",function(s){return s.js(["/dist/js/controllers/project/control.min.js?rev=bb308a7a12","/dist/js/directives/slimscroll.min.js?rev=5de214d4bb"])}]}},"dashboard.analyze":{url:"/analyze",views:{"dashboard@dashboard":{templateUrl:"dist/html/project/analyze.min.html?rev=dc14096329"}},data:{title:"能耗分析"},resolve:{scripts:["lazyLoad",function(s){return s.js(["/dist/js/controllers/project/analyze.min.js?rev=1e4f58ca09","/dist/js/directives/slimscroll.min.js?rev=5de214d4bb","/dist/js/directives/highcharts.min.js?rev=d140bc386b","/dist/js/services/pies.min.js?rev=9e992384fa","/dist/js/services/lines.min.js?rev=084292a01c","/vendor/highcharts/highcharts.min.js?rev=28a122e258"])}]}},"dashboard.statistic":{url:"/statistic",views:{"dashboard@dashboard":{templateUrl:"dist/html/project/statistic.min.html?rev=897dd4eb5d"}},data:{title:"统计"},resolve:{styles:["lazyLoad",function(s){return s.css("/vendor/angular-ui-grid/ui-grid.min.css?rev=a8727ed9ce")}],scripts:["lazyLoad","loadModules",function(s,i){return s.js(["/vendor/angular-ui-grid/ui-grid.min.js?rev=fb8fde2e6c","/dist/js/controllers/project/statistic.min.js?rev=a2cf8b4e2a","/dist/js/directives/datetimepicker.min.js?rev=c5e368c8e1"],function(){i(["ui.grid","ui.grid.autoResize","ui.grid.exporter","ui.grid.moveColumns","ui.grid.resizeColumns"])})}]}}};
angular.element(document).ready(function(){$(document.body).attr("ng-controller","EMAPP.controller as EMAPP").html("<section ui-view></section>"),angular.bootstrap(document,["EMAPP"])});