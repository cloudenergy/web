"use strict";angular.module("app").component("analyze",{templateUrl:"app/modules/analyze/analyze.html?rev=57360b41a0"}),angular.module("app").component("analyzeGroup",{templateUrl:"app/modules/analyze/group.html?rev=b27990705b",controller:["$rootScope","$filter","$api",function(o,t,e){var c=this;return c.charttype="column",c.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},c.chart={},c.timetypeChange=function(t){c.building_current="",c.energy_current="",c.timetype_current=t,c.groupanalysis()},c.groupanalysis=function(){e.business.groupanalysis({time:t("date")(new Date,"yyyyMMdd"),type:c.timetype_current||"DAY",project:o.Project.ids},function(t){c.data=t.result,c.check(c.current)})},c.current="consumption",c.check=function(n){c.current=n,c.sheet=[];var i=[],r=[],a=[];angular.forEach(c.data.detail,function(t,e){i.push(t.name=o.Project[e].title),c.sheet.push(t),angular.forEach(t,function(t,e){"now"===e&&r.push(t[n]),"yoy"===e&&a.push(t[n])})}),c.typeChange=function(t){t&&(c.charttype=t),c.chart.timeline={chart:{type:c.charttype},title:!1,xAxis:{categories:i},yAxis:{title:!1},tooltip:{shared:!0},series:[{name:"当前",data:r},{name:"同期",data:a}]}},c.typeChange()},c.timetypeChange("DAY"),c}]}),angular.module("app").component("analyzeBuilding",{templateUrl:"app/modules/analyze/building.html?rev=19c3a3fc67",controller:["$rootScope","$filter","$api","analyzePieOptions",function(e,n,t,i){var a=this;return a.charttype="column",a.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},a.chart={},a.timetypeChange=function(t){a.building_current="",a.energy_current="",a.timetype_current=t,a.buildingstatistic(),a.incomerate(),a.timeline()},a.building_current="",a.building=function(t){a.energy_current="",a.building_current=a.building_current===t?"":t,a.incomerate(),a.timeline()},a.energy_current="",a.energy=function(t){a.energy_current=a.energy_current===t?"":t,a.timeline()},a.buildingstatistic=function(){t.business.buildingstatistic({timetype:a.timetype_current,time:n("date")(new Date,"yyyyMMdd"),project:e.Project.current._id},function(t){angular.forEach(t.result[e.Project.current._id],function(t){this.push(t)},a.buildingData=[])})},a.incomerate=function(){t.business.energyincomerate({timetype:a.timetype_current,time:n("date")(new Date,"yyyyMMdd"),project:{project:e.Project.current._id,building:a.building_current}},function(t){t=t.result[e.Project.current._id],a.pie=t.pie,angular.forEach(t.sheet,function(t){this.push(t)},a.sheet=[]),a.chart.nowyoy=i(t.pie.nowyoy.now,t.pie.nowyoy.yoy),a.chart.nowbudget=i(t.pie.nowbudget.now,t.pie.nowbudget.budget),a.chart.nowincome=i(t.pie.nowincome.now,t.pie.nowincome.income)})},a.timeline=function(){t.business.energytimeline({timetype:a.timetype_current,time:n("date")(new Date,"yyyyMMdd"),project:[{project:e.Project.current._id,energytype:a.energy_current,building:a.building_current}]},function(t){var i=[],r=[];angular.forEach(t.result[e.Project.current._id]||{},function(t,e,n){Object.keys(t).length>i.length&&(n=0,i=[]),angular.forEach(t,function(t,e){this.push(Math.round(100*t)/100),0===n&&i.push(1*e)},t=[]),r.push({data:t,name:{now:"当前能耗",yoy:"同期能耗"}[e]||e})}),a.typeChange=function(t){a.charttype=t,a.chart.timeline={chart:{type:a.charttype},title:!1,xAxis:{type:"datetime",categories:i,labels:{formatter:function(){return n("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[a.timetype_current])}}},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.2f}"}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[a.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:r}},a.chart.timeline={chart:{type:"column"},title:!1,xAxis:{type:"datetime",categories:i,labels:{formatter:function(){return n("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[a.timetype_current])}}},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.2f}"}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[a.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:r}})},a.timetypeChange("DAY"),a}]}),angular.module("app").component("analyzeSocities",{templateUrl:"app/modules/analyze/socities.html?rev=ace73e820e",controller:["$rootScope","$filter","$api","analyzePieOptions",function(e,n,i,r){var a=this;return a.charttype="column",a.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},a.socity_current="",a.socity=function(t){a.socity_current=a.socity_current===t?"":t,a.timeline()},a.timetypeChange=function(t){a.socity_current="",a.timetype_current=t,a.chart={},i.business.socitystatistic({timetype:a.timetype_current,time:n("date")(new Date,"yyyyMMdd"),project:e.Project.current._id},function(t){angular.forEach(t.result[e.Project.current._id],function(t){this.push(t)},a.socityData=[])}),i.business.socitydetail({timetype:a.timetype_current,time:n("date")(new Date,"yyyyMMdd"),project:e.Project.current._id},function(t){t=t.result[e.Project.current._id],a.pie=t.pie,angular.forEach(t.sheet,function(t){this.push(t)},a.sheet=[]),a.pie.third=a.pie.water||a.pie.gas,a.pie.water?(a.pie.third.unitTitle="吨",a.pie.third.nowTitle="水当期总量",a.pie.third.yoyTitle="水同期总量"):a.pie.gas&&(a.pie.third.unitTitle="立方米",a.pie.third.nowTitle="气当期总量",a.pie.third.yoyTitle="气同期总量"),a.chart.nowyoy=r(t.pie.nowyoy.now,t.pie.nowyoy.yoy),a.chart.electric=r(t.pie.electric.now,t.pie.electric.yoy),a.chart.third=r(t.pie.third.now,t.pie.third.yoy)}),a.timeline()},a.timeline=function(){i.business.socitytimeline({timetype:a.timetype_current,time:n("date")(new Date,"yyyyMMdd"),project:[{project:e.Project.current._id,socity:a.socity_current}]},function(t){var i=[],r=[];angular.forEach(t.result[e.Project.current._id]||{},function(t,e,n){Object.keys(t).length>i.length&&(n=0,i=[]),angular.forEach(t.detail,function(t,e){this.push(Math.round(100*t)/100),0===n&&i.push(1*e)},t=[]),r.push({data:t,name:e})}),a.typeChange=function(t){a.charttype=t,a.energyeffectiverate.chart.type=t},a.typeChange=function(t){a.charttype=t,a.chart.timeline={chart:{type:a.charttype},title:!1,xAxis:{type:"datetime",categories:i,labels:{formatter:function(){return n("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[a.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[a.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:r}},a.chart.timeline={chart:{type:"column"},title:!1,xAxis:{type:"datetime",categories:i,labels:{formatter:function(){return n("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[a.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[a.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:r}})},a.timetypeChange("DAY"),a}]}),angular.module("app").factory("analyzePieOptions",function(){return function(t,e){var n=Math.max(-100,Math.round(100,(t-e)/e*100||0)),i=[{y:Math.abs(n)},{y:100-Math.abs(n)}];return{chart:{margin:[0,0,0,0],style:{textAlign:"center"},type:"pie"},title:{text:'<span style="'+(0<n?"color:#e74c3c;":"color:#17bac1;")+'"><span style="font-size: 26px;">'+Math.abs(n)+'</span><span style="font-size:14px;">%</span></span>',verticalAlign:"middle",useHTML:!0,y:2},tooltip:!1,plotOptions:{pie:{dataLabels:{enabled:!1,color:"#000",connectorColor:"#000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},innerSize:"80%"}},series:[{data:i}]}}});