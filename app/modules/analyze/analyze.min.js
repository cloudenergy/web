angular.module("app").component("analyze",{templateUrl:"app/modules/analyze/analyze.html?rev=48b06992d2",controller:function(){this.groupmode=APP.User.groupmode}}),angular.module("app").component("analyzeGroup",{templateUrl:"app/modules/analyze/group.html?rev=90579980c2",controller:["$filter","$api",function(e,t){var n=this;return n.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},n.chart={},n.timetypeChange=function(e){n.building_current="",n.energy_current="",n.timetype_current=e,n.groupanalysis()},n.groupanalysis=function(){t.business.groupanalysis({time:e("date")(new Date,"yyyyMMdd"),type:n.timetype_current||"DAY",project:APP.Project.ids},function(e){n.data=e.result,n.check(n.current)})},n.current="consumption",n.check=function(e){n.current=e,n.sheet=[];var t=[],i=[],r=[];angular.forEach(n.data.detail,function(o,a){t.push(o.name=APP.Project[a].title),n.sheet.push(o),angular.forEach(o,function(t,n){"now"===n&&i.push(t[e]),"yoy"===n&&r.push(t[e])})}),n.chart.timeline={chart:{type:"column"},title:!1,xAxis:{categories:t},yAxis:{title:!1},tooltip:{shared:!0},series:[{name:"当前",data:i},{name:"同期",data:r}]}},n.timetypeChange("DAY"),n}]}),angular.module("app").component("analyzeBuilding",{templateUrl:"app/modules/analyze/building.html?rev=9c003e1056",controller:["$filter","$api","analyzePieOptions",function(e,t,n){var i=this;return i.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},i.chart={},i.timetypeChange=function(e){i.building_current="",i.energy_current="",i.timetype_current=e,i.buildingstatistic(),i.incomerate(),i.timeline()},i.building_current="",i.building=function(e){i.energy_current="",i.building_current=i.building_current===e?"":e,i.incomerate(),i.timeline()},i.energy_current="",i.energy=function(e){i.energy_current=i.energy_current===e?"":e,i.timeline()},i.buildingstatistic=function(){t.business.buildingstatistic({timetype:i.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:APP.Project.current._id},function(e){angular.forEach(e.result[APP.Project.current._id],function(e){this.push(e)},i.buildingData=[])})},i.incomerate=function(){t.business.energyincomerate({timetype:i.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:{project:APP.Project.current._id,building:i.building_current}},function(e){e=e.result[APP.Project.current._id],i.pie=e.pie,angular.forEach(e.sheet,function(e){this.push(e)},i.sheet=[]),i.chart.nowyoy=n(e.pie.nowyoy.now,e.pie.nowyoy.yoy),i.chart.nowbudget=n(e.pie.nowbudget.now,e.pie.nowbudget.budget),i.chart.nowincome=n(e.pie.nowincome.now,e.pie.nowincome.income)})},i.timeline=function(){t.business.energytimeline({timetype:i.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:[{project:APP.Project.current._id,energytype:i.energy_current,building:i.building_current}]},function(t){var n=[],r=[];angular.forEach(t.result[APP.Project.current._id]||{},function(e,t,i){Object.keys(e).length>n.length&&(i=0,n=[]),angular.forEach(e,function(e,t){this.push(Math.round(100*e)/100),0===i&&n.push(1*t)},e=[]),console.log(e),r.push({data:e,name:{now:"当前能耗",yoy:"同期能耗"}[t]||t})}),i.chart.timeline={chart:{type:"column"},title:!1,xAxis:{type:"datetime",categories:n,labels:{formatter:function(){return e("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[i.timetype_current])}}},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.2f}"}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[i.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:r}})},i.timetypeChange("DAY"),i}]}),angular.module("app").component("analyzeSocities",{templateUrl:"app/modules/analyze/socities.html?rev=634bd26eba",controller:["$filter","$api","analyzePieOptions",function(e,t,n){var i=this;return i.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},i.socity_current="",i.socity=function(e){i.socity_current=i.socity_current===e?"":e,i.timeline()},i.timetypeChange=function(r){i.socity_current="",i.timetype_current=r,i.chart={},t.business.socitystatistic({timetype:i.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:APP.Project.current._id},function(e){angular.forEach(e.result[APP.Project.current._id],function(e){this.push(e)},i.socityData=[])}),t.business.socitydetail({timetype:i.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:APP.Project.current._id},function(e){e=e.result[APP.Project.current._id],i.pie=e.pie,angular.forEach(e.sheet,function(e){this.push(e)},i.sheet=[]),i.pie.third=i.pie.water||i.pie.gas,i.pie.water?(i.pie.third.unitTitle="吨",i.pie.third.nowTitle="水当期总量",i.pie.third.yoyTitle="水同期总量"):i.pie.gas&&(i.pie.third.unitTitle="立方米",i.pie.third.nowTitle="气当期总量",i.pie.third.yoyTitle="气同期总量"),i.chart.nowyoy=n(e.pie.nowyoy.now,e.pie.nowyoy.yoy),i.chart.electric=n(e.pie.electric.now,e.pie.electric.yoy),i.chart.third=n(e.pie.third.now,e.pie.third.yoy)}),i.timeline()},i.timeline=function(){t.business.socitytimeline({timetype:i.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:[{project:APP.Project.current._id,socity:i.socity_current}]},function(t){var n=[],r=[];angular.forEach(t.result[APP.Project.current._id]||{},function(e,t,i){Object.keys(e).length>n.length&&(i=0,n=[]),angular.forEach(e.detail,function(e,t){this.push(Math.round(100*e)/100),0===i&&n.push(1*t)},e=[]),r.push({data:e,name:t})}),i.chart.timeline={chart:{type:"spline"},title:!1,xAxis:{type:"datetime",categories:n,labels:{formatter:function(){return e("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[i.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[i.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:r}})},i.timetypeChange("DAY"),i}]}),angular.module("app").factory("analyzePieOptions",function(){return function(e,t){var n=Math.max(-100,Math.round(100,(e-t)/t*100||0)),i=[{y:Math.abs(n)},{y:100-Math.abs(n)}];return{chart:{margin:[0,0,0,0],style:{textAlign:"center"},type:"pie"},title:{text:'<span style="'+(n>0?"color:#e74c3c;":"color:#17bac1;")+'"><span style="font-size: 26px;">'+Math.abs(n)+'</span><span style="font-size:14px;">%</span></span>',verticalAlign:"middle",useHTML:!0,y:2},tooltip:!1,plotOptions:{pie:{dataLabels:{enabled:!1,color:"#000",connectorColor:"#000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},innerSize:"80%"}},series:[{data:i}]}}});