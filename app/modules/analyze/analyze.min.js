angular.module("app").component("analyze",{templateUrl:"app/modules/analyze/analyze.html?rev=48b06992d2",controller:function(){this.groupmode=APP.User.groupmode}}),angular.module("app").component("analyzeGroup",{templateUrl:"app/modules/analyze/group.html?rev=613e947682",controller:["$filter","$api",function(t,e){var n=this;return n.charttype="column",n.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},n.chart={},n.timetypeChange=function(t){n.building_current="",n.energy_current="",n.timetype_current=t,n.groupanalysis()},n.groupanalysis=function(){e.business.groupanalysis({time:t("date")(new Date,"yyyyMMdd"),type:n.timetype_current||"DAY",project:APP.Project.ids},function(t){n.data=t.result,n.check(n.current)})},n.current="consumption",n.check=function(t){n.current=t,n.sheet=[];var e=[],i=[],r=[];angular.forEach(n.data.detail,function(a,o){e.push(a.name=APP.Project[o].title),n.sheet.push(a),angular.forEach(a,function(e,n){"now"===n&&i.push(e[t]),"yoy"===n&&r.push(e[t])})}),n.typeChange=function(t){t&&(n.charttype=t),n.chart.timeline={chart:{type:n.charttype},title:!1,xAxis:{categories:e},yAxis:{title:!1},tooltip:{shared:!0},series:[{name:"当前",data:i},{name:"同期",data:r}]}},n.typeChange()},n.timetypeChange("DAY"),n}]}),angular.module("app").component("analyzeBuilding",{templateUrl:"app/modules/analyze/building.html?rev=bff70aadca",controller:["$filter","$api","analyzePieOptions",function(t,e,n){var i=this;return i.charttype="column",i.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},i.chart={},i.timetypeChange=function(t){i.building_current="",i.energy_current="",i.timetype_current=t,i.buildingstatistic(),i.incomerate(),i.timeline()},i.building_current="",i.building=function(t){i.energy_current="",i.building_current=i.building_current===t?"":t,i.incomerate(),i.timeline()},i.energy_current="",i.energy=function(t){i.energy_current=i.energy_current===t?"":t,i.timeline()},i.buildingstatistic=function(){e.business.buildingstatistic({timetype:i.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:APP.Project.current._id},function(t){angular.forEach(t.result[APP.Project.current._id],function(t){this.push(t)},i.buildingData=[])})},i.incomerate=function(){e.business.energyincomerate({timetype:i.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:{project:APP.Project.current._id,building:i.building_current}},function(t){t=t.result[APP.Project.current._id],i.pie=t.pie,angular.forEach(t.sheet,function(t){this.push(t)},i.sheet=[]),i.chart.nowyoy=n(t.pie.nowyoy.now,t.pie.nowyoy.yoy),i.chart.nowbudget=n(t.pie.nowbudget.now,t.pie.nowbudget.budget),i.chart.nowincome=n(t.pie.nowincome.now,t.pie.nowincome.income)})},i.timeline=function(){e.business.energytimeline({timetype:i.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:[{project:APP.Project.current._id,energytype:i.energy_current,building:i.building_current}]},function(e){var n=[],r=[];angular.forEach(e.result[APP.Project.current._id]||{},function(t,e,i){Object.keys(t).length>n.length&&(i=0,n=[]),angular.forEach(t,function(t,e){this.push(Math.round(100*t)/100),0===i&&n.push(1*e)},t=[]),r.push({data:t,name:{now:"当前能耗",yoy:"同期能耗"}[e]||e})}),i.typeChange=function(e){i.charttype=e,i.chart.timeline={chart:{type:i.charttype},title:!1,xAxis:{type:"datetime",categories:n,labels:{formatter:function(){return t("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[i.timetype_current])}}},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.2f}"}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[i.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:r}},i.chart.timeline={chart:{type:"column"},title:!1,xAxis:{type:"datetime",categories:n,labels:{formatter:function(){return t("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[i.timetype_current])}}},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.2f}"}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[i.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:r}})},i.timetypeChange("DAY"),i}]}),angular.module("app").component("analyzeSocities",{templateUrl:"app/modules/analyze/socities.html?rev=4e5dbd4959",controller:["$filter","$api","analyzePieOptions",function(t,e,n){var i=this;return i.charttype="column",i.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},i.socity_current="",i.socity=function(t){i.socity_current=i.socity_current===t?"":t,i.timeline()},i.timetypeChange=function(r){i.socity_current="",i.timetype_current=r,i.chart={},e.business.socitystatistic({timetype:i.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:APP.Project.current._id},function(t){angular.forEach(t.result[APP.Project.current._id],function(t){this.push(t)},i.socityData=[])}),e.business.socitydetail({timetype:i.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:APP.Project.current._id},function(t){t=t.result[APP.Project.current._id],i.pie=t.pie,angular.forEach(t.sheet,function(t){this.push(t)},i.sheet=[]),i.pie.third=i.pie.water||i.pie.gas,i.pie.water?(i.pie.third.unitTitle="吨",i.pie.third.nowTitle="水当期总量",i.pie.third.yoyTitle="水同期总量"):i.pie.gas&&(i.pie.third.unitTitle="立方米",i.pie.third.nowTitle="气当期总量",i.pie.third.yoyTitle="气同期总量"),i.chart.nowyoy=n(t.pie.nowyoy.now,t.pie.nowyoy.yoy),i.chart.electric=n(t.pie.electric.now,t.pie.electric.yoy),i.chart.third=n(t.pie.third.now,t.pie.third.yoy)}),i.timeline()},i.timeline=function(){e.business.socitytimeline({timetype:i.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:[{project:APP.Project.current._id,socity:i.socity_current}]},function(e){var n=[],r=[];angular.forEach(e.result[APP.Project.current._id]||{},function(t,e,i){Object.keys(t).length>n.length&&(i=0,n=[]),angular.forEach(t.detail,function(t,e){this.push(Math.round(100*t)/100),0===i&&n.push(1*e)},t=[]),r.push({data:t,name:e})}),i.typeChange=function(t){i.charttype=t,i.energyeffectiverate.chart.type=t},i.typeChange=function(e){i.charttype=e,i.chart.timeline={chart:{type:i.charttype},title:!1,xAxis:{type:"datetime",categories:n,labels:{formatter:function(){return t("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[i.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[i.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:r}},i.chart.timeline={chart:{type:"column"},title:!1,xAxis:{type:"datetime",categories:n,labels:{formatter:function(){return t("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[i.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[i.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:r}})},i.timetypeChange("DAY"),i}]}),angular.module("app").factory("analyzePieOptions",function(){return function(t,e){var n=Math.max(-100,Math.round(100,(t-e)/e*100||0)),i=[{y:Math.abs(n)},{y:100-Math.abs(n)}];return{chart:{margin:[0,0,0,0],style:{textAlign:"center"},type:"pie"},title:{text:'<span style="'+(n>0?"color:#e74c3c;":"color:#17bac1;")+'"><span style="font-size: 26px;">'+Math.abs(n)+'</span><span style="font-size:14px;">%</span></span>',verticalAlign:"middle",useHTML:!0,y:2},tooltip:!1,plotOptions:{pie:{dataLabels:{enabled:!1,color:"#000",connectorColor:"#000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},innerSize:"80%"}},series:[{data:i}]}}});