angular.module("app").component("analyze",{templateUrl:"app/modules/analyze/analyze.html?rev=ba77b91c65",controller:function(){this.groupmode=APP.User.groupmode}}),angular.module("app").component("analyzeSocities",{templateUrl:"app/modules/analyze/socities.html?rev=ab55a550c6",controller:["$filter","$api","analyzePieOptions",function(t,e,i){var n=this;return n.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},n.socity_current="",n.socity=function(t){n.socity_current=n.socity_current===t?"":t,n.timeline()},n.timetypeChange=function(r){n.socity_current="",n.timetype_current=r,n.chart={},e.business.socitystatistic({timetype:n.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:APP.Project[0].id},function(t){angular.forEach(t.result[APP.Project[0].id],function(t){this.push(t)},n.socityData=[])}),e.business.socitydetail({timetype:n.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:APP.Project[0].id},function(t){t=t.result[APP.Project[0].id],n.pie=t.pie,angular.forEach(t.sheet,function(t){this.push(t)},n.sheet=[]),n.pie.third=n.pie.water||n.pie.gas,n.pie.water?(n.pie.third.unitTitle="吨",n.pie.third.nowTitle="水当期总量",n.pie.third.yoyTitle="水同期总量"):n.pie.gas&&(n.pie.third.unitTitle="立方米",n.pie.third.nowTitle="气当期总量",n.pie.third.yoyTitle="气同期总量"),n.chart.nowyoy=i(t.pie.nowyoy.now,t.pie.nowyoy.yoy),n.chart.electric=i(t.pie.electric.now,t.pie.electric.yoy),n.chart.third=i(t.pie.third.now,t.pie.third.yoy)}),n.timeline()},n.timeline=function(){e.business.socitytimeline({timetype:n.timetype_current,time:t("date")(new Date,"yyyyMMdd"),project:[{project:APP.Project[0].id,socity:n.socity_current}]},function(e){var i=[],r=[];angular.forEach(e.result[APP.Project[0].id]||{},function(t,e,n){Object.keys(t).length>i.length&&(n=0,i=[]),angular.forEach(t.detail,function(t,e){this.push(Math.round(100*t)/100),0===n&&i.push(1*e)},t=[]),r.push({data:t,name:e})}),n.chart.timeline={chart:{type:"spline"},title:!1,xAxis:{type:"datetime",categories:i,labels:{formatter:function(){return t("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[n.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[n.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:r}})},n.timetypeChange("DAY"),n}]}),angular.module("app").factory("analyzePieOptions",function(){return function(t,e){var i=Math.max(-100,Math.round(100,(t-e)/e*100||0)),n=[{y:Math.abs(i)},{y:100-Math.abs(i)}];return{chart:{margin:[0,0,0,0],style:{textAlign:"center"},type:"pie"},title:{text:'<span style="'+(i>0?"color:#e74c3c;":"color:#17bac1;")+'"><span style="font-size: 26px;">'+Math.abs(i)+'</span><span style="font-size:14px;">%</span></span>',verticalAlign:"middle",useHTML:!0,y:2},tooltip:!1,plotOptions:{pie:{dataLabels:{enabled:!1,color:"#000",connectorColor:"#000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},innerSize:"80%"}},series:[{data:n}]}}});