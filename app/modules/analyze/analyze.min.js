"use strict";angular.module("app").component("analyze",{templateUrl:"app/modules/analyze/analyze.html?rev=57360b41a0"}),angular.module("app").component("analyzeGroup",{templateUrl:"app/modules/analyze/group.html?rev=77cd76fdc8",controller:["$rootScope","$filter","$api",function(t,e,n){var i=this;return i.charttype="column",i.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},i.chart={},i.timetypeChange=function(t){i.building_current="",i.energy_current="",i.timetype_current=t,i.groupanalysis()},i.groupanalysis=function(){n.business.groupanalysis({time:e("date")(new Date,"yyyyMMdd"),type:i.timetype_current||"DAY",project:t.Project.ids},function(t){i.data=t.result,i.check(i.current)})},i.current="consumption",i.check=function(e){i.current=e,i.sheet=[];var n=[],r=[],a=[];angular.forEach(i.data.detail,function(o,c){n.push(o.name=t.Project[c].title),i.sheet.push(o),angular.forEach(o,function(t,n){"now"===n&&r.push(t[e]),"yoy"===n&&a.push(t[e])})}),i.typeChange=function(t){t&&(i.charttype=t),i.chart.timeline={chart:{type:i.charttype},title:!1,xAxis:{categories:n},yAxis:{title:!1},tooltip:{shared:!0},series:[{name:"当前",data:r},{name:"同期",data:a}]}},i.typeChange()},i.timetypeChange("DAY"),i}]}),angular.module("app").component("analyzeBuilding",{templateUrl:"app/modules/analyze/building.html?rev=83102bdd72",controller:["$rootScope","$filter","$api","analyzePieOptions",function(t,e,n,i){var r=this;return r.charttype="column",r.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},r.chart={},r.timetypeChange=function(t){r.building_current="",r.energy_current="",r.timetype_current=t,r.buildingstatistic(),r.incomerate(),r.timeline()},r.building_current="",r.building=function(t){r.energy_current="",r.building_current=r.building_current===t?"":t,r.incomerate(),r.timeline()},r.energy_current="",r.energy=function(t){r.energy_current=r.energy_current===t?"":t,r.timeline()},r.buildingstatistic=function(){n.business.buildingstatistic({timetype:r.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:t.Project.current._id},function(e){angular.forEach(e.result[t.Project.current._id],function(t){this.push(t)},r.buildingData=[])})},r.incomerate=function(){n.business.energyincomerate({timetype:r.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:{project:t.Project.current._id,building:r.building_current}},function(e){e=e.result[t.Project.current._id],r.pie=e.pie,angular.forEach(e.sheet,function(t){this.push(t)},r.sheet=[]),r.chart.nowyoy=i(e.pie.nowyoy.now,e.pie.nowyoy.yoy),r.chart.nowbudget=i(e.pie.nowbudget.now,e.pie.nowbudget.budget),r.chart.nowincome=i(e.pie.nowincome.now,e.pie.nowincome.income)})},r.timeline=function(){n.business.energytimeline({timetype:r.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:[{project:t.Project.current._id,energytype:r.energy_current,building:r.building_current}]},function(n){var i=[],a=[];angular.forEach(n.result[t.Project.current._id]||{},function(t,e,n){Object.keys(t).length>i.length&&(n=0,i=[]),angular.forEach(t,function(t,e){this.push(Math.round(100*t)/100),0===n&&i.push(1*e)},t=[]),a.push({data:t,name:{now:"当前能耗",yoy:"同期能耗"}[e]||e})}),r.typeChange=function(t){r.charttype=t,r.chart.timeline={chart:{type:r.charttype},title:!1,xAxis:{type:"datetime",categories:i,labels:{formatter:function(){return e("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[r.timetype_current])}}},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.2f}"}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[r.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:a}},r.chart.timeline={chart:{type:"column"},title:!1,xAxis:{type:"datetime",categories:i,labels:{formatter:function(){return e("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[r.timetype_current])}}},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.2f}"}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[r.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:a}})},r.timetypeChange("DAY"),r}]}),angular.module("app").component("analyzeSocities",{templateUrl:"app/modules/analyze/socities.html?rev=1deee1fb5e",controller:["$rootScope","$filter","$api","analyzePieOptions",function(t,e,n,i){var r=this;return r.charttype="column",r.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},r.socity_current="",r.socity=function(t){r.socity_current=r.socity_current===t?"":t,r.timeline()},r.timetypeChange=function(a){r.socity_current="",r.timetype_current=a,r.chart={},n.business.socitystatistic({timetype:r.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:t.Project.current._id},function(e){angular.forEach(e.result[t.Project.current._id],function(t){this.push(t)},r.socityData=[])}),n.business.socitydetail({timetype:r.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:t.Project.current._id},function(e){e=e.result[t.Project.current._id],r.pie=e.pie,angular.forEach(e.sheet,function(t){this.push(t)},r.sheet=[]),r.pie.third=r.pie.water||r.pie.gas,r.pie.water?(r.pie.third.unitTitle="吨",r.pie.third.nowTitle="水当期总量",r.pie.third.yoyTitle="水同期总量"):r.pie.gas&&(r.pie.third.unitTitle="立方米",r.pie.third.nowTitle="气当期总量",r.pie.third.yoyTitle="气同期总量"),r.chart.nowyoy=i(e.pie.nowyoy.now,e.pie.nowyoy.yoy),r.chart.electric=i(e.pie.electric.now,e.pie.electric.yoy),r.chart.third=i(e.pie.third.now,e.pie.third.yoy)}),r.timeline()},r.timeline=function(){n.business.socitytimeline({timetype:r.timetype_current,time:e("date")(new Date,"yyyyMMdd"),project:[{project:t.Project.current._id,socity:r.socity_current}]},function(n){var i=[],a=[];angular.forEach(n.result[t.Project.current._id]||{},function(t,e,n){Object.keys(t).length>i.length&&(n=0,i=[]),angular.forEach(t.detail,function(t,e){this.push(Math.round(100*t)/100),0===n&&i.push(1*e)},t=[]),a.push({data:t,name:e})}),r.typeChange=function(t){r.charttype=t,r.energyeffectiverate.chart.type=t},r.typeChange=function(t){r.charttype=t,r.chart.timeline={chart:{type:r.charttype},title:!1,xAxis:{type:"datetime",categories:i,labels:{formatter:function(){return e("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[r.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[r.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:a}},r.chart.timeline={chart:{type:"column"},title:!1,xAxis:{type:"datetime",categories:i,labels:{formatter:function(){return e("date")(this.value,{DAY:"H时",WEEK:"M-d",MONTH:"M-d",YEAR:"M月"}[r.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:{DAY:"%H时",WEEK:"%m月%d号",MONTH:"%m月%d号",YEAR:"%m月"}[r.timetype_current],pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} kWh</span>'},series:a}})},r.timetypeChange("DAY"),r}]}),angular.module("app").factory("analyzePieOptions",function(){return function(t,e){var n=Math.max(-100,Math.round(100,(t-e)/e*100||0)),i=[{y:Math.abs(n)},{y:100-Math.abs(n)}];return{chart:{margin:[0,0,0,0],style:{textAlign:"center"},type:"pie"},title:{text:'<span style="'+(n>0?"color:#e74c3c;":"color:#17bac1;")+'"><span style="font-size: 26px;">'+Math.abs(n)+'</span><span style="font-size:14px;">%</span></span>',verticalAlign:"middle",useHTML:!0,y:2},tooltip:!1,plotOptions:{pie:{dataLabels:{enabled:!1,color:"#000",connectorColor:"#000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"},innerSize:"80%"}},series:[{data:i}]}}});