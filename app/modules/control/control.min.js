angular.module("app").component("control",{templateUrl:"app/modules/control/control.html?rev=c51064d08c",controller:["$scope","$element","$timeout","$api","$q","SweetAlert",function(e,t,n,l,i,c){var a=this,o=APP.Project.current&&APP.Project.current._id,d=function(e,t,n){if(angular.isObject(e)&&!angular.isArray(e)){var l,i=[];return e.entity.id&&(l=e.entity.status[n]),e.entity.id&&(e.entity.status["prev_"+n]=void 0),angular.forEach(a.gridApi.grid.rows,function(c){!e.entity.id&&c.isSelected&&c.entity.command[t]&&(e.entity&&c.entity.id!==e.entity.id&&(c.entity.status["prev_"+n]=c.entity.status[n],c.entity.status[n]=l),i.push(c.entity.id))}),i.length?(e.entity.id&&!e.isSelected&&(e.isSelected=!0,i.push(e.entity.id)),a.multiCheck()):e.entity.id&&i.push(e.entity.id),i}angular.forEach(a.gridApi.grid.rows,function(t){~e.indexOf(t.entity.id)&&(t.entity.status[n]=t.entity.status["prev_"+n],delete t.entity.status["prev_"+n])})};a.isHide=!0,a.itemSelected=!1,a.multiCheck=function(e){"all"===e?(a.multiCheck.all&&(a.itemSelected=!0),!a.multiCheck.all&&(a.itemSelected=!1),angular.forEach(a.gridApi.grid.rows,function(e){e.isSelected=a.multiCheck.all})):(a.multiCheck.all=!0,a.itemSelected=!1,angular.forEach(a.gridApi.grid.rows,function(e){e.isSelected||delete a.multiCheck.all,e.isSelected&&(a.itemSelected=!0)})),a.allItems=a.gridApi.grid.rows},o&&l.device.type({project:o},function(e){a.deviceType=e.result,a.deviceType.length&&(a.deviceType.select=function(e){delete a.multiCheck.all,a.deviceType.selected=e,a.list()})(a.deviceType[0])}),a.gridOptions={onRegisterApi:function(t){t.infiniteScroll.on.needLoadMoreData(e,function(){var e=i.defer(),n=function(){e.resolve()},l=function(){t.infiniteScroll.dataLoaded(),e.reject()};return function(e){e?e.then(function(){t.infiniteScroll.saveScrollPercentage(),t.infiniteScroll.dataLoaded(!1,!0).then(n,l)},l):l()}(a.list(!0)),e.promise}),a.gridApi=t},infiniteScrollDown:!0,enableColumnResizing:!0,enableColumnMoving:!1},a.batchControl={turnOn:{entity:{status:{switch:"EMC_ON"}}},turnOff:{entity:{status:{switch:"EMC_OFF"}}},cool:{entity:{status:{mode:"EMC_COOLING"}}},heat:{entity:{status:{mode:"EMC_HEATING"}}},send:{entity:{status:{mode:"EMC_HEATING"}}},temperature:{entity:{status:{temperature:16}}},windspeed:{entity:{status:{windspeed:""}}},mode:{entity:{status:{mode:""}}}},a.columnDefsData=function(){"ELECTRICITYMETER"===a.deviceType.selected.id?(a.gridOptions.rowHeight=45,a.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:45,minWidth:45,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"传感器",name:"title",minWidth:290,pinnedLeft:!0,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">传感器</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected">批量控制行：</div>',enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"开关",name:"status_switch1",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOn,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOff,\'EMC_SWITCH\',\'switch\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.switch" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_SWITCH" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"  data-on-color="primary"></switch></div>'},{displayName:"功率",type:"number",name:"channels1",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback focus"><span class="form-control text-right" ng-bind="row.entity.channels[\'11\'].lasttotal" ></span><span class="form-control-feedback">KWh</span></div></div>'}]):"HOTWATERMETER"===a.deviceType.selected.id?(a.gridOptions.rowHeight=45,a.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"传感器",name:"title",minWidth:290,pinnedLeft:!0,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">传感器</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected">批量控制行：</div>',enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"开关",name:"status_switch2",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOn,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOff,\'EMC_SWITCH\',\'switch\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.switch" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_SWITCH" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"  data-on-color="primary"></switch></div>'},{displayName:"刻度",type:"number",name:"channels2",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback focus"><span class="form-control text-right" ng-bind="row.entity.channels[\'03\'].lasttotal" ></span><span class="form-control-feedback">KWh</span></div></div>'}]):"COLDWATERMETER"===a.deviceType.selected.id?(a.gridOptions.rowHeight=45,a.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"传感器",name:"title",minWidth:150,pinnedLeft:!0,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">传感器</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected">批量控制行：</div>',enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"开关",name:"status_switch3",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOn,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOff,\'EMC_SWITCH\',\'switch\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.switch" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_SWITCH" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"  data-on-color="primary"></switch></div>'},{displayName:"刻度",type:"number",name:"channels3",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback focus"><span class="form-control text-right" ng-bind="row.entity.channels[\'01\'].lasttotal" ></span><span class="form-control-feedback">KWh</span></div></div>'}]):"ENERGYMETER"===a.deviceType.selected.id?(a.gridOptions.rowHeight=45,a.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"序号",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"传感器",name:"title",minWidth:150,pinnedLeft:!0,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">传感器</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected">批量控制行：</div>',enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"开关",name:"status_mode04",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.cool,\'EMC_MODE\',\'mode\',\'mode\')">制冷</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.heat,\'EMC_MODE\',\'mode\',\'mode\')">制热</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.mode" state-on="EMC_COOLING" state-off="EMC_HEATING" disabled="!row.entity.command.EMC_MODE" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_MODE\',\'mode\',\'mode\')" data-on-text="制冷" data-off-text="制热" data-on-color="info" data-off-color="danger"></switch></div>'},{displayName:"供水温度",type:"number",name:"channels_040",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback focus"><span class="form-control text-right" ng-bind="row.entity.channels[\'05\'].lasttotal"></span><span class="form-control-feedback"><i class="emweb web-degree"></i></span></div></div>'},{displayName:"回水温度",type:"number",name:"channels_041",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback focus"><span class="form-control text-right" ng-bind="row.entity.channels[\'06\'].lasttotal"></span><span class="form-control-feedback"><i class="emweb web-degree"></i></span></div></div>'},{displayName:"温差",type:"number",name:"channels_042",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:"<div class=\"ui-grid-cell-contents\"><div class=\"form-group form-group-sm has-feedback focus\"><span class=\"form-control text-right\" ng-bind=\"(row.entity.channels['05'].lasttotal>row.entity.channels['06'].lasttotal?row.entity.channels['05'].lasttotal-row.entity.channels['06'].lasttotal:row.entity.channels['06'].lasttotal-row.entity.channels['05'].lasttotal).toFixed(2)\"></span><span class=\"form-control-feedback\"><i class=\"emweb web-degree\"></i></span></div></div>"},{displayName:"流量",type:"number",name:"channels_043",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback"><span class="form-control text-right" ng-bind="row.entity.channels[\'04\'].lasttotal"></span><span class="form-control-feedback">KWh</span></div></div>'},{displayName:"流速",type:"number",name:"channels_044",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback"><span class="form-control text-right" ng-bind="row.entity.channels[\'09\'].lasttotal"></span><span class="form-control-feedback">KWh</span></div></div>'},{displayName:"总冷量",type:"number",name:"channels_045",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback"><span class="form-control text-right" ng-bind="row.entity.channels[\'07\'].lasttotal"></span><span class="form-control-feedback">KWh</span></div></div>'},{displayName:"总热量",type:"number",name:"channels_046",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback"><span class="form-control text-right" ng-bind="row.entity.channels[\'08\'].lasttotal"></span><span class="form-control-feedback">KWh</span></div></div>'},{displayName:"发送",name:"send",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">发送</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend()">发送 <i class="glyphicon glyphicon-send"></i></a></div>',cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend(row)">发送 <i class="glyphicon glyphicon-send"></i></a></div>'}]):"TEMPERATURECONTROL"===a.deviceType.selected.id?(a.gridOptions.rowHeight=45,a.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"温控器名",name:"title",minWidth:150,pinnedLeft:!0,enableColumnMenu:!0,headerCellTemplate:'<div class="ui-grid-cell-contents"  ng-if="!grid.appScope.$ctrl.itemSelected">温控器名</div><div class="ui-grid-cell-contents"  ng-if="grid.appScope.$ctrl.itemSelected">批量控制行：</div>',enableSorting:!0,cellClass:"pt5"},{displayName:"面板开关",name:"status_switch5",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOn,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOff,\'EMC_SWITCH\',\'switch\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.switch" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_SWITCH" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"  data-on-color="primary"></switch></div>'},{displayName:"阀控开关",name:"status_valve5",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOn,\'EMC_VALVE\',\'valve\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOff,\'EMC_VALVE\',\'valve\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.valve" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_VALVE" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_VALVE\',\'valve\',\'mode\')" data-on-text="开" data-off-text="关"  data-on-color="primary"></switch></div>'},{displayName:"设置温度",name:"channels_050",minWidth:220,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents"  ng-if="!grid.appScope.$ctrl.itemSelected">设置温度</div><div class="ui-grid-cell-contents pl10 pr10" ng-if="grid.appScope.$ctrl.itemSelected"><control-slider value="grid.appScope.$ctrl.batchControl.temperature.entity.status.temperature" on-slider="grid.appScope.$ctrl.multiControl(grid.appScope.$ctrl.batchControl.temperature,\'EMC_TEMPERATURE\',\'temperature\',\'value\')"></control-slider></div>',cellTemplate:'<div class="ui-grid-cell-contents pl10 pr10"><control-slider value="row.entity.status.temperature" disabled="!row.entity.command.EMC_TEMPERATURE" on-slider="grid.appScope.$ctrl.multiControl(row,\'EMC_TEMPERATURE\',\'temperature\',\'value\')"></control-slider></div>'},{displayName:"室内温度",type:"number",name:"channels_051",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback focus"><span class="form-control text-right" ng-bind="row.entity.status.inroomtemperature||row.entity.channels[\'40\'].lasttotal"></span><span class="form-control-feedback"><i class="emweb web-degree"></i></span></div></div>'},{displayName:"能量值(度)",type:"number",name:"channels_052",minWidth:140,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="input-group input-group-sm focus"><span class="input-group-addon"><i class="emweb web-charging"></i></span><span class="form-control" ng-bind="row.entity.channels[\'33\'].lasttotal"></span></div></div>'},{displayName:"风速",name:"status_windspeed5",minWidth:130,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents"  ng-if="!grid.appScope.$ctrl.itemSelected">风速</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><control-speed speed="grid.appScope.$ctrl.batchControl.windspeed.entity.status.windspeed" on-speed="grid.appScope.$ctrl.multiControl(grid.appScope.$ctrl.batchControl.windspeed,\'EMC_WINDSPEED\',\'windspeed\',\'mode\')"></control-speed></div>',cellTemplate:'<div class="ui-grid-cell-contents"><control-speed speed="row.entity.status.windspeed" disabled="!row.entity.command.EMC_WINDSPEED" on-speed="grid.appScope.$ctrl.multiControl(row,\'EMC_WINDSPEED\',\'windspeed\',\'mode\')"></control-speed></div>'},{displayName:"模式",name:"status_mode5",minWidth:300,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents"  ng-if="!grid.appScope.$ctrl.itemSelected">模式</div><div class="ui-grid-cell-contents"  ng-if="grid.appScope.$ctrl.itemSelected"><control-mode class="btn-group" ng-if="grid.appScope.$ctrl.itemSelected" mode="grid.appScope.$ctrl.batchControl.mode.entity.status.mode" on-mode="grid.appScope.$ctrl.multiControl(grid.appScope.$ctrl.batchControl.mode,\'EMC_MODE\',\'mode\',\'mode\')"></control-mode></div>',cellTemplate:'<div class="ui-grid-cell-contents"><control-mode class="btn-group" mode="row.entity.status.mode" disabled="!row.entity.command.EMC_MODE" on-mode="grid.appScope.$ctrl.multiControl(row,\'EMC_MODE\',\'mode\',\'mode\')"></control-mode></div>'},{displayName:"发送",name:"send",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">发送</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend()">发送 <i class="glyphicon glyphicon-send"></i></a></div>',cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend(row)">发送 <i class="glyphicon glyphicon-send"></i></a></div>'}]):"TIMERMETER"===a.deviceType.selected.id&&(a.gridOptions.rowHeight=45,a.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"时间采集器",name:"title",minWidth:150,pinnedLeft:!0,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">时间采集器</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected">批量控制行：</div>',enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"二通阀",name:"valve_control",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOn,\'EMC_VALVE\',\'valve\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOff,\'EMC_VALVE\',\'valve\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.valve" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_VALVE" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_VALVE\',\'valve\',\'mode\')" data-on-text="开" data-off-text="关"  data-on-color="primary"></switch></div>'},{displayName:"开关",name:"status_mode04",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.cool,\'EMC_MODE\',\'mode\',\'mode\')">制冷</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.heat,\'EMC_MODE\',\'mode\',\'mode\')">制热</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.mode" state-on="EMC_COOLING" state-off="EMC_HEATING" disabled="!row.entity.command.EMC_MODE" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_MODE\',\'mode\',\'mode\')" data-on-text="制冷" data-off-text="制热" data-on-color="info" data-off-color="danger"></switch></div>'},{displayName:"档位",name:"gears",minWidth:130,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><control-speed speed="row.entity.status.windspeed" disabled="!row.entity.command.EMC_WINDSPEED" on-speed="grid.appScope.$ctrl.multiControl(row,\'EMC_WINDSPEED\',\'windspeed\',\'mode\')"></control-speed></div>'},{displayName:"发送",name:"send",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">发送</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend()">发送 <i class="glyphicon glyphicon-send"></i></a></div>',cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend(row)">发送 <i class="glyphicon glyphicon-send"></i></a></div>'}])},a.list=function(e){if(a.itemSelected=!1,!(e&&a.gridOptions.paging&&a.gridOptions.paging.count<=a.gridOptions.paging.pageindex*a.gridOptions.paging.pagesize))return a.deviceType&&a.deviceType.selected?l.business.monitor({devicetype:a.deviceType.selected.id,project:o,key:a.searchKey,ext:{enableMask:1},mode:"SENSOR",usesocity:a.customerSelected?1:void 0,socitynode:a.customerSelected,pageindex:(e&&a.gridOptions.paging?a.gridOptions.paging.pageindex:0)+1,pagesize:50},function(t){return t=t.result[o]||{},angular.forEach(t.detail,function(e){"TEMPERATURECONTROL"===a.deviceType.selected.id&&(e.status.temperature=e.status.temperature||e.channels[37]&&e.channels[37].lasttotal),angular.forEach(e.command,function(t){e.command[t]=t})}),e?a.gridOptions.data=a.gridOptions.data.concat(t.detail||[]):(a.gridOptions.data=t.detail||[],a.gridOptions.data.length&&n(function(){a.gridApi.core.scrollTo(a.gridOptions.data[0],a.gridOptions.columnDefs[0])})),a.gridOptions.paging=t.paging,a.multiCheck.all&&n(function(){a.multiCheck("all")}),a.columnDefsData(),t}).$promise:void 0},e.$watch("$ctrl.customerSelected",function(){a.list()}),a.confirmControl=function(e,t,n,a){var s=d(e,t,n),r={};e.entity&&(r[a]=e.entity.status[n]),c.swal({title:"控制校验",input:"password",cancelButtonText:"取消",confirmButtonText:"确定",inputPlaceholder:"控制密码",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:!1,preConfirm:function(n){var c=i.defer();return n?l.control.send({id:e.entity&&e.entity.id&&e.entity.id||s,project:o,command:t,param:r,ctrlcode:(new Hashes.SHA1).hex(n).toUpperCase()},function(e){e.code?c.reject("密码校验未通过"):c.resolve(e)}):c.reject("请输入控制密码"),c.promise}}).then(function(){c.close()},function(){d(s,t,n)})},a.multiControl=function(e,t,n,i){var s=d(e,t,n),r={};r[i]=e.entity.status[n],l.control.send({id:s,project:o,command:t,param:r},function(e){s.length>=1&&a.list(),e.code&&(d(s,t,n),c.error("操作失败",e.message))})},a.commandSend=function(e){a.selectedItem=[],!e&&angular.forEach(a.gridApi.grid.rows,function(e){e.isSelected&&e.entity.command!==[]&&a.selectedItem.push(e.entity.id)}),e&&e.entity.command!==[]&&(a.selectedItem=e.entity.id)}}]}),angular.module("app").component("controlSlider",{templateUrl:"app/modules/control/slider.html?rev=b1167923cd",bindings:{value:"=",disabled:"<",onSlider:"&"},controller:["$scope","$element",function(e,t){var n,l=this,i=t.children(".ui-slider"),c=angular.extend({min:16,max:30,orientation:"horizontal",range:"min"},t.data()),a=!1,o=function(e,t){l.value!==t.value&&(a=!0,n=l.value,l.value=t.value)},d=function(t,n){l.uivalue=n.value,e.$apply()};i.slider(c),e.$watch("$ctrl.value",function(e){a?(a=!1,l.onSlider()):angular.isUndefined(e)&&angular.isDefined(n)?(l.value=n,l.uivalue=n,n=void 0):(angular.isDefined(e)&&e>c.max&&(e=Math.ceil(e%c.max)),l.uivalue=e||20,i.off("slide"),i.off("slidechange"),i.slider("option","disabled",!!(angular.isDefined(l.disabled)?l.disabled:c.disabled)),i.slider("option","value",l.uivalue),i.on("slide",d),i.on("slidechange",o))})}]}),angular.module("app").component("controlSpeed",{template:'<i class="emweb" ng-repeat="(key,val) in $ctrl.items" ng-class="[val,{active:$ctrl.speed===key}]" ng-click="$ctrl.click(key)"></i>',bindings:{speed:"=",disabled:"<",onSpeed:"&"},controller:["$scope",function(e){var t,n=this,l=!1;n.items={EMC_LOW:"web-speed-three",EMC_MEDIUM:"web-speed-four",EMC_HIGH:"web-speed-five"},n.disabled||(n.click=function(e){l=!0,t=n.speed,n.speed=e},e.$watch("$ctrl.speed",function(e){l===!0?(l=!1,n.onSpeed()):angular.isUndefined(e)&&angular.isDefined(t)?(n.speed=t,t=void 0):n.speed=e}))}]}),angular.module("app").component("controlMode",{template:'<a href="javascript:void(0)" class="btn btn-sm btn-primary" ng-repeat="(key,item) in $ctrl.items" ng-class="{active:$ctrl.mode===key}" ng-click="$ctrl.click(key)"><i class="emweb" ng-class="item.icon"></i>{{item.name}}</a>',bindings:{mode:"=",disabled:"<",onMode:"&"},controller:["$scope",function(e){var t,n=this,l=!1;n.items={EMC_COOLING:{icon:"web-snow",name:"制冷"},EMC_HEATING:{icon:"web-sun",name:"制热"},EMC_DEHUMIDIFYING:{
icon:"web-clear-wet",name:"除湿"},EMC_VERTILATING:{icon:"web-ventilation",name:"通风"}},n.disabled||(n.click=function(e){l=!0,t=n.mode,n.mode=e},e.$watch("$ctrl.mode",function(e){l===!0?(l=!1,n.onMode()):angular.isUndefined(e)&&angular.isDefined(t)?(n.mode=t,t=void 0):n.mode=e}))}]}),angular.module("app").component("controlCommand",{templateUrl:"app/modules/control/command.html?rev=fa19bacbe1",bindings:{selected:"="},controller:["$scope","$element","$api","SweetAlert",function(e,t,n,l){var i,c=this,a=t.children(".modal");e.$watch("$ctrl.selected",function(t){t&&(c.formData={sensorid:t},a.modal("show"),i=e.form)}),c.submit=function(){n.control.through(c.formData,function(e){!function(e,t){e?(angular.forEach({60000001:"发送超时",60000002:"发送超时",60000003:"发送超时"},function(n,l){parseInt(e)===parseInt(l)&&(t=n)}),t&&l.warning.apply(l,angular.isArray(t)?t:[t])):l.success("发送成功")}(e.code,e.message)})},c.reset=function(){delete c.formData.command,delete c.formData.data},a.on("hidden.bs.modal",function(){return delete c.selected,delete c.formData,i.$setPristine(),e.$apply(),!1}),a.find("input[name=command]").on("invalid",function(){return i.command.$setDirty(),e.$apply(),!1}),a.find("input[name=data]").on("invalid",function(){return i.data.$setDirty(),e.$apply(),!1})}]});