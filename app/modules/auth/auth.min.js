angular.module("app").component("auth",{templateUrl:"app/modules/auth/auth.html?rev=f22832f774",controller:["$scope","$cookies","$element","$timeout","$state","$stateParams","User","md5","SweetAlert",function(e,o,a,t,r,l,n,s,i){var c=this,d=l.action||"logout",g=/cloudenergy\.me/.test(location.hostname)?".cloudenergy.me":location.hostname;c.isBasic=/^basic\./.test(location.host),c.user=localStorage.loginUser,c.passwd=localStorage.loginPasswd,c.remember=!!localStorage.loginRemember,c.readonly=!0,t(function(){c.readonly=!1},500),a.find("input[name=remember]").radiocheck(),c.clearUserInput=function(){delete localStorage.loginUser,delete c.user,delete localStorage.loginPasswd,delete c.passwd,delete localStorage.loginRemember,delete c.remember},c.clearPasswdInput=function(){delete localStorage.loginPasswd,delete c.passwd,delete localStorage.loginRemember,delete c.remember},c.login=function(e){var a=c.remember;e.$invalid?(!c.user&&e.user.$setDirty(),!c.passwd&&e.password.$setDirty()):(delete localStorage.loginUser,delete localStorage.loginPasswd,delete localStorage.loginRemember,localStorage.loginUser=c.user,a&&(localStorage.loginPasswd=c.passwd,localStorage.loginRemember=a),n.login({user:c.user,passwd:s.createHash(c.passwd).toUpperCase()}).then(function(e){!function(e,o){e&&angular.forEach({20000001:"用户不存在",90000001:"服务器错误",90000002:"拒绝访问",90000003:"登录失败",90000004:"权限不足",90000005:"未登录",90000006:["验证失败","账号或密码有误"],90000007:"签名校验失败"},function(a,t){parseInt(e)===parseInt(t)&&(o=a)}),o&&i.error.apply(i,angular.isArray(o)?o:[o])}(e.code||e.err,e.message),APP.User.token?(angular.forEach(["token","user"],function(e){APP.User[e]&&o.put(e,APP.User[e]||!1,{path:"/",domain:g,expires:a&&moment().add(1,"months")._d||void 0})}),r.go(r.prev.state||"dashboard.main",APP.User.groupmode&&r.prev.params||{})):r.go("auth",{action:"login"})}))},"logout"===d&&n.logout({redirect:"/"}).then(function(){angular.forEach(["token","user"],function(e){o.remove(e,{path:"/"}),o.remove(e,{path:"/",domain:g}),o.remove(e,{path:"/",domain:".www"+g})}),r.go("auth",{action:"login"})})}]});