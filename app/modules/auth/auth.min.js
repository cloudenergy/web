angular.module("app").component("auth",{templateUrl:"app/modules/auth/auth.html?rev=beaa1390bb",controller:["$scope","$cookies","$element","$timeout","$state","$stateParams","User","md5","SweetAlert",function(e,o,a,r,t,l,n,c,s){var m=this,g=l.action||"logout",i=/cloudenergy\.me/.test(location.hostname)?".cloudenergy.me":location.hostname,u=/cloudenergy\.me/.test(location.hostname)?/^(\w+)\./.exec(location.hostname)[1].toLowerCase():"www",d={www:{src:"app/modules/auth/img/logo.png?rev=b0dcbb2509",title:"智慧云能源用户平台"},basic:{src:"app/modules/auth/img/logo_basic.png?rev=dfa0152ed7",title:"柏诚智能云能源用户平台"},intel:{src:"app/modules/auth/img/logo_hongzhi.png?rev=22cdae43dc",title:"鸿智途源云能源用户平台"}};m.logoSrc=d[u]&&d[u].src||d.www.src,m.logoTitle=d[u]&&d[u].title||d.www.title,m.user=localStorage.loginUser,m.passwd=localStorage.loginPasswd,m.remember=!!localStorage.loginRemember,m.rememberaccount=!!localStorage.rememberAccount,m.readonly=!0,r(function(){m.readonly=!1},500),a.find("input[type=checkbox]").radiocheck(),m.clearUserInput=function(){delete localStorage.loginUser,delete m.user,delete localStorage.loginPasswd,delete m.passwd,delete localStorage.loginRemember,delete m.remember,delete localStorage.rememberAccount,delete m.rememberaccount},m.clearPasswdInput=function(){delete localStorage.loginPasswd,delete m.passwd,delete localStorage.loginRemember,delete m.remember},e.$watch("$ctrl.rememberaccount",function(){m.rememberaccount?"":m.remember=m.rememberaccount}),e.$watch("$ctrl.remember",function(){m.remember?m.rememberaccount=m.remember:""}),m.login=function(e){var a=m.remember,r=m.rememberaccount;e.$invalid?(!m.user&&e.user.$setDirty(),!m.passwd&&e.password.$setDirty()):(delete localStorage.loginUser,delete localStorage.loginPasswd,delete localStorage.loginRemember,delete localStorage.rememberAccount,localStorage.loginUser=m.user,a&&(localStorage.loginPasswd=m.passwd,localStorage.loginRemember=a,localStorage.rememberAccount=r,localStorage.loginUser=m.user),!a&&r&&(delete localStorage.loginPasswd,delete localStorage.loginRemember,localStorage.rememberAccount=r,localStorage.loginUser=m.user),n.login({user:m.user,passwd:c.createHash(m.passwd).toUpperCase()}).then(function(e){angular.forEach(["token","uid","user"],function(e){APP.User[e]&&o.put(e,APP.User[e]||!1,{path:"/",domain:i,expires:a&&moment().add(1,"months")._d||void 0})}),t.go(t.prev.state||"dashboard.main",APP.User.groupmode&&t.prev.params||{})},function(e){angular.forEach({20000001:"用户不存在",90000001:"服务器错误",90000002:"拒绝访问",90000003:"登录失败",90000004:"权限不足",90000005:"未登录",90000006:["验证失败","账号或密码有误"],90000007:"签名校验失败"},function(o,a){parseInt(e.code)===parseInt(a)&&(e.message=o)}),e.message&&s.error.apply(s,angular.isArray(e.message)?e.message:[e.message])}))},"logout"===g&&n.logout({redirect:"/"}).then(function(){angular.forEach(["token","uid","user"],function(e){o.remove(e,{path:"/",domain:".www"+i}),o.remove(e,{path:"/",domain:i}),o.remove(e,{path:"/"})}),t.go("auth",{action:"login"})})}]});