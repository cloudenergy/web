angular.module("app").component("main",{templateUrl:"app/modules/main/main.html?rev=8d60e90676",controller:function(){this.groupmode=APP.User.groupmode,this.selectDay=moment().format("YYYYMMDD"),this.selectMonth=moment().format("YYYYMM")}}),angular.module("app").component("mainCalendar",{templateUrl:"app/modules/main/calendar.html?rev=649f4c1915",bindings:{groupmode:"<",selectDay:"=",selectMonth:"="},controller:["$scope","$element","$timeout","$api",function(e,t,a,n){var i=this,o=t.find("datetimepicker").on("dp.change",function(e){a(function(){i.selectDay=e.date.format("YYYYMMDD"),i.selectMonth=e.date.format("YYYYMM"),i.bindTD()})}).on("dp.update",function(e){angular.equals(e.viewDate.format("YYYYMM"),i.selectMonth)?i.bindTD():o.data("DateTimePicker").defaultDate(e.viewDate._d)});i.bindTD=function(){i.calendarData&&o.find(".datepicker-days table tbody td.day").each(function(){if(!/old|new/i.test(this.className)){var e=$(this),t=e.data("day"),a="emstatus-keep";i.calendarData.detail[t]>i.calendarData.average&&(a="emstatus-up"),i.calendarData.detail[t]>i.calendarData.average&&(a="emstatus-down"),e.removeClass("emstatus-up").removeClass("emstatus-down").removeClass("emstatus-keep"),i.calendarData.detail[t]&&e.addClass(a)}}),o.find(".datepicker-days table tbody td.active").click(function(){return!1})},e.$watch("$ctrl.selectMonth",function(e){n.business.calendar({time:e,project:APP.Project[0].id,assemble:i.groupmode},function(e){e=i.groupmode?e.result:e.result[APP.Project[0].id],i.calendarData=e||{},i.calendarData.detail=i.calendarData.detail,i.groupmode?i.calendarData.average=i.calendarData.buildingConsumption/(i.calendarData.detail&&Object.keys(i.calendarData.detail).length||0):i.calendarData.average=i.calendarData.buildingConsumption/(i.calendarData.detail&&i.calendarData.detail.length||0),angular.forEach(i.calendarData.detail,function(e,t){i.groupmode?this[moment(1*t).format("YYYY-MM-DD")]=e:this[moment(1*e._id).format("YYYY-MM-DD")]=e.value},i.calendarData.detail={}),i.bindTD()})})}]}),angular.module("app").component("mainDailycost",{templateUrl:"app/modules/main/dailycost.html?rev=e311a82e7a",bindings:{groupmode:"<",selectDay:"<"},controller:["$api",function(e){var t=this;t.$onChanges=function(){t.showDay=t.selectDay.toString().replace(/^(\d{4})(\d{2})(\d{2})$/,"$1-$2-$3"),e.business.dailycost({time:t.selectDay,project:APP.Project.ids,assemble:t.groupmode},function(e){e=t.groupmode?e.result||{}:e.result[APP.Project[0].id]||{},t.currentDayqoq=Math.round(100*e.qoqPercent)/100,t.currentDayyoy=Math.round(100*e.yoyPercent)/100,t.dailycost={chart:{margin:[0,0,0,0],style:{textAlign:"center"},type:"pie"},title:{text:'<div class="pieTitle">今日费用</div><div class="pieNumber">'+e.cost+'</div><div class="pieUnit">元</div>',verticalAlign:"middle",useHTML:!0,y:-12},tooltip:!1,plotOptions:{pie:{dataLabels:!1,innerSize:"85%"}},series:[{data:[e.cost]}]}})}}]}),angular.module("app").component("mainMonthlykgce",{templateUrl:"app/modules/main/monthlykgce.html?rev=b3bc3dbe34",bindings:{groupmode:"<",selectMonth:"<"},controller:["$api",function(e){var t=this;t.$onChanges=function(){t.showDay=t.selectMonth.toString().replace(/^(\d{4})(\d{2})$/,"$1-$2"),e.business.monthlykgce({time:t.selectMonth,project:APP.Project.ids},function(e){var a=[],n=0,i=0,o=0;t.groupmode?(angular.forEach(e.result,function(e,t){this.push([APP.Project[t].title,e.kgce]),n+=e.kgce,i+=e.kgceperunitarea,o+=e.kwhperunitarea},e.detail=[]),a.push({data:e.detail})):(e=e.result[APP.Project[0].id]||{},angular.forEach(e.detail,function(e,t){this.push([t,e])},e.detail=[]),a.push({data:e.detail}),n=e.kgce,i=e.kgceperunitarea,o=e.kwhperunitarea),t.currentMonthKgceperunitarea=Math.round(100*i)/100,t.currentMonthKwhperunitarea=Math.round(100*o)/100,t.monthlykgce={chart:{marginBottom:0,marginLeft:0,marginRight:140,marginTop:0,style:{textAlign:"center"},type:"pie"},title:{text:'<div class="pieTitle">月综合能耗</div><div class="pieNumber">'+Math.round(100*n)/100+'</div><div class="pieUnit">千克煤</div>',verticalAlign:"middle",useHTML:!0,x:-70,y:-12},tooltip:{pointFormat:" <b>{point.y}</b> 千克煤"},plotOptions:{pie:{dataLabels:!1,innerSize:"85%",showInLegend:!0}},legend:{verticalAlign:"middle",layout:"vertical",labelFormatter:function(){return'<div style="text-align:left;">'+Math.round(10*this.percentage)/10+"% "+this.name+'</div><div style="color:#BBB;text-align:left;">'+this.y+"KGce</div>"},itemWidth:100,useHTML:!0,x:140},series:a}})}}]}),angular.module("app").component("air",{templateUrl:"app/modules/main/air.html?rev=4b9c6bba2c",bindings:{groupmode:"<",selectDay:"<"},controller:["$api","$ocLazyLoad",function(e,t){var a=t.load(["//cdn.hcharts.cn/highcharts/highcharts-more.js","//cdn.hcharts.cn/highcharts/modules/solid-gauge.js"]),n=this;n.$onChanges=function(){a.then(function(){n.showDay=n.selectDay.toString().replace(/^(\d{4})(\d{2})$/,"$1-$2"),e.business.airquality({},function(e){var t,a=e.result.pm25max;n.air={chart:{type:"gauge",plotBackgroundColor:null,plotBackgroundImage:null,plotBorderWidth:0,plotShadow:!1},title:{text:""},credits:{enabled:!1},pane:{startAngle:-150,endAngle:150,background:[{backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#FFF"],[1,"#333"]]},borderWidth:0,outerRadius:"109%"},{backgroundColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#333"],[1,"#FFF"]]},borderWidth:1,outerRadius:"107%"},{},{backgroundColor:"#DDD",borderWidth:0,outerRadius:"105%",innerRadius:"103%"}]},yAxis:{min:0,max:500,minorTickInterval:"auto",minorTickWidth:1,minorTickLength:10,minorTickPosition:"inside",minorTickColor:"#666",tickPixelInterval:30,tickWidth:2,tickPosition:"inside",tickLength:10,tickColor:"#666",labels:{step:2,rotation:"auto"},title:{text:"μm/m3"},plotBands:[{from:0,to:50,color:"#00A286"},{from:50,to:100,color:"#FFE300"},{from:100,to:150,color:"#EE9200"},{from:150,to:200,color:"#DD001E"},{from:200,to:300,color:"#74009A"},{from:300,to:400,color:"#89001A"},{from:400,to:500,color:"#89001A"}]},series:[{name:"PM2.5",data:[80],tooltip:{valueSuffix:" μm/m3"}}]},$("#container-pm25").highcharts(window.Highcharts.merge(n.air,function(e){if(!e.renderer.forExport){var t=e.series[0].points[0];t.update(Number(a))}}));var i=$("#container-pm25").highcharts();i&&(t=i.series[0].points[0],t.update(Number(a)))})})}}]}),angular.module("app").component("mainEnergyconstitute",{templateUrl:"app/modules/main/energyconstitute.html?rev=a5cb122d80",bindings:{selectMonth:"<"},controller:["$api",function(e){var t=this;t.$onChanges=function(){t.showDay=t.selectMonth.toString().replace(/^(\d{4})(\d{2})$/,"$1-$2"),e.business.energyconstitute({time:t.selectMonth,project:APP.Project[0].id},function(e){var a=[],n=[];angular.forEach(e.result[APP.Project[0].id]||{},function(e,t,i){Object.keys(e).length>a.length&&(i=0,a=[]),angular.forEach(e,function(e,t){this.push(e),0===i&&a.push(parseInt(t))},e=[]),n.push({data:e,name:t})}),t.energyconstitute={chart:{type:"spline"},title:!1,xAxis:{type:"datetime",categories:a,labels:{formatter:function(){return moment(this.value).format("M-DD")}}},yAxis:{title:!1},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y}元</span>'},series:n}})}}]}),angular.module("app").component("mainDailysensordetail",{templateUrl:"app/modules/main/dailysensordetail.html?rev=4b5969dce3",bindings:{selectMonth:"<"},controller:["$api",function(e){var t=this;t.$onChanges=function(){e.business.dailysensordetail({time:t.selectMonth,project:APP.Project[0].id},function(e){e=e.result[APP.Project[0].id]||{};var a=0;angular.forEach(e,function(e,t){this.push([t,e]),a+=100*e},e=[]),t.dailysensordetail={chart:{marginLeft:-10,marginRight:200,style:{textAlign:"left"},type:"pie"},title:{text:'<div class="pieTitle">'+t.selectMonth.toString().replace(/^(\d{4})(\d{2})$/,"$1年$2月")+"能耗</div><div>"+a/100+"KWh</div>",verticalAlign:"middle",useHTML:!0,x:-100,y:-5},tooltip:{pointFormat:"<b>{point.y:.2f}kWh {point.percentage:.2f}%</b>"},plotOptions:{pie:{dataLabels:!1,innerSize:"85%",showInLegend:!0}},legend:{align:"center",verticalAlign:"middle",layout:"vertical",labelFormatter:function(){var e=Math.round(10*this.percentage)/10+"% "+this.name,t=Math.round(100*(this.y||0))/100+"kWh";return['<span class="center-block" title="'+e+'">'+e+"</span>",'<span class="center-block text-muted" title="'+t+'">'+t+"</span>"].join("")},itemWidth:200,x:140,useHTML:!0},series:[{cropThreshold:0,turboThreshold:0,data:e}]}})}}]}),angular.module("app").component("mainEnergyeffectiverate",{templateUrl:"app/modules/main/energyeffectiverate.html?rev=908a964e8f",bindings:{groupmode:"<",selectMonth:"<"},controller:["$api",function(e){var t=this;t.$onChanges=function(){t.showDay=t.selectMonth.toString().replace(/^(\d{4})(\d{2})$/,"$1-$2"),e.business.energyeffectiverate({time:t.selectMonth,project:APP.Project.ids,assemble:t.groupmode},function(e){var a=[],n=[];angular.forEach(e.result||{},function(e,t,i){Object.keys(e).length>a.length&&(i=0,a=[]),angular.forEach(e,function(e,t){this.push(Math.round(100*e.value)/100),0===i&&a.push(1e3*t)},e=[]),n.push({data:e,name:{now:"本月能效",yoy:"同期能效"}[t]||t})}),t.energyeffectiverate={chart:{type:"spline"},title:!1,xAxis:{type:"datetime",categories:a,labels:{formatter:function(){return moment(this.value).format("M-DD")}}},yAxis:{title:!1},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y}KWh</span>'},series:n}})}}]}),angular.module("app").component("mainProjectdetail",{templateUrl:"app/modules/main/projectdetail.html?rev=452e95f2f2",bindings:{selectMonth:"<"},controller:["$api",function(e){var t=this;t.$onChanges=function(){e.business.projectdetail({time:t.selectMonth,project:APP.Project.ids},function(e){angular.forEach(e.result,function(e){e.data=[0,0,0,0,0],e.data[e.ecslevel-1]=e.uaec,this.push({name:e.name,data:e.data})},e.series=[]),t.projectdetail={chart:{type:"bar"},title:!1,xAxis:{categories:["0-1.8 KWh","1.8-3.8 KWh","3.8-5.7 KWh","5.7-7.7 KWh","7.7-∞ KWh"]},yAxis:{title:!1},tooltip:{valueSuffix:" KWh"},legend:{layout:"vertical",align:"right",verticalAlign:"bottom",y:-20,floating:!0,borderWidth:1},series:e.series}})}}]});