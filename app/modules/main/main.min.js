angular.module("app").component("main",{templateUrl:"app/modules/main/main.html?rev=8d10e26d51",controller:function(){this.selectDay=moment().format("YYYYMMDD"),this.selectMonth=moment().format("YYYYMM")}}),angular.module("app").component("mainCalendar",{templateUrl:"app/modules/main/calendar.html?rev=649f4c1915",bindings:{groupmode:"<",selectDay:"=",selectMonth:"="},controller:["$rootScope","$scope","$element","$timeout","$api",function(e,t,a,n,i){var o=this,r=a.find("datetimepicker").on("dp.change",function(e){n(function(){o.selectDay=e.date.format("YYYYMMDD"),o.selectMonth=e.date.format("YYYYMM"),o.bindTD()})}).on("dp.update",function(e){angular.equals(e.viewDate.format("YYYYMM"),o.selectMonth)?o.bindTD():r.data("DateTimePicker").defaultDate(e.viewDate._d)});o.bindTD=function(){o.calendarData&&r.find(".datepicker-days table tbody td.day").each(function(){if(!/old|new/i.test(this.className)){var e=$(this),t=e.data("day"),a="emstatus-keep";o.calendarData.detail[t]>o.calendarData.average&&(a="emstatus-up"),o.calendarData.detail[t]>o.calendarData.average&&(a="emstatus-down"),e.removeClass("emstatus-up").removeClass("emstatus-down").removeClass("emstatus-keep"),o.calendarData.detail[t]&&e.addClass(a)}}),r.find(".datepicker-days table tbody td.active").click(function(){return!1})},t.$watch("$ctrl.selectMonth",function(t){i.business.calendar({time:t,project:e.Project.ids,assemble:o.groupmode},function(t){t=o.groupmode?t.result:t.result[e.Project.current._id],o.calendarData=t||{},o.calendarData.detail=o.calendarData.detail,o.groupmode?o.calendarData.average=o.calendarData.buildingConsumption/(o.calendarData.detail&&Object.keys(o.calendarData.detail).length||0):o.calendarData.average=o.calendarData.buildingConsumption/(o.calendarData.detail&&o.calendarData.detail.length||0),angular.forEach(o.calendarData.detail,function(e,t){o.groupmode?this[moment(1*t).format("YYYY-MM-DD")]=e:this[moment(1*e._id).format("YYYY-MM-DD")]=e.value},o.calendarData.detail={}),o.bindTD()})})}]}),angular.module("app").component("mainDailycost",{templateUrl:"app/modules/main/dailycost.html?rev=7daac98ade",bindings:{groupmode:"<",selectDay:"<"},controller:["$rootScope","$api",function(e,t){var a=this;a.$onChanges=function(){a.showDay=a.selectDay.toString().replace(/^(\d{4})(\d{2})(\d{2})$/,"$1-$2-$3"),t.business.dailycost({time:a.selectDay,project:e.Project.ids,assemble:a.groupmode},function(t){t=a.groupmode?t.result||{}:t.result[e.Project.current._id]||{},a.qoqPercent=t.qoqPercent,a.yoyPercent=t.yoyPercent,a.dailycost={chart:{margin:[0,0,0,0],style:{textAlign:"center"},type:"pie"},title:{text:'<div class="pieTitle">今日费用</div><div class="pieNumber">'+t.cost+'</div><div class="pieUnit">元</div>',verticalAlign:"middle",useHTML:!0,y:-12},tooltip:!1,plotOptions:{pie:{dataLabels:!1,innerSize:"85%"}},series:[{data:[t.cost]}]}})}}]}),angular.module("app").component("mainMonthlykgce",{templateUrl:"app/modules/main/monthlykgce.html?rev=b3bc3dbe34",bindings:{groupmode:"<",selectMonth:"<"},controller:["$rootScope","$api",function(e,t){var a=this;a.$onChanges=function(){a.showDay=a.selectMonth.toString().replace(/^(\d{4})(\d{2})$/,"$1-$2"),t.business.monthlykgce({time:a.selectMonth,project:e.Project.ids},function(t){var n=[],i=0,o=0,r=0;a.groupmode?(angular.forEach(t.result,function(t,a){this.push([e.Project[a].title,t.kgce]),i+=t.kgce,o+=t.kgceperunitarea,r+=t.kwhperunitarea},t.detail=[]),n.push({data:t.detail})):(t=t.result[e.Project.current._id]||{},angular.forEach(t.detail,function(e,t){this.push([t,e])},t.detail=[]),n.push({data:t.detail}),i=t.kgce,o=t.kgceperunitarea,r=t.kwhperunitarea),a.currentMonthKgceperunitarea=Math.round(100*o)/100,a.currentMonthKwhperunitarea=Math.round(100*r)/100,a.monthlykgce={chart:{marginBottom:0,marginLeft:0,marginRight:140,marginTop:0,style:{textAlign:"center"},type:"pie"},title:{text:'<div class="pieTitle">月综合能耗</div><div class="pieNumber">'+Math.round(100*i)/100+'</div><div class="pieUnit">千克煤</div>',verticalAlign:"middle",useHTML:!0,x:-70,y:-12},tooltip:{pointFormat:" <b>{point.y}</b> 千克煤"},plotOptions:{pie:{dataLabels:!1,innerSize:"85%",showInLegend:!0}},legend:{verticalAlign:"middle",layout:"vertical",labelFormatter:function(){return'<div style="text-align:left;">'+Math.round(10*this.percentage)/10+"% "+this.name+'</div><div style="color:#BBB;text-align:left;">'+this.y+"KGce</div>"},itemWidth:100,useHTML:!0,x:140},series:n}})}}]}),angular.module("app").component("mainEnergyconstitute",{templateUrl:"app/modules/main/energyconstitute.html?rev=8f6caeec11",bindings:{selectMonth:"<"},controller:["$rootScope","$api",function(e,t){var a=this;a.$onChanges=function(){a.showDay=a.selectMonth.toString().replace(/^(\d{4})(\d{2})$/,"$1-$2"),t.business.energyconstitute({time:a.selectMonth,project:e.Project.current._id},function(t){var n=[],i=[];a.charttype="spline",angular.forEach(t.result[e.Project.current._id]||{},function(e,t,a){Object.keys(e).length>n.length&&(a=0,n=[]),angular.forEach(e,function(e,t){this.push(e),0===a&&n.push(parseInt(t))},e=[]),i.push({data:e,name:t})}),a.typeChange=function(e){e&&(a.charttype=e),a.energyconstitute={chart:{type:a.charttype},title:!1,xAxis:{type:"datetime",categories:n,labels:{formatter:function(){return moment(this.value).format("M-DD")}}},yAxis:{title:!1},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y}元</span>'},series:i}},a.typeChange()})}}]}),angular.module("app").component("mainDailysensordetail",{templateUrl:"app/modules/main/dailysensordetail.html?rev=4b5969dce3",bindings:{selectMonth:"<"},controller:["$rootScope","$api",function(e,t){var a=this;a.$onChanges=function(){t.business.dailysensordetail({time:a.selectMonth,project:e.Project.current._id},function(t){t=t.result[e.Project.current._id]||{};var n=0;angular.forEach(t,function(e,t){this.push([t,e]),n+=100*e},t=[]),a.dailysensordetail={chart:{marginLeft:-10,marginRight:200,style:{textAlign:"left"},type:"pie"},title:{text:'<div class="pieTitle">'+a.selectMonth.toString().replace(/^(\d{4})(\d{2})$/,"$1年$2月")+"能耗</div><div>"+n/100+"KWh</div>",verticalAlign:"middle",useHTML:!0,x:-100,y:-5},tooltip:{pointFormat:"<b>{point.y:.2f}kWh {point.percentage:.2f}%</b>"},plotOptions:{pie:{dataLabels:!1,innerSize:"85%",showInLegend:!0}},legend:{align:"center",verticalAlign:"middle",layout:"vertical",labelFormatter:function(){var e=Math.round(10*this.percentage)/10+"% "+this.name,t=Math.round(100*(this.y||0))/100+"kWh";return['<span class="center-block" title="'+e+'">'+e+"</span>",'<span class="center-block text-muted" title="'+t+'">'+t+"</span>"].join("")},itemWidth:200,x:140,useHTML:!0},series:[{cropThreshold:0,turboThreshold:0,data:t}]}})}}]}),angular.module("app").component("mainEnergyeffectiverate",{templateUrl:"app/modules/main/energyeffectiverate.html?rev=7e6e503ab0",bindings:{groupmode:"<",selectMonth:"<"},controller:["$rootScope","$api",function(e,t){var a=this;a.$onChanges=function(){a.showDay=a.selectMonth.toString().replace(/^(\d{4})(\d{2})$/,"$1-$2"),t.business.energyeffectiverate({time:a.selectMonth,project:e.Project.ids,assemble:a.groupmode},function(e){var t=[],n=[];a.charttype="spline",angular.forEach(e.result||{},function(e,a,i){Object.keys(e).length>t.length&&(i=0,t=[]),angular.forEach(e,function(e,a){this.push(Math.round(100*e.value)/100),0===i&&t.push(1e3*a)},e=[]),n.push({data:e,name:{now:"本月能效",yoy:"同期能效"}[a]||a})}),a.typeChange=function(e){e&&(a.charttype=e),a.energyeffectiverate={chart:{type:a.charttype},title:!1,xAxis:{type:"datetime",categories:t,labels:{formatter:function(){return moment(this.value).format("M-DD")}}},yAxis:{title:!1},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y}KWh</span>'},series:n}},a.typeChange()})}}]}),angular.module("app").component("mainProjectdetail",{templateUrl:"app/modules/main/projectdetail.html?rev=452e95f2f2",bindings:{selectMonth:"<"},controller:["$rootScope","$api",function(e,t){var a=this;a.$onChanges=function(){t.business.projectdetail({time:a.selectMonth,project:e.Project.ids},function(e){angular.forEach(e.result,function(e){e.data=[0,0,0,0,0],e.data[e.ecslevel-1]=e.uaec,this.push({name:e.name,data:e.data})},e.series=[]),a.projectdetail={chart:{type:"bar"},title:!1,xAxis:{categories:["0-1.8 KWh","1.8-3.8 KWh","3.8-5.7 KWh","5.7-7.7 KWh","7.7-∞ KWh"]},yAxis:{title:!1},tooltip:{valueSuffix:" KWh"},legend:{layout:"vertical",align:"right",verticalAlign:"bottom",y:-20,floating:!0,borderWidth:1},series:e.series}})}}]});