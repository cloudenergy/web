angular.module("app").component("main",{templateUrl:"app/modules/main/main.html?rev=b9cf14b95f",controller:function(){var t=this;this.groupmode=APP.User.groupmode,this.selectDay=moment().format("YYYYMMDD"),this.selectMonth=moment().format("YYYYMM"),t.allPoint=t.firstf=t.secondf=t.thirdf=t.fourthf=t.fifthf=!0,t.showPoint=function(e){e?1==e?(t.secondf=t.thirdf=t.fourthf=t.fifthf=!1,t.firstf=!0,t.allPoint=t.firstf&&t.secondf&&t.thirdf&&t.fourthf&&t.fifthf):2==e?(t.firstf=t.thirdf=t.fourthf=t.fifthf=!1,t.allPoint=t.firstf&&t.secondf&&t.thirdf&&t.fourthf&&t.fifthf,t.secondf=!0):3==e?(t.firstf=t.secondf=t.fourthf=t.fifthf=!1,t.allPoint=t.firstf&&t.secondf&&t.thirdf&&t.fourthf&&t.fifthf,t.thirdf=!0):4==e?(t.firstf=t.secondf=t.thirdf=t.fifthf=!1,t.allPoint=t.firstf&&t.secondf&&t.thirdf&&t.fourthf&&t.fifthf,t.fourthf=!0):5==e&&(t.firstf=t.secondf=t.thirdf=t.fourthf=!1,t.allPoint=t.firstf&&t.secondf&&t.thirdf&&t.fourthf&&t.fifthf,t.fifthf=!0):(t.firstf=t.secondf=t.thirdf=t.fourthf=t.fifthf=!0,t.allPoint=t.firstf&&t.secondf&&t.thirdf&&t.fourthf&&t.fifthf)}}}),angular.module("app").component("mainCalendar",{templateUrl:"app/modules/main/calendar.html?rev=649f4c1915",bindings:{groupmode:"<",selectDay:"=",selectMonth:"="},controller:["$scope","$element","$timeout","$api",function(t,e,a,i){var n=this,o=e.find("datetimepicker").on("dp.change",function(t){a(function(){n.selectDay=t.date.format("YYYYMMDD"),n.selectMonth=t.date.format("YYYYMM"),n.bindTD()})}).on("dp.update",function(t){angular.equals(t.viewDate.format("YYYYMM"),n.selectMonth)?n.bindTD():o.data("DateTimePicker").defaultDate(t.viewDate._d)});n.bindTD=function(){n.calendarData&&o.find(".datepicker-days table tbody td.day").each(function(){if(!/old|new/i.test(this.className)){var t=$(this),e=t.data("day"),a="emstatus-keep";n.calendarData.detail[e]>n.calendarData.average&&(a="emstatus-up"),n.calendarData.detail[e]>n.calendarData.average&&(a="emstatus-down"),t.removeClass("emstatus-up").removeClass("emstatus-down").removeClass("emstatus-keep"),n.calendarData.detail[e]&&t.addClass(a)}}),o.find(".datepicker-days table tbody td.active").click(function(){return!1})},t.$watch("$ctrl.selectMonth",function(t){i.business.calendar({time:t,project:APP.Project.ids,assemble:!1},function(t){t=t.result[APP.Project.current._id],n.calendarData=t||{},n.calendarData.detail=n.calendarData.detail,n.calendarData.average=n.calendarData.buildingConsumption/(n.calendarData.detail&&n.calendarData.detail.length||0),angular.forEach(n.calendarData.detail,function(t,e){this[moment(1*t._id).format("YYYY-MM-DD")]=t.value},n.calendarData.detail={}),n.bindTD()})})}]}),angular.module("app").component("mainDailycost",{templateUrl:"app/modules/main/dailycost.html?rev=e311a82e7a",bindings:{groupmode:"<",selectDay:"<"},controller:["$api",function(t){var e=this;e.$onChanges=function(){e.showDay=e.selectDay.toString().replace(/^(\d{4})(\d{2})(\d{2})$/,"$1-$2-$3"),t.business.dailycost({time:e.selectDay,project:APP.Project.ids,assemble:!1},function(t){t=t.result[APP.Project.current._id]||{},e.currentDayqoq=Math.round(100*t.qoqPercent)/100,e.currentDayyoy=Math.round(100*t.yoyPercent)/100,e.dailycost={chart:{margin:[0,0,0,0],style:{textAlign:"center"},type:"pie"},title:{text:'<div class="pieTitle">今日费用</div><div class="pieNumber">'+t.cost+'</div><div class="pieUnit">元</div>',verticalAlign:"middle",useHTML:!0,y:-12},tooltip:!1,plotOptions:{pie:{dataLabels:!1,innerSize:"85%"}},series:[{data:[t.cost]}]}})}}]}),angular.module("app").component("mainMonthlykgce",{templateUrl:"app/modules/main/monthlykgce.html?rev=1f71b1fb05",bindings:{groupmode:"<",selectMonth:"<"},controller:["$api",function(t){var e=this;e.$onChanges=function(){e.showDay=e.selectMonth.toString().replace(/^(\d{4})(\d{2})$/,"$1-$2"),e.monthlykgce={chart:{marginBottom:0,marginLeft:0,marginRight:140,marginTop:0,style:{textAlign:"center"},type:"pie"},title:{text:'<div class="pieTitle">总预算</div><div class="pieNumber">250000</div><div class="pieUnit">kWh</div>',verticalAlign:"middle",useHTML:!0,x:-70,y:-12},tooltip:{pointFormat:" <b>{point.y}</b> kWh"},plotOptions:{pie:{dataLabels:!1,innerSize:"85%",showInLegend:!0}},legend:{verticalAlign:"middle",layout:"vertical",labelFormatter:function(){return'<div style="text-align:left;">'+Math.round(10*this.percentage)/10+"% "+this.name+'</div><div style="color:#BBB;text-align:left;">'+this.y+"kWh</div>"},itemWidth:100,useHTML:!0,x:140},series:[{type:"pie",innerSize:"80%",name:"预算指标",data:[["已用",30942],["剩余",219058]]}]}}}]}),angular.module("app").component("mainEnergyconstitute",{templateUrl:"app/modules/main/energyconstitute.html?rev=a4b7bc71ee",bindings:{selectMonth:"<"},controller:["$api",function(t){var e=this;e.$onChanges=function(){e.showDay=e.selectMonth.toString().replace(/^(\d{4})(\d{2})$/,"$1-$2"),t.business.energyconstitute({time:e.selectMonth,project:APP.Project.current._id},function(t){var a=[],i=[];angular.forEach(t.result[APP.Project.current._id]||{},function(t,e,n){Object.keys(t).length>a.length&&(n=0,a=[]),angular.forEach(t,function(t,e){this.push(t),0===n&&a.push(parseInt(e))},t=[]),i.push({data:t,name:e})}),e.energyconstitute={chart:{type:"spline"},title:!1,xAxis:{type:"datetime",categories:a,labels:{formatter:function(){return moment(this.value).format("M-DD")}}},yAxis:{title:!1},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y}元</span>'},series:i}})}}]}),angular.module("app").component("mainDailysensordetail",{templateUrl:"app/modules/main/dailysensordetail.html?rev=7f3ae73f9a",bindings:{selectMonth:"<"},controller:["$api",function(t){var e=this;e.$onChanges=function(){e.dailysensordetail={chart:{type:"column"},title:{text:" "},xAxis:{categories:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],crosshair:!0},yAxis:{min:0,title:{text:"能耗 (万元/月)"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y:.1f} 万元/月</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"每月能耗",data:[49.9,71.5,106.4,129.2,144,176,135.6,148.5,216.4,194.1,95.6,54.4]}]}}}]}),angular.module("app").component("mainEnergyeffectiverate",{templateUrl:"app/modules/main/energyeffectiverate.html?rev=51abe4b97b",bindings:{groupmode:"<",selectMonth:"<"},controller:["$api",function(t){var e=this;e.$onChanges=function(){e.showDay=e.selectMonth.toString().replace(/^(\d{4})(\d{2})$/,"$1-$2");e.energyeffectiverate={chart:{type:"spline"},title:!1,yAxis:{title:!1},xAxis:{categories:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],crosshair:!0},series:[{name:"单位面积综合电耗",data:[63,71,68,56,70,67,71,68,76,77,70]},{name:"单位面积综合能耗",data:[73,81,78,86,84,88,93,68,83,85,80]},{name:"可比单位面积能耗",data:[33,41,38,46,44,55,59,48,53,40,59]}]}}}]}),angular.module("app").component("mainProjectdetail",{templateUrl:"app/modules/main/projectdetail.html?rev=452e95f2f2",bindings:{selectMonth:"<"},controller:["$api",function(t){var e=this;e.$onChanges=function(){t.business.projectdetail({time:e.selectMonth,project:APP.Project.ids},function(t){angular.forEach(t.result,function(t){t.data=[0,0,0,0,0],t.data[t.ecslevel-1]=t.uaec,this.push({name:t.name,data:t.data})},t.series=[]),e.projectdetail={chart:{type:"bar"},title:!1,xAxis:{categories:["0-1.8 KWh","1.8-3.8 KWh","3.8-5.7 KWh","5.7-7.7 KWh","7.7-∞ KWh"]},yAxis:{title:!1},tooltip:{valueSuffix:" KWh"},legend:{layout:"vertical",align:"right",verticalAlign:"bottom",y:-20,floating:!0,borderWidth:1},series:t.series}})}}]});