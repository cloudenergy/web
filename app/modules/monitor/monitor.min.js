"use strict";angular.module("app").component("monitor",{templateUrl:"app/modules/monitor/monitor.html?rev=2c06b774f3",controller:["$rootScope","$scope","$element","$q","$api","$timeout","SweetAlert","monitorBatchControl","monitorColumnGroupmode","monitorColumnTIMERMETER","monitorColumnMultifunction","monitorColumnTEMPHUMMETER","monitorColumnZTYPETEMPCONTROL","monitorColumnGASMETER","monitorColumnNBCOLDWATERMETER","monitorColumnNBFEECONTROLMETER",function(t,e,n,c,s,l,d,i,a,o,r,p,m,u,h,g){var b=this,C=t.Project.current&&t.Project.current._id,v=function(t,n,l){if(angular.isObject(t)&&!angular.isArray(t)){var i,a=[];return t.entity&&(i=t.entity.status[l]),t.entity&&(t.entity.status["prev_"+l]=void 0),angular.forEach(b.gridApi.grid.rows,function(e){!t.entity.id&&e.isSelected&&e.entity.command[n]&&(t.entity&&e.entity.id!==t.entity.id&&(e.entity.status["prev_"+l]=e.entity.status[l],e.entity.status[l]=i),a.push(e.entity.id))}),a.length?(t.entity.id&&!t.isSelected&&(t.isSelected=!0,a.push(t.entity.id)),b.multiCheck()):t.entity.id&&a.push(t.entity.id),a}angular.forEach(b.gridApi.grid.rows,function(e){~t.indexOf(e.entity.id)&&(e.entity.status[l]=e.entity.status["prev_"+l],delete e.entity.status["prev_"+l])})};b.isHide=!0,b.date=moment().format("YYYY-MM"),t.User.data.groupmode&&n.find("select.form-control.select").select2({dropdownCssClass:"monitor-select2-dropdown-inverse"}).change(function(){b.level=this.value}),b.isHide=!0,b.itemSelected=!1,b.multiCheck=function(e){if("all"===e)b.multiCheck.all&&(b.itemSelected=!0),!b.multiCheck.all&&(b.itemSelected=!1),angular.forEach(b.gridApi.grid.rows,function(e){e.isSelected=b.multiCheck.all}),b.selectedItemLength=b.gridOptions.data.length;else{var t=[];b.multiCheck.all=!0,b.itemSelected=!1,angular.forEach(b.gridApi.grid.rows,function(e){e.isSelected||delete b.multiCheck.all,e.isSelected&&(t.push(e),b.itemSelected=!0)}),b.selectedItemLength=t.length}b.allItems=b.gridApi.grid.rows},b.batchControl=i,b.showException=!1,b.exceptionChange=function(){b.deviceType.select(b.deviceType.selected)},b.export=function(){t.User.data.groupmode?b.gridOptions.exporterCsvFilename=document.title+"_监控_"+b.date.replace(/\-/g,"")+".csv":b.gridOptions.exporterCsvFilename=document.title+"_监控_"+b.deviceType.selected.name+"_"+moment().format("YYYYMMDDHHmmss")+".csv",b.gridApi.exporter.csvExport("visible","visible",angular.element(document.querySelectorAll(".subContent")))},b.gridOptions={onRegisterApi:function(i){i.infiniteScroll.on.needLoadMoreData(e,function(){var e,t=c.defer(),n=function(){t.resolve()},l=function(){i.infiniteScroll.dataLoaded(),t.reject()};return(e=b.list(!0))?e.then(function(){i.infiniteScroll.saveScrollPercentage(),i.infiniteScroll.dataLoaded(!1,!0).then(n,l)},l):l(),t.promise}),b.gridApi=i},rowHeight:34,infiniteScrollDown:!0,enableColumnMenus:!1,enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,t,n,l){return{name:!0,addr:!0,title:!0,time:!0}[n.field]?'="'+(l||"")+'"':l}},t.User.data.groupmode&&(b.gridOptions.columnDefs=a),b.columnDefsData=function(){"ELECTRICITYMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:45,minWidth:45,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"智能仪表名称",name:"title",minWidth:150,pinnedLeft:!0,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">智能仪表名称</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected">批量控制:已选<span class="text-danger">{{grid.appScope.$ctrl.selectedItemLength}}</span>个</div>',enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"智能仪表ID",name:"addrid",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"通道名称",name:"channels['11'].channel",width:"*",minWidth:80,enableColumnMenu:!1,enableSorting:!1},{displayName:"当前读数",name:"channels['11'].realdata",type:"number",width:"*",minWidth:120,headerCellClass:"text-right",cellClass:"text-right",cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'11\'" ng-bind="COL_FIELD"></a></div>'},{displayName:"状态",name:"channels['11'].status",width:"*",minWidth:70,enableColumnMenu:!1,enableSorting:!1,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:function(){return['<div class="ui-grid-cell-contents">','<b ng-show="COL_FIELD===0" class="ng-hide" style="color:#16a085;">正常</b>','<b ng-show="COL_FIELD===1" class="ng-hide" style="color:#c0392b;">数据异常</b>','<b ng-show="COL_FIELD===2" class="ng-hide" style="color:#8e44ad;">通讯异常</b>',"</div>"].join("")}},{displayName:"控制",name:"status_switch1",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOn,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOff,\'EMC_SWITCH\',\'switch\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.switch" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_SWITCH" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关" data-on-color="primary"></switch></div>'},{displayName:"通讯时间",name:"channels['11'].lastupdate",width:"*",minWidth:180,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="COL_FIELD">{{COL_FIELD|date:\'yyyy年M月dd日 H:mm:ss\'}}</div>'},{displayName:"关联商户",type:"number",name:"department[0].title",width:"*",minWidth:150},{displayName:"商户账号",type:"number",name:"department[0].account",width:"*",minWidth:150},{displayName:"位置编码",name:"tag",width:"*",minWidth:140},{displayName:"采集器编号",type:"number",name:"gatewayid",width:"*",minWidth:90}]):"HOTWATERMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"智能仪表名称",name:"title",minWidth:150,pinnedLeft:!0,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">智能仪表名称</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected">批量控制:已选<span class="text-danger">{{grid.appScope.$ctrl.selectedItemLength}}</span>个</div>',enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"智能仪表ID",name:"addrid",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"通道名称",name:"channels['03'].channel",width:"*",minWidth:80,enableColumnMenu:!1,enableSorting:!1},{displayName:"当前读数",name:"channels['03'].realdata",type:"number",width:"*",minWidth:120,headerCellClass:"text-right",cellClass:"text-right",cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'03\'" ng-bind="COL_FIELD"></a></div>'},{displayName:"状态",name:"channels['03'].status",width:"*",minWidth:70,enableColumnMenu:!1,enableSorting:!1,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:function(){return['<div class="ui-grid-cell-contents">','<b ng-show="COL_FIELD===0" class="ng-hide" style="color:#16a085;">正常</b>','<b ng-show="COL_FIELD===1" class="ng-hide" style="color:#c0392b;">数据异常</b>','<b ng-show="COL_FIELD===2" class="ng-hide" style="color:#8e44ad;">通讯异常</b>',"</div>"].join("")}},{displayName:"控制",name:"status_switch2",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOn,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOff,\'EMC_SWITCH\',\'switch\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.switch" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_SWITCH" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关" data-on-color="primary"></switch></div>'},{displayName:"通讯时间",name:"channels['03'].lastupdate",width:"*",minWidth:180,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="COL_FIELD">{{COL_FIELD|date:\'yyyy年M月dd日 H:mm:ss\'}}</div>'},{displayName:"关联商户",type:"number",name:"department[0].title",width:"*",minWidth:150},{displayName:"商户账号",type:"number",name:"department[0].account",width:"*",minWidth:150},{displayName:"位置编码",name:"tag",width:"*",minWidth:140},{displayName:"采集器编号",type:"number",name:"gatewayid",width:"*",minWidth:90}]):"NBCOLDWATERMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=h):"NBFEECONTROLMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=g):"COLDWATERMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"智能仪表名称",name:"title",minWidth:150,pinnedLeft:!0,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">智能仪表名称</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected">批量控制:已选<span class="text-danger">{{grid.appScope.$ctrl.selectedItemLength}}</span>个</div>',enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"智能仪表ID",name:"addrid",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"通道名称",name:"channels['01'].channel",width:"*",minWidth:80,enableColumnMenu:!1,enableSorting:!1},{displayName:"当前读数",name:"channels['01'].realdata",type:"number",width:"*",minWidth:120,headerCellClass:"text-right",cellClass:"text-right",cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'01\'" ng-bind="COL_FIELD"></a></div>'},{displayName:"状态",name:"channels['01'].status",width:"*",minWidth:70,enableColumnMenu:!1,enableSorting:!1,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:function(){return['<div class="ui-grid-cell-contents">','<b ng-show="COL_FIELD===0" class="ng-hide" style="color:#16a085;">正常</b>','<b ng-show="COL_FIELD===1" class="ng-hide" style="color:#c0392b;">数据异常</b>','<b ng-show="COL_FIELD===2" class="ng-hide" style="color:#8e44ad;">通讯异常</b>',"</div>"].join("")}},{displayName:"控制",name:"status_switch3",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOn,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOff,\'EMC_SWITCH\',\'switch\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.switch" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_SWITCH" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关" data-on-color="primary"></switch></div>'},{displayName:"通讯时间",name:"channels['01'].lastupdate",width:"*",minWidth:180,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="COL_FIELD">{{COL_FIELD|date:\'yyyy年M月dd日 H:mm:ss\'}}</div>'},{displayName:"关联商户",type:"number",name:"department[0].title",width:"*",minWidth:150},{displayName:"商户账号",type:"number",name:"department[0].account",width:"*",minWidth:150},{displayName:"位置编码",name:"tag",width:"*",minWidth:140},{displayName:"采集器编号",type:"number",name:"gatewayid",width:"*",minWidth:90}]):"ENERGYMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"序号",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"智能仪表名称",name:"title",minWidth:150,pinnedLeft:!0,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected" ng-bind="col.displayName"></div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected">批量控制:已选<span class="text-danger">{{grid.appScope.$ctrl.selectedItemLength}}</span>个</div>',enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"智能仪表ID",type:"string",name:"addrid",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"供水温度℃",type:"number",name:"channels_040",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback" ng-class="{\'focus\':row.entity.channels[\'05\']}"><span class="form-control text-right" ng-bind="row.entity.channels[\'05\'].lasttotal"></span></div></div>'},{displayName:"回水温度℃",type:"number",name:"channels_041",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback" ng-class="{\'focus\':row.entity.channels[\'06\']}"><span class="form-control text-right" ng-bind="row.entity.channels[\'06\'].lasttotal"></span></div></div>'},{displayName:"温差℃",type:"number",name:"channels_042",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:"<div class=\"ui-grid-cell-contents\"><div class=\"form-group form-group-sm has-feedback\" ng-class=\"{'focus':row.entity.channels['05']}\"><span class=\"form-control text-right\" ng-bind=\"(row.entity.channels['05'].lasttotal>row.entity.channels['06'].lasttotal?row.entity.channels['05'].lasttotal-row.entity.channels['06'].lasttotal:row.entity.channels['06'].lasttotal-row.entity.channels['05'].lasttotal).toFixed(2)\"></span></div></div>"},{displayName:"流量m³",type:"number",name:"channels_043",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback" ng-class="{\'focus\':row.entity.channels[\'04\']}"><span class="form-control text-right" ng-bind="row.entity.channels[\'04\'].lasttotal"></span></div></div>'},{displayName:"流速m³/h",type:"number",name:"channels_044",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback" ng-class="{\'focus\':row.entity.channels[\'09\']}"><span class="form-control text-right" ng-bind="row.entity.channels[\'09\'].lasttotal"></span></div></div>'},{displayName:"总冷量KWh",type:"number",name:"channels_045",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback pointer" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'07\'" ng-class="{\'focus\':!row.entity.nocold}"><span class="form-control text-right" ng-bind="row.entity.channels[\'07\'].lasttotal"></span></div></div>'},{displayName:"总热量KWh",type:"number",name:"channels_046",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback pointer" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'08\'" ng-class="{\'focus\':!row.entity.noheat}"><span class="form-control text-right" ng-bind="row.entity.channels[\'08\'].lasttotal"></span></div></div>'},{displayName:"状态",name:"reportStatus",width:"*",minWidth:70,enableColumnMenu:!1,enableSorting:!1,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:function(){return['<div class="ui-grid-cell-contents">','<b ng-show="COL_FIELD===0" class="ng-hide" style="color:#16a085;">正常</b>','<b ng-show="COL_FIELD===1" class="ng-hide" style="color:#c0392b;">数据异常</b>','<b ng-show="COL_FIELD===2" class="ng-hide" style="color:#8e44ad;">通讯异常</b>',"</div>"].join("")}},{displayName:"模式",name:"status_mode04",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">模式</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.cool,\'EMC_MODE\',\'mode\',\'mode\')">制冷</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.heat,\'EMC_MODE\',\'mode\',\'mode\')">制热</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.mode" state-on="EMC_COOLING" state-off="EMC_HEATING" disabled="!row.entity.command.EMC_MODE" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_MODE\',\'mode\',\'mode\')" data-on-text="制冷" data-off-text="制热" data-on-color="info" data-off-color="danger"></switch></div>'},{displayName:"通讯时间",name:"lastupdate",width:"*",minWidth:180,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="COL_FIELD">{{COL_FIELD|date:\'yyyy年M月dd日 H:mm:ss\'}}</div>'},{displayName:"发送",name:"send",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">发送</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend()">发送 <i class="glyphicon glyphicon-send"></i></a></div>',cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend(row)">发送 <i class="glyphicon glyphicon-send"></i></a></div>'},{displayName:"关联商户",type:"number",name:"department[0].title",width:"*",minWidth:150},{displayName:"商户账号",type:"number",name:"department[0].account",width:"*",minWidth:150},{displayName:"位置编码",name:"tag",width:"*",minWidth:140},{displayName:"采集器编号",type:"number",name:"gatewayid",width:"*",minWidth:90}]):"TEMPERATURECONTROL"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"智能仪表名称",name:"title",minWidth:150,pinnedLeft:!0,enableColumnMenu:!0,headerCellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="!grid.appScope.$ctrl.itemSelected" ng-bind="col.displayName"></span><div ng-show="grid.appScope.$ctrl.itemSelected">批量控制:已选<span class="text-danger">{{grid.appScope.$ctrl.selectedItemLength}}</span>个</div></div>',enableSorting:!0,cellClass:"pt5"},{displayName:"智能仪表ID",name:"addrid",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"能量系数",type:"number",name:"channels_052",minWidth:140,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="input-group input-group-sm focus pointer" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'33\'"><span class="input-group-addon"><i class="emweb web-charging"></i></span><span class="form-control" ng-bind="row.entity.channels[\'33\'].lasttotal"></span></div></div>'},{displayName:"状态",name:"channels['33'].status",width:"*",minWidth:70,enableColumnMenu:!1,enableSorting:!1,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:function(){return['<div class="ui-grid-cell-contents">','<b ng-show="COL_FIELD===0" class="ng-hide" style="color:#16a085;">正常</b>','<b ng-show="COL_FIELD===1" class="ng-hide" style="color:#c0392b;">数据异常</b>','<b ng-show="COL_FIELD===2" class="ng-hide" style="color:#8e44ad;">通讯异常</b>',"</div>"].join("")}},{displayName:"面板开关",name:"status_switch5",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">面板开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOn,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOff,\'EMC_SWITCH\',\'switch\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.switch" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_SWITCH" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关" data-on-color="primary"></switch></div>'},{displayName:"阀控开关",name:"status_valve5",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">阀控开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.on,\'EMC_VALVE\',\'valve\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.off,\'EMC_VALVE\',\'valve\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.valve" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_VALVE" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_VALVE\',\'valve\',\'mode\')" data-on-text="开" data-off-text="关" data-on-color="primary"></switch></div>'},{displayName:"模式",name:"status_mode5",minWidth:210,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">模式</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><control-mode class="btn-group" ng-if="grid.appScope.$ctrl.itemSelected" mode="grid.appScope.$ctrl.batchControl.mode.entity.status.mode" on-mode="grid.appScope.$ctrl.multiControl(grid.appScope.$ctrl.batchControl.mode,\'EMC_MODE\',\'mode\',\'mode\')"></control-mode></div>',cellTemplate:'<div class="ui-grid-cell-contents"><control-mode hide="[\'EMC_DEHUMIDIFYING\']" class="btn-group" mode="row.entity.status.mode" disabled="!row.entity.command.EMC_MODE" on-mode="grid.appScope.$ctrl.multiControl(row,\'EMC_MODE\',\'mode\',\'mode\')"></control-mode></div>'},{displayName:"风速",name:"status_windspeed5",minWidth:130,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">风速</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><control-speed speed="grid.appScope.$ctrl.batchControl.windspeed.entity.status.windspeed" on-speed="grid.appScope.$ctrl.multiControl(grid.appScope.$ctrl.batchControl.windspeed,\'EMC_WINDSPEED\',\'windspeed\',\'mode\')"></control-speed></div>',cellTemplate:'<div class="ui-grid-cell-contents"><control-speed speed="row.entity.status.windspeed" disabled="!row.entity.command.EMC_WINDSPEED" on-speed="grid.appScope.$ctrl.multiControl(row,\'EMC_WINDSPEED\',\'windspeed\',\'mode\')"></control-speed></div>'},{displayName:"室内温度℃",type:"number",name:"channels_051",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback focus"><span class="form-control text-right" ng-bind="row.entity.status.inroomtemperature||row.entity.channels[\'40\'].lasttotal"></span></div></div>'},{displayName:"设置温度",name:"channels_050",minWidth:220,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">设置温度</div><div class="ui-grid-cell-contents pl10 pr10" ng-if="grid.appScope.$ctrl.itemSelected"><control-slider value="grid.appScope.$ctrl.batchControl.temperature.entity.status.temperature" on-slider="grid.appScope.$ctrl.multiControl(grid.appScope.$ctrl.batchControl.temperature,\'EMC_TEMPERATURE\',\'temperature\',\'value\')"></control-slider></div>',cellTemplate:'<div class="ui-grid-cell-contents pl10 pr10"><control-slider value="row.entity.status.temperature" disabled="!row.entity.command.EMC_TEMPERATURE" on-slider="grid.appScope.$ctrl.multiControl(row,\'EMC_TEMPERATURE\',\'temperature\',\'value\')"></control-slider></div>'},{displayName:"通讯时间",name:"channels['33'].lastupdate",width:"*",minWidth:180,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="COL_FIELD">{{COL_FIELD|date:\'yyyy年M月dd日 H:mm:ss\'}}</div>'},{displayName:"发送",name:"send",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">发送</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend()">发送 <i class="glyphicon glyphicon-send"></i></a></div>',cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend(row)">发送 <i class="glyphicon glyphicon-send"></i></a></div>'},{displayName:"关联商户",type:"number",name:"department[0].title",width:"*",minWidth:150},{displayName:"商户账号",type:"number",name:"department[0].account",width:"*",minWidth:150},{displayName:"位置编码",name:"tag",width:"*",minWidth:140},{displayName:"采集器编号",type:"number",name:"gatewayid",width:"*",minWidth:90}]):"TIMERMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=o):"MELECTRICITYMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=r):"ULTRACOLDWATERMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"智能仪表名称",name:"title",minWidth:150,pinnedLeft:!0,enableColumnMenu:!0,headerCellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="!grid.appScope.$ctrl.itemSelected" ng-bind="col.displayName"></span><div ng-show="grid.appScope.$ctrl.itemSelected">批量控制:已选<span class="text-danger">{{grid.appScope.$ctrl.selectedItemLength}}</span>个</div></div>',enableSorting:!0,cellClass:"pt5"},{displayName:"智能仪表ID",name:"addrid",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"累计流量m³",type:"number",name:"channels_043",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback pointer" ng-class="{\'focus\':row.entity.channels[\'04\']}" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'04\'"><span class="form-control text-right" ng-bind="row.entity.channels[\'04\'].lasttotal"></span></div></div>'},{displayName:"流速m³/s",type:"number",name:"channels_044",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback" ng-class="{\'focus\':row.entity.channels[\'09\']}"><span class="form-control text-right" ng-bind="row.entity.channels[\'09\'].lasttotal"></span></div></div>'},{displayName:"供水温度℃",type:"number",name:"channels_040",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback" ng-class="{\'focus\':row.entity.channels[\'05\']}"><span class="form-control text-right" ng-bind="row.entity.channels[\'05\'].lasttotal"></span></div></div>'},{displayName:"状态",name:"channels['04'].status",width:"*",minWidth:70,enableColumnMenu:!1,enableSorting:!1,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:function(){return['<div class="ui-grid-cell-contents">','<b ng-show="COL_FIELD===0" class="ng-hide" style="color:#16a085;">正常</b>','<b ng-show="COL_FIELD===1" class="ng-hide" style="color:#c0392b;">数据异常</b>','<b ng-show="COL_FIELD===2" class="ng-hide" style="color:#8e44ad;">通讯异常</b>',"</div>"].join("")}},{displayName:"通讯时间",name:"channels['04'].lastupdate",width:"*",minWidth:180,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="COL_FIELD">{{COL_FIELD|date:\'yyyy年M月dd日 H:mm:ss\'}}</div>'},{displayName:"关联商户",type:"number",name:"department[0].title",width:"*",minWidth:150},{displayName:"商户账号",type:"number",name:"department[0].account",width:"*",minWidth:150},{displayName:"位置编码",name:"tag",width:"*",minWidth:140},{displayName:"采集器编号",type:"number",name:"gatewayid",width:"*",minWidth:90}]):"PRESSUREMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"智能仪表名称",name:"title",minWidth:150,pinnedLeft:!0,enableColumnMenu:!0,headerCellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="!grid.appScope.$ctrl.itemSelected" ng-bind="col.displayName"></span><div ng-show="grid.appScope.$ctrl.itemSelected">批量控制:已选<span class="text-danger">{{grid.appScope.$ctrl.selectedItemLength}}</span>个</div></div>',enableSorting:!0,cellClass:"pt5"},{displayName:"智能仪表ID",name:"addrid",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"当前压力（MPa）",name:"channels[50].lasttotal",width:"*",minWidth:140,cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'50\'" ng-bind="COL_FIELD"></a></div>'},{displayName:"状态",name:"reportStatus",width:"*",minWidth:70,enableColumnMenu:!1,enableSorting:!1,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:function(){return['<div class="ui-grid-cell-contents">','<b ng-show="COL_FIELD===0" class="ng-hide" style="color:#16a085;">正常</b>','<b ng-show="COL_FIELD===1" class="ng-hide" style="color:#c0392b;">数据异常</b>','<b ng-show="COL_FIELD===2" class="ng-hide" style="color:#8e44ad;">通讯异常</b>',"</div>"].join("")}},{displayName:"通讯时间",name:"lastupdate",width:"*",minWidth:180,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="COL_FIELD">{{COL_FIELD|date:\'yyyy年M月dd日 H:mm:ss\'}}</div>'},{displayName:"位置编码",name:"tag",width:"*",minWidth:140},{displayName:"采集器编号",type:"number",name:"gatewayid",width:"*",minWidth:90}]):"TTYPETEMPCONTROL"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"智能仪表名称",name:"title",minWidth:150,pinnedLeft:!0,enableColumnMenu:!0,headerCellTemplate:'<div class="ui-grid-cell-contents"><span ng-show="!grid.appScope.$ctrl.itemSelected" ng-bind="col.displayName"></span><div ng-show="grid.appScope.$ctrl.itemSelected">批量控制:已选<span class="text-danger">{{grid.appScope.$ctrl.selectedItemLength}}</span>个</div></div>',enableSorting:!0,cellClass:"pt5"},{displayName:"智能仪表ID",name:"addrid",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"能量系数",type:"number",name:"channels_052",minWidth:140,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="input-group input-group-sm focus pointer" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'33\'"><span class="input-group-addon"><i class="emweb web-charging"></i></span><span class="form-control" ng-bind="row.entity.channels[\'33\'].lasttotal"></span></div></div>'},{displayName:"状态",name:"channels['33'].status",width:"*",minWidth:70,enableColumnMenu:!1,enableSorting:!1,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:function(){return['<div class="ui-grid-cell-contents">','<b ng-show="COL_FIELD===0" class="ng-hide" style="color:#16a085;">正常</b>','<b ng-show="COL_FIELD===1" class="ng-hide" style="color:#c0392b;">数据异常</b>','<b ng-show="COL_FIELD===2" class="ng-hide" style="color:#8e44ad;">通讯异常</b>',"</div>"].join("")}},{displayName:"阀控开关",name:"status_valve5",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">阀控开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.on,\'EMC_VALVE\',\'valve\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.off,\'EMC_VALVE\',\'valve\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.valve" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_VALVE" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_VALVE\',\'valve\',\'mode\')" data-on-text="开" data-off-text="关" data-on-color="primary"></switch></div>'},{displayName:"模式",name:"status_mode5",minWidth:150,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">模式</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><control-mode class="btn-group" ng-if="grid.appScope.$ctrl.itemSelected" hide="[\'EMC_DEHUMIDIFYING\',\'EMC_VERTILATING\']" mode="grid.appScope.$ctrl.batchControl.mode.entity.status.mode" on-mode="grid.appScope.$ctrl.multiControl(grid.appScope.$ctrl.batchControl.mode,\'EMC_MODE\',\'mode\',\'mode\')"></control-mode></div>',cellTemplate:'<div class="ui-grid-cell-contents"><control-mode class="btn-group" hide="[\'EMC_DEHUMIDIFYING\',\'EMC_VERTILATING\']" mode="row.entity.status.mode" disabled="!row.entity.command.EMC_MODE" on-mode="grid.appScope.$ctrl.multiControl(row,\'EMC_MODE\',\'mode\',\'mode\')"></control-mode></div>'},{displayName:"风速",name:"status_windspeed5",minWidth:130,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">风速</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><control-speed speed="grid.appScope.$ctrl.batchControl.windspeed.entity.status.windspeed" on-speed="grid.appScope.$ctrl.multiControl(grid.appScope.$ctrl.batchControl.windspeed,\'EMC_WINDSPEED\',\'windspeed\',\'mode\')"></control-speed></div>',cellTemplate:'<div class="ui-grid-cell-contents"><control-speed speed="row.entity.status.windspeed" disabled="!row.entity.command.EMC_WINDSPEED" on-speed="grid.appScope.$ctrl.multiControl(row,\'EMC_WINDSPEED\',\'windspeed\',\'mode\')"></control-speed></div>'},{displayName:"设置温度",name:"channels_050",minWidth:220,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">设置温度</div><div class="ui-grid-cell-contents pl10 pr10" ng-if="grid.appScope.$ctrl.itemSelected"><control-slider value="grid.appScope.$ctrl.batchControl.temperature.entity.status.temperature" on-slider="grid.appScope.$ctrl.multiControl(grid.appScope.$ctrl.batchControl.temperature,\'EMC_TEMPERATURE\',\'temperature\',\'value\')"></control-slider></div>',cellTemplate:'<div class="ui-grid-cell-contents pl10 pr10"><control-slider value="row.entity.status.temperature" disabled="!row.entity.command.EMC_TEMPERATURE" on-slider="grid.appScope.$ctrl.multiControl(row,\'EMC_TEMPERATURE\',\'temperature\',\'value\')"></control-slider></div>'},{displayName:"通讯时间",name:"channels['33'].lastupdate",width:"*",minWidth:180,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="COL_FIELD">{{COL_FIELD|date:\'yyyy年M月dd日 H:mm:ss\'}}</div>'},{displayName:"发送",name:"send",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">发送</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend()">发送 <i class="glyphicon glyphicon-send"></i></a></div>',cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend(row)">发送 <i class="glyphicon glyphicon-send"></i></a></div>'},{displayName:"关联商户",type:"number",name:"department[0].title",width:"*",minWidth:150},{displayName:"商户账号",type:"number",name:"department[0].account",width:"*",minWidth:150},{displayName:"位置编码",name:"tag",width:"*",minWidth:140},{displayName:"采集器编号",type:"number",name:"gatewayid",width:"*",minWidth:90}]):"HEATENERGYMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"序号",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"智能仪表名称",name:"title",minWidth:150,pinnedLeft:!0,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected" ng-bind="col.displayName"></div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected">批量控制:已选<span class="text-danger">{{grid.appScope.$ctrl.selectedItemLength}}</span>个</div>',enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"智能仪表ID",type:"string",name:"addrid",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"供水温度℃",type:"number",name:"channels_040",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback" ng-class="{\'focus\':row.entity.channels[\'05\']}"><span class="form-control text-right" ng-bind="row.entity.channels[\'05\'].lasttotal"></span></div></div>'},{displayName:"回水温度℃",type:"number",name:"channels_041",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback" ng-class="{\'focus\':row.entity.channels[\'06\']}"><span class="form-control text-right" ng-bind="row.entity.channels[\'06\'].lasttotal"></span></div></div>'},{displayName:"温差℃",type:"number",name:"channels_042",minWidth:100,enableSorting:!1,enableColumnMenu:!1,cellTemplate:"<div class=\"ui-grid-cell-contents\"><div class=\"form-group form-group-sm has-feedback\" ng-class=\"{'focus':row.entity.channels['05']}\"><span class=\"form-control text-right\" ng-bind=\"(row.entity.channels['05'].lasttotal>row.entity.channels['06'].lasttotal?row.entity.channels['05'].lasttotal-row.entity.channels['06'].lasttotal:row.entity.channels['06'].lasttotal-row.entity.channels['05'].lasttotal).toFixed(2)\"></span></div></div>"},{displayName:"流量m³",type:"number",name:"channels_043",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback" ng-class="{\'focus\':row.entity.channels[\'04\']}"><span class="form-control text-right" ng-bind="row.entity.channels[\'04\'].lasttotal"></span></div></div>'},{displayName:"总冷量KWh",type:"number",name:"channels_045",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback pointer" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'07\'" ng-class="{\'focus\':!row.entity.nocold}"><span class="form-control text-right" ng-bind="row.entity.channels[\'07\'].lasttotal"></span></div></div>'},{displayName:"总热量KWh",type:"number",name:"channels_046",minWidth:120,enableSorting:!1,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"><div class="form-group form-group-sm has-feedback pointer" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'08\'" ng-class="{\'focus\':!row.entity.noheat}"><span class="form-control text-right" ng-bind="row.entity.channels[\'08\'].lasttotal"></span></div></div>'},{displayName:"状态",name:"reportStatus",width:"*",minWidth:70,enableColumnMenu:!1,enableSorting:!1,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:function(){return['<div class="ui-grid-cell-contents">','<b ng-show="COL_FIELD===0" class="ng-hide" style="color:#16a085;">正常</b>','<b ng-show="COL_FIELD===1" class="ng-hide" style="color:#c0392b;">数据异常</b>','<b ng-show="COL_FIELD===2" class="ng-hide" style="color:#8e44ad;">通讯异常</b>',"</div>"].join("")}},{displayName:"模式",name:"status_mode04",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">模式</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.cool,\'EMC_MODE\',\'mode\',\'mode\')">制冷</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.heat,\'EMC_MODE\',\'mode\',\'mode\')">制热</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.mode" state-on="EMC_COOLING" state-off="EMC_HEATING" disabled="!row.entity.command.EMC_MODE" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_MODE\',\'mode\',\'mode\')" data-on-text="制冷" data-off-text="制热" data-on-color="info" data-off-color="danger"></switch></div>'},{displayName:"通讯时间",name:"lastupdate",width:"*",minWidth:180,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="COL_FIELD">{{COL_FIELD|date:\'yyyy年M月dd日 H:mm:ss\'}}</div>'},{displayName:"发送",name:"send",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">发送</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend()">发送 <i class="glyphicon glyphicon-send"></i></a></div>',cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" class="btn btn-sm btn-info" ng-click="grid.appScope.$ctrl.commandSend(row)">发送 <i class="glyphicon glyphicon-send"></i></a></div>'},{displayName:"关联商户",type:"number",name:"department[0].title",width:"*",minWidth:150},{displayName:"商户账号",type:"number",name:"department[0].account",width:"*",minWidth:150},{displayName:"位置编码",name:"tag",width:"*",minWidth:140},{displayName:"采集器编号",type:"number",name:"gatewayid",width:"*",minWidth:90}]):"OXYGENMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=[{displayName:"",name:"multiCheck",width:36,minWidth:36,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="grid.appScope.$ctrl.multiCheck.all" on-check="grid.appScope.$ctrl.multiCheck(\'all\')"></checkbox></div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents"><checkbox checked="row.isSelected" on-check="grid.appScope.$ctrl.multiCheck()"></checkbox></div>'},{displayName:"",name:"$index",type:"number",width:50,minWidth:50,pinnedLeft:!0,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center pt5",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"智能仪表名称",name:"title",minWidth:150,pinnedLeft:!0,headerCellTemplate:'<div class="ui-grid-cell-contents" ng-if="!grid.appScope.$ctrl.itemSelected">智能仪表名称</div><div class="ui-grid-cell-contents" ng-if="grid.appScope.$ctrl.itemSelected">批量控制:已选<span class="text-danger">{{grid.appScope.$ctrl.selectedItemLength}}</span>个</div>',enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"智能仪表ID",name:"addrid",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"通道名称",name:"channels['46'].channel",width:"*",minWidth:80,enableColumnMenu:!1,enableSorting:!1},{displayName:"当前读数",name:"channels['46'].realdata",type:"number",width:"*",minWidth:120,headerCellClass:"text-right",cellClass:"text-right",cellTemplate:'<div class="ui-grid-cell-contents"><a href="javascript:void(0)" ng-click="grid.appScope.$ctrl.realData=row.entity;row.entity.currentchannelid=\'46\'" ng-bind="COL_FIELD"></a></div>'},{displayName:"状态",name:"channels['46'].status",width:"*",minWidth:70,enableColumnMenu:!1,enableSorting:!1,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:function(){return['<div class="ui-grid-cell-contents">','<b ng-show="COL_FIELD===0" class="ng-hide" style="color:#16a085;">正常</b>','<b ng-show="COL_FIELD===1" class="ng-hide" style="color:#c0392b;">数据异常</b>','<b ng-show="COL_FIELD===2" class="ng-hide" style="color:#8e44ad;">通讯异常</b>',"</div>"].join("")}},{displayName:"控制",name:"status_switch3",minWidth:100,enableSorting:!1,enableColumnMenu:!1,headerCellTemplate:'<div class="ui-grid-cell-contents" style="height:40px;" ng-if="!grid.appScope.$ctrl.itemSelected">开关</div><div class="ui-grid-cell-contents" style="height:40px;" ng-if="grid.appScope.$ctrl.itemSelected"><button class="btn btn-xs btn-info ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOn,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关"">开</button><button class="btn btn-xs btn-danger ml5" ng-click="grid.appScope.$ctrl.confirmControl(grid.appScope.$ctrl.batchControl.turnOff,\'EMC_SWITCH\',\'switch\',\'mode\')">关</button></div>',cellTemplate:'<div class="ui-grid-cell-contents"><switch class="bootstrap-switch-square mt3" state="row.entity.status.switch" state-on="EMC_ON" state-off="EMC_OFF" disabled="!row.entity.command.EMC_SWITCH" on-switch="grid.appScope.$ctrl.confirmControl(row,\'EMC_SWITCH\',\'switch\',\'mode\')" data-on-text="开" data-off-text="关" data-on-color="primary"></switch></div>'},{displayName:"通讯时间",name:"channels['46'].lastupdate",width:"*",minWidth:180,headerCellClass:"text-center",cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-if="COL_FIELD">{{COL_FIELD|date:\'yyyy年M月dd日 H:mm:ss\'}}</div>'},{displayName:"关联商户",type:"number",name:"department[0].title",width:"*",minWidth:150},{displayName:"商户账号",type:"number",name:"department[0].account",width:"*",minWidth:150},{displayName:"位置编码",name:"tag",width:"*",minWidth:140},{displayName:"采集器编号",type:"number",name:"gatewayid",width:"*",minWidth:90}]):"TEMPHUMMETER"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=p):"ZTYPETEMPCONTROL"===b.deviceType.selected.id?(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=m):"GASMETER"===b.deviceType.selected.id&&(b.gridOptions.rowHeight=45,b.gridOptions.columnDefs=u)},C&&s.device.type({project:C},function(e){b.deviceType=[],angular.forEach(e.result,function(e){"ENERGYMETER"!==e.id&&"TEMPERATURECONTROL"!==e.id&&"TIMERMETER"!==e.id||b.deviceType.push(e)}),angular.forEach(e.result,function(e){"ENERGYMETER"!==e.id&&"TEMPERATURECONTROL"!==e.id&&"TIMERMETER"!==e.id&&b.deviceType.push(e)}),b.deviceType.length&&(b.deviceType.select=function(e){delete b.multiCheck.all,b.deviceType.selected=e,b.list()})(b.deviceType[0])}),C?e.$watch("$ctrl.customerSelected",function(){b.deviceType&&b.list()}):l(function(){b.list()}),b.list=function(e){if(!e&&(b.itemSelected=!1),!(e&&b.gridOptions.paging&&b.gridOptions.paging.count<=b.gridOptions.paging.pageindex*b.gridOptions.paging.pagesize))if(t.User.data.groupmode)!b.gridOptions.data.length&&s.business.projectdetail({time:moment(b.date).format("YYYYMM"),project:t.Project.ids,level:b.level||void 0},function(e){angular.forEach(e=e.result,function(e,t){e.id=t,this.push(e)},e=[]),b.gridOptions.data=e});else if(b.deviceType&&b.deviceType.selected)return b._listRequest&&b._listRequest.$cancelRequest&&!b._listRequest.$resolved&&b._listRequest.$cancelRequest(),b._listRequest=s.business.monitor({devicetype:b.deviceType.selected.id,project:C,key:b.searchKey,ext:{enableMask:1},mode:"SENSOR",usesocity:b.customerSelected?1:void 0,socitynode:b.customerSelected,showexception:b.showException?1:void 0,pageindex:(e&&b.gridOptions.paging?b.gridOptions.paging.pageindex:0)+1,pagesize:50},function(n){return(n=n.result[C]||{}).detail.length&&(b.itemLength=n.paging.count),angular.forEach(n.detail,function(t){"TEMPERATURECONTROL"!==b.deviceType.selected.id&&"ZTYPETEMPCONTROL"!==b.deviceType.selected.id||(t.status.temperature=t.status.temperature||t.channels[37]&&t.channels[37].lasttotal),angular.forEach(t.command,function(e){t.command[e]=e}),"ENERGYMETER"!==b.deviceType.selected.id&&"HEATENERGYMETER"!==b.deviceType.selected.id&&"TIMERMETER"!==b.deviceType.selected.id||(t.channels["07"]&&0==t.channels["07"].status?(t.reportStatus=0,t.lastupdate=t.channels["07"].lastupdate,t.channels["08"]||(t.noheat=!0)):t.channels["08"]&&0==t.channels["08"].status?(t.reportStatus=0,t.lastupdate=t.channels["08"].lastupdate,t.channels["07"]||(t.nocold=!0)):t.channels["07"]&&!t.channels["08"]?(t.noheat=!0,t.reportStatus=t.channels["07"].status,t.lastupdate=t.channels["07"].lastupdate):!t.channels["07"]&&t.channels["08"]?(t.nocold=!0,t.reportStatus=t.channels["08"].status,t.lastupdate=t.channels["08"].lastupdate):t.channels["07"]&&t.channels["08"]?t.channels["07"].lastupdate>t.channels["08"].lastupdate?(t.reportStatus=t.channels["07"].status,t.lastupdate=t.channels["07"].lastupdate):(t.reportStatus=t.channels["08"].status,t.lastupdate=t.channels["08"].lastupdate):t.channels["07"]||t.channels["08"]||(t.nocold=!0,t.noheat=!0)),"TEMPHUMMETER"===b.deviceType.selected.id&&(t.channels[49]&&0==t.channels[49].status?(t.reportStatus=t.channels[49].status,t.lastupdate=t.channels[49].lastupdate):t.channels[48]&&0==t.channels[48].status?(t.reportStatus=t.channels[48].status,t.lastupdate=t.channels[48].lastupdate):t.reportStatus=t.channels[48].status),"PRESSUREMETER"===b.deviceType.selected.id&&(t.channels[50]?(t.reportStatus=t.channels[50].status,t.lastupdate=t.channels[50].lastupdate):(t.reportStatus=t.channels[10].status,t.lastupdate=t.channels[10].lastupdate))}),e?b.gridOptions.data=b.gridOptions.data.concat(n.detail||[]):(b.gridOptions.data=n.detail||[],b.columnDefsData(),b.gridOptions.data.length&&l(function(){b.gridApi.core.scrollTo(b.gridOptions.data[0],b.gridOptions.columnDefs[0])})),b.curveChannels={},angular.forEach(n.detail[0].channels,function(e,t){n.detail[0].channels[t].persist&&(b.curveChannels[t]=e)}),b.gridOptions.paging=n.paging,b.multiCheck.all&&l(function(){b.multiCheck("all")}),b.columnDefsData(),n}),b._listRequest.$promise},e.$watch("$ctrl.customerSelected",function(){b.list()}),b.confirmControl=function(n,l,e,t){var i=v(n,l,e),a={};n.entity&&(a[t]=n.entity.status[e]),d.swal({title:"控制校验",input:"password",cancelButtonText:"取消",confirmButtonText:"确定",inputPlaceholder:"控制密码",showCancelButton:!0,showLoaderOnConfirm:!0,allowOutsideClick:!1,preConfirm:function(e){var t=c.defer();return e?s.control.send({id:n.entity&&n.entity.id&&n.entity.id||i,project:C,command:l,param:a,ctrlcode:(new Hashes.SHA1).hex(e).toUpperCase()},function(e){t.resolve(e)},function(e){t.reject(e.message)}):t.reject("请输入控制密码"),t.promise}}).then(function(){d.close()},function(){v(i,l,e)})},b.multiControl=function(e,t,n,l){var i=v(e,t,n),a={};a[l]=e.entity.status[n],s.control.send({id:i,project:C,command:t,param:a},function(){},function(e){v(i,t,n),d.error("操作失败",e.message)})},b.commandSend=function(e){b.selectedItem=[],!e&&angular.forEach(b.gridApi.grid.rows,function(e){e.isSelected&&e.entity.command!==[]&&b.selectedItem.push(e.entity.id)}),e&&e.entity.command!==[]&&(b.selectedItem=e.entity.id)}}]}),angular.module("app").component("controlSlider",{templateUrl:"app/modules/monitor/slider.html?rev=80cf28ea64",bindings:{value:"=",disabled:"<",onSlider:"&"},controller:["$scope","$element",function(n,e){var l,i=this,a=e.children(".ui-slider"),c=angular.extend({min:15,max:30,orientation:"horizontal",range:"min"},e.data()),s=!1,d=function(e,t){i.value!==t.value&&(s=!0,l=i.value,i.value=t.value)},o=function(e,t){i.uivalue=t.value,n.$apply()};a.slider(c),angular.isDefined(c.disabled)&&a.slider("option","disabled",!!c.disabled),n.$watch("$ctrl.value",function(e){if(s)s=!1,i.onSlider();else if(angular.isUndefined(e)&&angular.isDefined(l))i.value=l,i.uivalue=l,l=void 0;else{angular.isDefined(e)&&e>c.max&&(e=Math.ceil(e%c.max)),i.uivalue=e||20;var t=a.slider("option","disabled");t&&a.slider("option","disabled",!1),a.off("slide"),a.off("slidechange"),a.slider("option","value",i.uivalue),a.on("slide",o),a.on("slidechange",d),t&&a.slider("option","disabled",!0)}}),i.$onChanges=function(e){angular.isUndefined(c.disabled)&&a.slider("option","disabled",!!e.disabled.currentValue)}}]}),angular.module("app").component("controlsliderZ",{templateUrl:"app/modules/monitor/slider-z.html?rev=d7064fdc4f",bindings:{value:"=",disabled:"<",onSlider:"&"},controller:["$scope","$element",function(n,e){var l,i=this,a=e.children(".ui-slider"),c=angular.extend({min:15,max:40,orientation:"horizontal",range:"min"},e.data()),s=!1,d=function(e,t){i.value!==t.value&&(s=!0,l=i.value,i.value=t.value)},o=function(e,t){i.uivalue=t.value,n.$apply()};a.slider(c),angular.isDefined(c.disabled)&&a.slider("option","disabled",!!c.disabled),n.$watch("$ctrl.value",function(e){if(s)s=!1,i.onSlider();else if(angular.isUndefined(e)&&angular.isDefined(l))i.value=l,i.uivalue=l,l=void 0;else{angular.isDefined(e)&&e>c.max&&(e=Math.ceil(e%c.max)),i.uivalue=e||20;var t=a.slider("option","disabled");t&&a.slider("option","disabled",!1),a.off("slide"),a.off("slidechange"),a.slider("option","value",i.uivalue),a.on("slide",o),a.on("slidechange",d),t&&a.slider("option","disabled",!0)}}),i.$onChanges=function(e){angular.isUndefined(c.disabled)&&a.slider("option","disabled",!!e.disabled.currentValue)}}]}),angular.module("app").component("controlSpeed",{template:'<i class="emweb" ng-repeat="(key,val) in $ctrl.items" ng-class="[val,{active:$ctrl.speed===key}]" ng-click="$ctrl.click(key)"></i>',bindings:{speed:"=",disabled:"<",onSpeed:"&"},controller:["$scope",function(e){var t,n=this,l=!1;n.items={EMC_LOW:"web-speed-three",EMC_MEDIUM:"web-speed-four",EMC_HIGH:"web-speed-five"},n.click=function(e){n.disabled||(l=!0,t=n.speed,n.speed=e)},e.$watch("$ctrl.speed",function(e){n.disabled||(!0===l?(l=!1,n.onSpeed()):angular.isUndefined(e)&&angular.isDefined(t)?(n.speed=t,t=void 0):n.speed=e)})}]}),angular.module("app").component("controlspeedZ",{template:'<i class="emweb" ng-repeat="(key,val) in $ctrl.items" ng-class="[val,{active:$ctrl.speed===key}]" ng-click="$ctrl.click(key)"></i>',bindings:{speed:"=",disabled:"<",onSpeed:"&"},controller:["$scope",function(e){var t,n=this,l=!1;n.items={EMC_LOW:"web-speed-three",EMC_MEDIUM:"web-speed-four",EMC_HIGH:"web-speed-five",EMC_AUTO:"web-speed-auto"},n.click=function(e){n.disabled||(l=!0,t=n.speed,n.speed=e)},e.$watch("$ctrl.speed",function(e){n.disabled||(!0===l?(l=!1,n.onSpeed()):angular.isUndefined(e)&&angular.isDefined(t)?(n.speed=t,t=void 0):n.speed=e)})}]}),angular.module("app").component("controlMode",{template:'<a href="javascript:void(0)" ng-if="!item.hide" class="btn btn-sm btn-primary" ng-repeat="(key,item) in $ctrl.items" ng-class="{active:$ctrl.mode===key}" ng-click="$ctrl.click(key)"><i class="emweb" ng-class="item.icon"></i>{{item.name}}</a>',bindings:{mode:"=",disabled:"<",hide:"<",onMode:"&"},controller:["$scope",function(e){var t,n=this,l=!1;n.items={EMC_COOLING:{icon:"web-snow",name:"制冷",hide:!1},EMC_HEATING:{icon:"web-sun",name:"制热",hide:!1},EMC_DEHUMIDIFYING:{icon:"web-clear-wet",name:"除湿",hide:!1},EMC_VERTILATING:{icon:"web-ventilation",name:"通风",hide:!1}},n.$onInit=function(){n.hide&&n.hide.length&&angular.forEach(n.hide,function(e){n.items[e].hide=!0})},n.click=function(e){n.disabled||(l=!0,t=n.mode,n.mode=e)},e.$watch("$ctrl.mode",function(e){n.disabled||(!0===l?(l=!1,n.onMode()):angular.isUndefined(e)&&angular.isDefined(t)?(n.mode=t,t=void 0):n.mode=e)})}]}),angular.module("app").component("controlCommand",{templateUrl:"app/modules/monitor/command.html?rev=08ad407d2d",bindings:{selected:"="},controller:["$scope","$element","$api","SweetAlert","$timeout",function(t,e,n,l,i){var a,c=this,s=e.children(".modal");t.$watch("$ctrl.selected",function(e){e&&(c.formData={sensorid:e},s.modal("show"),a=t.form)}),c.submit=function(){c.sendRequest&&c.sendRequest.$cancelRequest&&!c.sendRequest.$resolved&&c.sendRequest.$cancelRequest(),c.sendRequest=n.control.through(c.formData,function(){l.success("发送成功")},function(e){e.message={60000001:"请配置驱动",60000002:"仪表对应的串口参数未配置",60000003:"仪表返回超时"}[e.code]||e.message,e.message&&l.warning.apply(l,angular.isArray(e.message)?e.message:[e.message]),delete c.sendRequest}),i(c.sendRequest&&c.sendRequest.$cancelRequest,31e3)},c.$onDestroy=function(){c.sendRequest&&c.sendRequest.$cancelRequest&&!c.sendRequest.$resolved&&c.sendRequest.$cancelRequest()},c.reset=function(){delete c.formData.command,delete c.formData.data},s.on("hidden.bs.modal",function(){return delete c.selected,delete c.formData,a.$setPristine(),t.$apply(),!1}),s.find("input[name=command]").on("invalid",function(){return a.command.$setDirty(),t.$apply(),!1}),s.find("input[name=data]").on("invalid",function(){return a.data.$setDirty(),t.$apply(),!1})}]}),angular.module("app").component("channeldetail",{templateUrl:"app/modules/monitor/channedetail.html?rev=1b780d3043",bindings:{curve:"=",channels:"<"},controller:["$scope","$element","$api","$timeout",function(e,t,n,l){var i=this,a=t.find(".modal-curve");a.on("shown.bs.modal",function(){l(i.buildLine)}).on("hidden.bs.modal",function(){delete i.curve,delete i.timeline}),e.$watch("$ctrl.curve",function(e){e&&i.channeldetail(e)}),i.date=moment().format("YYYY-MM-DD"),i.timetype={DAY:"日",WEEK:"周",MONTH:"月",YEAR:"年"},i.timetype_current="DAY",i.timetypeChange=function(e){i.timetype_current=e,t.find(".modal-curve input[datetimepicker]").data("DateTimePicker").format({DAY:"YYYY-MM-DD",WEEK:"YYYY-MM-DD",MONTH:"YYYY-MM",YEAR:"YYYY"}[e]).viewMode({DAY:"days",WEEK:"days",MONTH:"months",YEAR:"years"}[e]).defaultDate(i.date),i.channeldetail()},i.channeldetail=function(e){for(var t in e&&(i.currentchannelid=e.currentchannelid),i.curve=e||i.curve||{},i.curve.type=i.curve.type||"diff",i.curve.categories=[],i.curve.diff=[],i.curve.scale=[],i.curve.enable=!1,i.channelID=[],i.charttype="spline",i.curve.channels)i.channelID.push(t);i.curve.channels[i.currentchannelid]&&n.business.channeldetail({id:i.curve.channels[i.currentchannelid].id,timeformat:i.timetype_current,from:i.date.replace(/-/g,""),to:i.date.replace(/-/g,"")},function(e){e.result&&(angular.forEach(e.result.detail,function(e){i.curve.categories.push(e.timepoint),i.curve.diff.push(e.value),i.curve.scale.push(e.total)}),i.curve.enable=!0,i.curve.start=e.result.start,i.curve.unit=e.result.unit,a.hasClass("in")?i.buildLine():a.modal("show"))})},i.lineType=function(e){i.curve.type=e,i.buildLine()},i.typeChange=function(e){i.charttype=e,i.buildLine()},i.buildLine=function(){i.curve.enable&&(i.timeline={chart:{type:i.charttype},title:!1,xAxis:{type:"datetime",categories:i.curve.categories,labels:{formatter:function(){return moment(this.value).format({DAY:"H",WEEK:"M-DD",MONTH:"M-DD",YEAR:"YYYY-MM"}[i.timetype_current])}}},yAxis:{title:!1},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:{point.color};font-weight:700;">{point.y:.2f} '+i.curve.unit+"</span>"},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y:.2f}"+i.curve.unit}}},series:[{name:i.curve.title,data:i.curve[i.curve.type]}]})}}]});