EMAPP.templateCache.put("assets/html/login.html?rev=b288df85ce",'<div class="login-container"><div class="login-position text-center"><form class="login-form" name="loginForm" ng-submit="self.login()" login-form><div class="form-group"><img ng-src="assets/img/logo.png" title="智慧云能源用户平台" ng-if="!self.isBasic"> <img src="assets/img/logo_basic.png" title="柏诚智能云能源用户平台" ng-if="self.isBasic"></div><div class="form-group"><input type="text" class="form-control login-field" name="user" ng-model="self.user" maxlength="50" placeholder="账号/用户名" required><label class="login-field-icon fui-user"></label><span class="form-control-feedback"><a href="javascript:void(0)" class="fui-cross text-muted" ng-if="loginForm.user.$viewValue" ng-click="self.clearUserInput()"></a> <i class="fui-question-circle text-warning" ng-if="loginForm.user.$dirty&&loginForm.user.$error.required"></i></span></div><div class="form-group"><input type="password" class="form-control login-field" name="password" ng-model="self.passwd" maxlength="18" placeholder="密码" readonly="readonly" required><label class="login-field-icon fui-lock"></label><span class="form-control-feedback"><a href="javascript:void(0)" class="fui-cross text-muted" ng-if="loginForm.password.$viewValue" ng-click="self.clearPasswdInput()"></a> <i class="fui-question-circle text-warning" ng-if="loginForm.password.$dirty&&loginForm.password.$error.required"></i></span></div><div class="input-group show"><label class="checkbox pull-left" role="button"><input type="checkbox" name="remember" ng-model="self.remember" data-toggle="checkbox"> 一个月免登录</label><button type="submit" class="btn btn-primary pull-right">登录 <i class="fui-exit"></i></button></div></form></div></div>'),angular.module("EMAPP").controller("EMAPP.login",["$state","$stateParams","$api","$cookies","md5","SweetAlert",function(e,o,t,r,a,n){var l,s=this,i=o.action||"logout",u=/cloudenergy\.me/.test(location.hostname)?".cloudenergy.me":location.hostname,c=function(o){!function(e,o){e&&angular.forEach({20000001:"用户不存在",90000001:"服务器错误",90000002:"拒绝访问",90000003:"登录失败",90000004:"权限不足",90000005:"未登录",90000006:["验证失败","账号或密码有误"],90000007:"签名校验失败"},function(t,r){parseInt(e)===parseInt(r)&&(o=t)}),o&&n.error.apply(n,angular.isArray(o)?o:[o])}(o.code||o.err,o.message),EMAPP.User=o&&o.result||EMAPP.User||{},EMAPP.User.groupmode=EMAPP.User.groupuser,angular.forEach(["token","user"],function(e){EMAPP.User[e]&&r.put(e,EMAPP.User[e]||!1,{path:"/",domain:u,expires:l&&moment().add(1,"months")._d||void 0})}),EMAPP.User.token?e.go(e.prev.state||"dashboard.main",EMAPP.User.groupuser&&e.prev.params||{}):e.go("auth",{action:"login"})};delete sessionStorage.projectid,s.isBasic=/^basic\./.test(location.host),s.user=localStorage.loginUser,s.passwd=localStorage.loginPasswd,s.remember=!!localStorage.loginRemember,s.clearUserInput=function(){delete localStorage.loginUser,delete s.user,delete localStorage.loginPasswd,delete s.passwd,delete localStorage.loginRemember,delete s.remember},s.clearPasswdInput=function(){delete localStorage.loginPasswd,delete s.passwd,delete localStorage.loginRemember,delete s.remember},s.login=function(){var e=this&&this.user,o=this&&this.passwd,r=[];l=s.remember,!e&&r.push("账号/用户名"),!o&&r.push("密码"),r=r.join("与"),r?n.warning("请输入您的"+r):(delete localStorage.loginUser,delete localStorage.loginPasswd,delete localStorage.loginRemember,localStorage.loginUser=s.user,s.remember&&(localStorage.loginPasswd=s.passwd,localStorage.loginRemember=s.remember)),!r&&t.auth.login({user:e,passwd:a.createHash(o).toUpperCase()},c,function(e){c(e.data)})},s.logout=function(){t.auth.logout({redirect:"/"},function(){EMAPP.User={},angular.forEach(["token","user"],function(e){r.remove(e,{path:"/"}),r.remove(e,{path:"/",domain:u}),r.remove(e,{path:"/",domain:".www"+u})}),e.go("auth",{action:"login"})})},"logout"===i&&s.logout()}]).directive("loginForm",["$timeout",function(e){return{restrict:"A",link:function(o,t,r){t.find("input[name=user]").on("invalid",function(){return e(o.loginForm.user.$setDirty),!1}),t.find("input[name=password]").on("invalid",function(){return e(o.loginForm.password.$setDirty),!1}),e(function(){t.find("input[name=password]").removeAttr("readonly")},500),t.find("input[name=remember]").radiocheck()}}}]);
//# sourceMappingURL=login.min.js.map
