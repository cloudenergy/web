angular.module("EMAPP").controller("EMAPP.login",["$state","$stateParams","$api","$cookies","md5","SweetAlert",function(e,o,r,t,a,n){var l,s=this,i=o.action||"logout",u=/cloudenergy\.me/.test(location.hostname)?".cloudenergy.me":location.hostname,g=function(o){!function(e,o){e&&angular.forEach({20000001:"用户不存在",90000001:"服务器错误",90000002:"拒绝访问",90000003:"登录失败",90000004:"权限不足",90000005:"未登录",90000006:["验证失败","账号或密码有误"],90000007:"签名校验失败"},function(r,t){parseInt(e)===parseInt(t)&&(o=r)}),o&&n.error.apply(n,angular.isArray(o)?o:[o])}(o.code||o.err,o.message),EMAPP.User=o&&o.result||EMAPP.User||{},EMAPP.User.groupmode=EMAPP.User.groupuser,angular.forEach(["token","user"],function(e){EMAPP.User[e]&&t.put(e,EMAPP.User[e]||!1,{path:"/",domain:u,expires:l&&moment().add(1,"months")._d||void 0})}),EMAPP.User.token?e.go(e.prev.state||"dashboard.main",EMAPP.User.groupmode&&e.prev.params||{}):e.go("auth",{action:"login"})};s.isBasic=/^basic\./.test(location.host),s.user=localStorage.loginUser,s.passwd=localStorage.loginPasswd,s.remember=!!localStorage.loginRemember,s.clearUserInput=function(){delete localStorage.loginUser,delete s.user,delete localStorage.loginPasswd,delete s.passwd,delete localStorage.loginRemember,delete s.remember},s.clearPasswdInput=function(){delete localStorage.loginPasswd,delete s.passwd,delete localStorage.loginRemember,delete s.remember},s.login=function(){var e=this&&this.user,o=this&&this.passwd,t=[];l=s.remember,!e&&t.push("账号/用户名"),!o&&t.push("密码"),t=t.join("与"),t?n.warning("请输入您的"+t):(delete localStorage.loginUser,delete localStorage.loginPasswd,delete localStorage.loginRemember,localStorage.loginUser=s.user,s.remember&&(localStorage.loginPasswd=s.passwd,localStorage.loginRemember=s.remember)),!t&&r.auth.login({user:e,passwd:a.createHash(o).toUpperCase()},g,function(e){g(e.data)})},s.logout=function(){r.auth.logout({redirect:"/"},function(){EMAPP.User={},angular.forEach(["token","user"],function(e){t.remove(e,{path:"/"}),t.remove(e,{path:"/",domain:u}),t.remove(e,{path:"/",domain:".www"+u})}),e.go("auth",{action:"login"})})},"logout"===i&&s.logout()}]).directive("loginForm",["$timeout",function(e){return{restrict:"A",link:function(o,r,t){r.find("input[name=user]").on("invalid",function(){return e(o.loginForm.user.$setDirty),!1}),r.find("input[name=password]").on("invalid",function(){return e(o.loginForm.password.$setDirty),!1}),e(function(){r.find("input[name=password]").removeAttr("readonly")},500),r.find("input[name=remember]").radiocheck()}}}]);
//# sourceMappingURL=login.min.js.map
