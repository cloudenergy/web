EMAPP.templateCache.put("assets/html/project/statistic.html?rev=f406556ea4",'<div class="app-view-project-statistic"><ul class="nav nav-tabs ng-cloak"><li ng-repeat="(key,name) in self.tabs" ng-class="{active:self.tabActive===key}"><a ui-sref="{tab:key}" ng-bind="name"></a></li><li class="pull-right form-inline"><div class="form-group form-group-sm has-feedback date"><input type="text" class="form-control" id="start_date" ng-model="self.startDate" datetimepicker range-day="self.rangeDay" data-link-right="#end_date"> <i class="emweb web-calendar form-control-feedback"></i></div><div class="input-group" ng-show="self.tabActive!==\'dailyreport\'">至</div><div class="form-group form-group-sm has-feedback date" ng-show="self.tabActive!==\'dailyreport\'"><input type="text" class="form-control" id="end_date" ng-model="self.endDate" datetimepicker range-day="self.rangeDay" data-use-current="false" data-link-left="#start_date"> <i class="emweb web-calendar form-control-feedback"></i></div><div class="input-group" ng-if="!self.groupmode"><div class="btn-group btn-group-sm"><button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"><span ng-bind="self.energyData.selected.title||\'全部\'">全部</span> <span class="caret"></span></button><ul class="dropdown-menu"><li ng-class="{active:!self.energyData.selected}" ng-click="self.energyData.selected=null;"><a href="javascript:void(0)">全部</a></li><li ng-repeat="item in self.energyData" ng-class="{active:self.energyData.selected.id===item.id}" ng-click="self.energyData.selected=item;"><a href="javascript:void(0)" ng-bind="item.title"></a></li></ul></div></div><div class="input-group btn-group-sm"><button type="button" class="btn btn-success" ng-click="self.report(self.tabActive);"><i class="emweb web-search"></i> 查询</button></div><div class="input-group btn-group-sm">&nbsp;</div><div class="input-group btn-group-sm">&nbsp;</div><div class="input-group btn-group btn-group-sm ng-hide" ng-show="self.tabActive===\'monthlyreport\'||self.tabActive===\'dailyreport\'"><a class="btn btn-info" href="javascript:void(0)" ng-class="{active:self.grid_timetype_current===\'usage\'}" ng-click="self.grid_timetype(\'usage\')">用量 <i class="emweb web-curve-area"></i> </a><a class="btn btn-info" href="javascript:void(0)" ng-class="{active:self.grid_timetype_current===\'scale\'}" ng-click="self.grid_timetype(\'scale\')">刻度 <i class="emweb web-line-spacing"></i></a></div><div class="input-group btn-group-sm"><button type="button" class="btn btn-info" ng-click="self.filter()">筛选<i class="emweb web-filter"></i></button></div><div class="input-group btn-group-sm"><button type="button" class="btn btn-info" ng-click="self.export()">导出<i class="emweb web-export-excel"></i></button></div></li></ul><div class="tab-content ng-cloak"><div class="tab-pane subContent active" auto-height ui-i18n="\'zh-cn\'" id="report"><div ui-grid="self.gridOptions" class="grid" ui-grid-auto-resize ui-grid-exporter ui-grid-move-columns ui-grid-resize-columns></div></div></div></div>'),angular.module("EMAPP").controller("project.statistic",["$api","$filter","$timeout","$stateParams","uiGridConstants",function(e,t,a,i,r){var l=this,n=new Date,s=EMAPP.Project.current&&EMAPP.Project.current._id;return l.groupmode=EMAPP.User.groupmode,!l.groupmode&&e.energy.info({project:EMAPP.Project.ids},function(e){angular.forEach(e.result.energy||{},function(e){this.push(e)},l.energyData=[])}),l.filter=function(){l.gridOptions.enableFiltering=!l.gridOptions.enableFiltering,l.gridApi.core.notifyDataChange(r.dataChange.COLUMN)},l["export"]=function(){switch(l.tabActive){case"settlereport":case"monthlyreport":case"projectreport":l.gridOptions.exporterCsvFilename=EMAPP.title+"_统计_"+l.tabs[l.tabActive]+"_"+l.startDate.replace(/\-/g,"")+"_"+l.endDate.replace(/\-/g,"")+".csv";break;case"dailyreport":l.gridOptions.exporterCsvFilename=EMAPP.title+"_统计_"+l.tabs[l.tabActive]+"_"+l.startDate.replace(/\-/g,"")+".csv"}l.gridApi.exporter.csvExport("visible","visible",angular.element(document.querySelectorAll(".subContent")))},(l.grid_timetype=function(e){l.grid_timetype_current=e,l.rebuildData&&l.rebuildData(l.gridOptions.data)})("usage"),l.rebuildData=function(e){"monthlyreport"===l.tabActive&&angular.forEach(e,function(e){e.monthlySum=Math.round(100*e.monthlySum)/100,angular.forEach(e[l.grid_timetype_current],function(a,i){e["day"+t("date")(i,"yyyyMMdd")]=a})}),"dailyreport"===l.tabActive&&angular.forEach(e,function(e){e.dailysum=Math.round(100*e.dailysum)/100,angular.forEach(e[l.grid_timetype_current],function(a,i){e["hour"+t("date")(i,"H")]=a})}),l.gridOptions.data=e},l.gridOptions={onRegisterApi:function(e){l.gridApi=e},rowHeight:34,enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,t,a,i){return{name:!0,"id.substr(12,12)":!0,"channeldid.substr(12,12)":!0}[a.field]?'="'+(i||"")+'"':i}},l.tabs=l.groupmode?{projectreport:"项目总用能"}:{settlereport:"结算报表",monthlyreport:"月报表",dailyreport:"日报表"},l.tabClick=function(e){l.startDate=t("date")(n,"dailyreport"===e?"yyyy-MM-dd":"yyyy-MM-01"),l.endDate=t("date")(n,"yyyy-MM-dd"),l.rangeDay="monthlyreport"===e&&30||0,l.tabActive=e,l.report(e)},l.report=function(a){var i=l.energyData&&l.energyData.selected&&l.energyData.selected.id,r={project:[]};switch(angular.forEach(EMAPP.Project,function(e){r.project.push({id:e._id,energy:i||void 0})}),a){case"settlereport":case"monthlyreport":case"projectreport":r.from=l.startDate.replace(/\-/g,""),r.to=l.endDate.replace(/\-/g,"");break;case"dailyreport":r.time=l.startDate.replace(/\-/g,"")}switch(a){case"settlereport":l.gridOptions.columnDefs=[{displayName:"",name:"$index",type:"number",width:50,minWidth:50,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"传感器名称",name:"name",width:"*",minWidth:260},{displayName:"设备ID",name:"id.substr(12,12)",type:"number",width:"*",minWidth:120},{displayName:"设备编码",name:"tag",width:"*",minWidth:160,enableColumnMenu:!1},{displayName:"能耗分类",name:"energy",width:"*",minWidth:100},{displayName:l.startDate,name:"min",type:"number",width:"*",minWidth:100,headerCellClass:"text-right",cellClass:"text-right"},{displayName:l.endDate,name:"max",type:"number",width:"*",minWidth:100,headerCellClass:"text-right",cellClass:"text-right"},{displayName:"能耗总值",name:"sum",type:"number",width:"*",minWidth:100,headerCellClass:"text-right",cellClass:"text-right"},{displayName:"单价",name:"price",type:"number",width:"*",minWidth:100,headerCellClass:"text-right",cellClass:"text-right"},{displayName:"费用",name:"cost",type:"number",width:"*",minWidth:100,headerCellClass:"text-right",cellClass:"text-right"}];break;case"monthlyreport":l.gridOptions.columnDefs=[{displayName:"",name:"$index",type:"number",width:50,minWidth:50,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"传感器名称",name:"name",width:"*",minWidth:260},{displayName:"设备ID",type:"number",name:"channeldid.substr(12,12)",width:"*",minWidth:120},{displayName:"设备编码",name:"tag",width:"*",minWidth:160,enableColumnMenu:!1},{displayName:"能耗分类",name:"energy",width:"*",minWidth:100},{displayName:"月能耗",type:"number",name:"monthlySum",width:"*",minWidth:100,headerCellClass:"text-right",cellClass:"text-right"},{displayName:"日平均",type:"number",name:"dailyAvg",width:"*",minWidth:100,headerCellClass:"text-right",cellClass:"text-right"}];break;case"dailyreport":l.gridOptions.columnDefs=[{displayName:"",name:"$index",type:"number",width:50,minWidth:50,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"传感器名称",name:"name",width:"*",minWidth:260},{displayName:"设备ID",type:"number",name:"channeldid.substr(12,12)",width:"*",minWidth:120},{displayName:"设备编码",name:"tag",width:"*",minWidth:160,enableColumnMenu:!1},{displayName:"能耗分类",name:"energy",width:"*",minWidth:100},{displayName:"日能耗",type:"number",name:"dailysum",width:"*",minWidth:100,headerCellClass:"text-right",cellClass:"text-right"}];break;case"projectreport":l.gridOptions.columnDefs=[{displayName:"",name:"$index",type:"number",width:50,minWidth:50,enableColumnMenu:!1,exporterSuppressExport:!0,headerCellClass:"text-center",headerCellTemplate:'<div class="ui-grid-cell-contents">序号</div>',cellClass:"text-center",cellTemplate:'<div class="ui-grid-cell-contents" ng-bind="grid.renderContainers.body.visibleRowCache.indexOf(row)+1"></div>'},{displayName:"项目名称",name:"name",width:"*",minWidth:260},{displayName:"总用能",type:"number",name:"consumption",width:"*",minWidth:160,headerCellClass:"text-right",cellClass:"text-right"},{displayName:"总费用",type:"number",name:"cost",width:"*",minWidth:160,headerCellClass:"text-right",cellClass:"text-right"},{displayName:"单位用能",type:"number",name:"uaec",width:"*",minWidth:160,headerCellClass:"text-right",cellClass:"text-right"},{displayName:"单位电能",type:"number",name:"uaeec",width:"*",minWidth:160,headerCellClass:"text-right",cellClass:"text-right"}]}e.business[a](r,function(e){switch(a){case"settlereport":e=e.result[s]||[];break;case"monthlyreport":e=e.result[s]||[],e.length&&angular.forEach(e[0].usage,function(e,a){this.push({displayName:t("date")(a,"yyyy-M-d"),name:"day"+t("date")(a,"yyyyMMdd"),width:"*",minWidth:110,headerCellClass:"text-right",cellClass:"text-right"})},l.gridOptions.columnDefs);break;case"dailyreport":e=e.result[s]||[],e.length&&angular.forEach(e[0].usage,function(e,a){a=t("date")(a,"H"),this.push({displayName:a+"时",name:"hour"+a,width:"*",minWidth:100,headerCellClass:"text-right",cellClass:"text-right"})},l.gridOptions.columnDefs);break;case"projectreport":angular.forEach(e.result,function(e){angular.forEach(e,function(t,a){e[a]="name"===a?t:Math.round(100*t)/100}),this.push(e)},e=[])}l.rebuildData(e)})},l.tabClick(l.groupmode?"projectreport":i.tab||"settlereport"),l}]);
//# sourceMappingURL=statistic.min.js.map
